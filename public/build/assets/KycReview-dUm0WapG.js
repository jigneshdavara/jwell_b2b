import{u as M,r as v,a as p,j as e,H as R,b as B}from"./app-BCnxwFoh.js";import{A as P}from"./AdminLayout-COULfUu7.js";import{I as m}from"./InputError-DKuPcJyV.js";import{M as I}from"./Modal-B5FdPJP8.js";import"./transition-CYMZ8zw2.js";function H(){const{user:s,statuses:y,documentStatuses:$,messages:u}=M().props,[o,h]=v.useState(null),[n,b]=v.useState(null),{data:f,setData:g,post:k,processing:j,errors:i}=p({status:s.kyc_status,remarks:s.kyc_notes??""}),a=p({message:""}),r=p({status:"pending",remarks:""}),w=t=>{t.preventDefault(),a.data.message.trim()&&a.post(route("admin.customers.kyc.messages.store",s.id),{preserveScroll:!0,onSuccess:()=>a.reset("message")})},_=t=>{t.preventDefault(),k(route("admin.customers.update-kyc",s.id),{preserveScroll:!0})},C=()=>{B.post(route("admin.customers.kyc.comments.update",s.id),{allow_replies:!s.comments_enabled},{preserveScroll:!0})},N=(t,l)=>{const x=s.kyc_documents.find(L=>L.id===t);x&&(h(t),b(l),r.setData({status:l==="approve"?"approved":"rejected",remarks:x.remarks??""}))},d=()=>{h(null),b(null),r.reset()},S=t=>{t.preventDefault(),o&&r.put(route("admin.customers.kyc.documents.update",o),{preserveScroll:!0,onSuccess:()=>{d()}})},D=t=>t?new Date(t).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",A=t=>{const l={approved:"bg-emerald-100 text-emerald-700",rejected:"bg-rose-100 text-rose-700",needs_revision:"bg-amber-100 text-amber-700",pending:"bg-slate-100 text-slate-700"};return l[t]??l.pending},c=o?s.kyc_documents.find(t=>t.id===o):null;return e.jsxs(P,{children:[e.jsx(R,{title:`KYC Review - ${s.name}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"rounded-3xl bg-white p-6 shadow-xl ring-1 ring-slate-200/80",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"KYC Review"}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Review and verify customer documents"})]}),e.jsx("span",{className:`inline-flex items-center rounded-full px-4 py-1.5 text-xs font-semibold ${s.kyc_status==="approved"?"bg-emerald-100 text-emerald-700":s.kyc_status==="rejected"?"bg-rose-100 text-rose-700":"bg-amber-100 text-amber-700"}`,children:s.kyc_status_label})]})}),s.kyc_profile&&e.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-xl ring-1 ring-slate-200/80",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold text-slate-900",children:"Business Information"}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:"Customer Name"}),e.jsx("dd",{className:"mt-1.5 text-sm font-semibold text-slate-900",children:s.name})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:"Email"}),e.jsx("dd",{className:"mt-1.5 text-sm text-slate-700",children:s.email})]}),s.phone&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:"Phone"}),e.jsx("dd",{className:"mt-1.5 text-sm text-slate-700",children:s.phone})]}),s.type&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:"Customer Type"}),e.jsx("dd",{className:"mt-1.5 text-sm text-slate-700",children:s.type})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:"Business Name"}),e.jsx("dd",{className:"mt-1.5 text-sm font-semibold text-slate-900",children:s.kyc_profile.business_name??"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:"Website"}),e.jsx("dd",{className:"mt-1.5 text-sm text-slate-700",children:s.kyc_profile.business_website?e.jsx("a",{href:s.kyc_profile.business_website,target:"_blank",rel:"noopener noreferrer",className:"text-elvee-blue hover:text-feather-gold",children:s.kyc_profile.business_website}):"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:"GST Number"}),e.jsx("dd",{className:"mt-1.5 text-sm font-semibold text-slate-900",children:s.kyc_profile.gst_number??"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:"PAN Number"}),e.jsx("dd",{className:"mt-1.5 text-sm font-semibold text-slate-900",children:s.kyc_profile.pan_number??"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:"Registration Number"}),e.jsx("dd",{className:"mt-1.5 text-sm font-semibold text-slate-900",children:s.kyc_profile.registration_number??"—"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:"Contact Person"}),e.jsx("dd",{className:"mt-1.5 text-sm text-slate-700",children:s.kyc_profile.contact_name??"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:"Contact Phone"}),e.jsx("dd",{className:"mt-1.5 text-sm text-slate-700",children:s.kyc_profile.contact_phone??"—"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("dt",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:"Address"}),e.jsxs("dd",{className:"mt-1.5 text-sm text-slate-700",children:[[s.kyc_profile.address_line1,s.kyc_profile.address_line2].filter(Boolean).join(", ")||"—",e.jsx("br",{}),[s.kyc_profile.city,s.kyc_profile.state,s.kyc_profile.postal_code].filter(Boolean).join(", "),s.kyc_profile.country?`, ${s.kyc_profile.country}`:""]})]}),s.kyc_profile.created_at&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:"Profile Created"}),e.jsx("dd",{className:"mt-1.5 text-sm text-slate-700",children:new Date(s.kyc_profile.created_at).toLocaleString("en-IN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),s.kyc_profile.updated_at&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:"Profile Updated"}),e.jsx("dd",{className:"mt-1.5 text-sm text-slate-700",children:new Date(s.kyc_profile.updated_at).toLocaleString("en-IN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),s.created_at&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:"Account Created"}),e.jsx("dd",{className:"mt-1.5 text-sm text-slate-700",children:new Date(s.created_at).toLocaleString("en-IN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),s.updated_at&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:"Account Updated"}),e.jsx("dd",{className:"mt-1.5 text-sm text-slate-700",children:new Date(s.updated_at).toLocaleString("en-IN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})]})]}),e.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-xl ring-1 ring-slate-200/80",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold text-slate-900",children:"Documents"}),s.kyc_documents.length===0?e.jsx("div",{className:"rounded-2xl border border-dashed border-slate-300 p-12 text-center text-slate-500",children:e.jsx("p",{className:"text-sm",children:"No documents uploaded yet."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"border-b-2 border-slate-200 bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-slate-600",children:"Document Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-slate-600",children:"File"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-semibold text-slate-600",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-slate-600",children:"Remarks"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-semibold text-slate-600",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:s.kyc_documents.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50/50 transition",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:"font-semibold text-slate-900",children:t.type})}),e.jsx("td",{className:"px-4 py-4",children:t.file_url?e.jsxs("a",{href:t.file_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1.5 text-xs font-medium text-elvee-blue hover:text-feather-gold",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,className:"h-3.5 w-3.5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"})}),"View Document"]}):e.jsx("span",{className:"text-xs text-slate-400",children:"No file"})}),e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold ${A(t.status)}`,children:t.status.replace(/_/g," ")})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("p",{className:"text-xs text-slate-600",children:t.remarks||"—"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>N(t.id,"approve"),className:"inline-flex items-center gap-1 rounded-full border border-emerald-300 bg-emerald-50 px-3 py-1.5 text-xs font-semibold text-emerald-700 transition hover:border-emerald-400 hover:bg-emerald-100",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,className:"h-3.5 w-3.5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})}),"Approve"]}),e.jsxs("button",{type:"button",onClick:()=>N(t.id,"reject"),className:"inline-flex items-center gap-1 rounded-full border border-rose-300 bg-rose-50 px-3 py-1.5 text-xs font-semibold text-rose-700 transition hover:border-rose-400 hover:bg-rose-100",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,className:"h-3.5 w-3.5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}),"Reject"]})]})})]},t.id))})]})})]}),e.jsxs("form",{onSubmit:_,className:"rounded-3xl bg-white p-6 shadow-xl ring-1 ring-slate-200/80",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold text-slate-900",children:"Update KYC Status"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{className:"font-semibold text-slate-800",children:"Status"}),e.jsx("select",{className:"rounded-xl border border-slate-200 px-4 py-2 focus:border-feather-gold focus:outline-none focus:ring-2 focus:ring-feather-gold/20",value:f.status,onChange:t=>g("status",t.target.value),children:y.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),i.status&&e.jsx(m,{message:i.status})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{className:"font-semibold text-slate-800",children:"Internal Notes"}),e.jsx("textarea",{className:"min-h-[100px] rounded-xl border border-slate-200 px-4 py-2 focus:border-feather-gold focus:outline-none focus:ring-2 focus:ring-feather-gold/20",value:f.remarks,onChange:t=>g("remarks",t.target.value),placeholder:"Add internal notes (optional)"}),i.remarks&&e.jsx(m,{message:i.remarks})]})]}),s.kyc_notes&&e.jsxs("div",{className:"mt-4 rounded-xl bg-amber-50 p-4 text-sm text-amber-700",children:[e.jsx("p",{className:"font-semibold text-amber-800",children:"Previous Notes"}),e.jsx("p",{className:"mt-1 whitespace-pre-line",children:s.kyc_notes})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{type:"submit",disabled:j,className:"rounded-full bg-slate-900 px-5 py-2 text-sm font-semibold text-white shadow-lg shadow-slate-900/20 transition hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",children:j?"Saving...":"Save Status"})})]}),e.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-xl ring-1 ring-slate-200/80",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Conversation"}),e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"Communicate with the customer about their KYC submission."})]}),e.jsx("button",{type:"button",onClick:C,className:"inline-flex items-center rounded-full border border-slate-200 px-3 py-1.5 text-xs font-semibold text-slate-600 transition hover:border-slate-300 hover:text-slate-900",children:s.comments_enabled?"Disable customer replies":"Enable customer replies"})]}),e.jsx("div",{className:"mt-4 space-y-3 overflow-y-auto rounded-2xl bg-slate-50 p-4 text-sm text-slate-700 max-h-64",children:u.length===0?e.jsx("p",{className:"text-xs text-slate-500",children:"No messages yet. Send a note to start the conversation."}):u.map(t=>{const l=t.sender_type==="admin",x=l?t.admin?.name??"Compliance team":s.name;return e.jsxs("div",{className:`flex flex-col gap-1 ${l?"items-end text-right":"items-start text-left"}`,children:[e.jsxs("span",{className:"text-[11px] text-slate-400",children:[x,t.created_at?` · ${D(t.created_at)}`:""]}),e.jsx("div",{className:`max-w-full rounded-2xl px-4 py-3 text-sm ${l?"bg-slate-900 text-white":"bg-white text-slate-700 shadow ring-1 ring-slate-200/70"}`,children:e.jsx("p",{className:"whitespace-pre-line",children:t.message})})]},t.id)})}),!s.comments_enabled&&e.jsx("p",{className:"mt-3 rounded-xl bg-slate-50 px-4 py-3 text-xs text-slate-500",children:"Customer replies are disabled. They will still see all messages you send."}),e.jsxs("form",{onSubmit:w,className:"mt-4 space-y-2",children:[e.jsxs("label",{className:"flex flex-col gap-2 text-xs text-slate-600",children:[e.jsx("span",{className:"font-semibold text-slate-700",children:"Send Message"}),e.jsx("textarea",{value:a.data.message,onChange:t=>a.setData("message",t.target.value),className:"min-h-[90px] rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-feather-gold focus:outline-none focus:ring-2 focus:ring-feather-gold/20",placeholder:"Share clarifications, request missing documents, or confirm approval.",disabled:a.processing}),e.jsx(m,{message:a.errors.message})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:a.processing||!a.data.message.trim(),className:"inline-flex items-center rounded-full bg-slate-900 px-4 py-2 text-xs font-semibold text-white shadow shadow-slate-900/20 transition hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",children:a.processing?"Sending…":"Send Message"})})]})]})]}),e.jsx(I,{show:o!==null,maxWidth:"2xl",onClose:d,children:e.jsxs("div",{className:"flex min-h-0 flex-col",children:[e.jsx("div",{className:"flex-shrink-0 border-b border-slate-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:n==="approve"?"Approve Document":"Reject Document"}),e.jsx("button",{type:"button",onClick:d,className:"text-slate-400 hover:text-slate-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"min-h-0 flex-1 overflow-y-auto px-6 py-4",children:e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[c&&e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 p-4",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:"Document"}),e.jsx("p",{className:"mt-1.5 text-sm font-semibold text-slate-900",children:c.type}),c.file_url&&e.jsxs("a",{href:c.file_url,target:"_blank",rel:"noopener noreferrer",className:"mt-2 inline-flex items-center gap-1.5 text-xs font-medium text-elvee-blue hover:text-feather-gold",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,className:"h-3.5 w-3.5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"})}),"View Document"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-semibold text-slate-700",children:n==="approve"?"Approval Comment (Optional)":"Rejection Reason (Required)"}),e.jsx("textarea",{value:r.data.remarks,onChange:t=>r.setData("remarks",t.target.value),className:"w-full min-h-[120px] rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-feather-gold focus:outline-none focus:ring-2 focus:ring-feather-gold/20",placeholder:n==="approve"?"Add any notes about this approval...":"Explain why this document is being rejected and what needs to be corrected...",required:n==="reject"}),e.jsx(m,{message:r.errors.remarks})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:d,className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600 transition hover:border-slate-400 hover:text-slate-900",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:r.processing||n==="reject"&&!r.data.remarks.trim(),className:`rounded-full px-4 py-2 text-sm font-semibold text-white shadow-lg transition disabled:cursor-not-allowed disabled:opacity-70 ${n==="approve"?"bg-emerald-600 shadow-emerald-600/30 hover:bg-emerald-500":"bg-rose-600 shadow-rose-600/30 hover:bg-rose-500"}`,children:r.processing?"Processing...":n==="approve"?"Approve Document":"Reject Document"})]})]})})]})})]})}export{H as default};
