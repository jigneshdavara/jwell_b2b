import{u as it,r as k,a as at,j as e,H as ot}from"./app-BCnxwFoh.js";import{R as lt}from"./RichTextEditor-CygcQFtm.js";import{A as rt}from"./AdminLayout-COULfUu7.js";const ce=(T=!1)=>({sku:"",label:"",metal_id:"",metal_purity_id:"",diamond_option_key:null,size_cm:"",price_adjustment:"0",is_default:T,metadata:{},metals:[],diamonds:[],colorstones:[]}),dt=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`local-${Date.now()}-${Math.random().toString(16).slice(2,8)}`,ct=()=>({id:void 0,diamond_id:"",diamonds_count:""});function mt({catalogs:T,selectedIds:b,onChange:J,error:X}){const[R,B]=k.useState(!1),[G,I]=k.useState(""),Z=k.useRef(null),oe=k.useMemo(()=>{if(!G.trim())return T;const f=G.toLowerCase();return T.filter(C=>C.name.toLowerCase().includes(f)||C.code?.toLowerCase().includes(f))},[T,G]),O=f=>{b.includes(f)?J(b.filter(C=>C!==f)):J([...b,f])};k.useEffect(()=>{const f=C=>{Z.current&&!Z.current.contains(C.target)&&(B(!1),I(""))};return R&&document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[R]);const A=k.useMemo(()=>b.map(f=>{const C=T.find(W=>W.id===f);return C?{id:f,name:C.name}:null}).filter(Boolean),[b,T]),P=f=>{J(b.filter(C=>C!==f))};return e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Catalogs"}),b.length>0&&e.jsxs("span",{className:"text-xs font-medium text-sky-600",children:[b.length," selected"]})]}),e.jsxs("div",{className:"relative",ref:Z,children:[e.jsx("button",{type:"button",onClick:()=>B(!R),className:`w-full rounded-2xl border ${X?"border-rose-300":"border-slate-200"} bg-white px-4 py-2.5 text-left focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200 transition-all ${R?"border-sky-400 ring-2 ring-sky-200":""}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex-1 min-h-[20px] flex flex-wrap gap-1.5",children:b.length===0?e.jsx("span",{className:"text-slate-400",children:"Select catalogs..."}):A.map(f=>e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-md bg-sky-50 px-2 py-1 text-xs font-medium text-sky-700 border border-sky-200",onClick:C=>C.stopPropagation(),children:[e.jsx("span",{children:f.name}),e.jsx("button",{type:"button",onClick:C=>{C.stopPropagation(),P(f.id)},className:"hover:bg-sky-100 rounded-full p-0.5 transition-colors",children:e.jsx("svg",{className:"h-3 w-3 text-sky-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},f.id))}),e.jsx("svg",{className:`ml-2 h-5 w-5 text-slate-400 transition-transform flex-shrink-0 ${R?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),R&&e.jsxs("div",{className:"absolute z-50 mt-2 w-full rounded-2xl border border-slate-200 bg-white shadow-lg shadow-slate-900/10 max-h-80 overflow-hidden",children:[T.length>5&&e.jsx("div",{className:"border-b border-slate-100 p-3",children:e.jsxs("div",{className:"relative",children:[e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("input",{type:"text",value:G,onChange:f=>I(f.target.value),placeholder:"Search catalogs...",className:"w-full rounded-xl border border-slate-200 bg-white pl-10 pr-4 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",onClick:f=>f.stopPropagation()})]})}),e.jsx("div",{className:"max-h-64 overflow-y-auto p-2",children:oe.length===0?e.jsx("div",{className:"px-3 py-6 text-center text-sm text-slate-400",children:G?"No catalogs found":"No catalogs available"}):e.jsx("div",{className:"space-y-1",children:oe.map(f=>{const C=b.includes(f.id);return e.jsxs("button",{type:"button",onClick:()=>O(f.id),className:`w-full flex items-center gap-3 rounded-xl px-3 py-2.5 text-left transition-colors ${C?"bg-sky-50 text-sky-700":"text-slate-700 hover:bg-slate-50"}`,children:[e.jsx("div",{className:`flex h-5 w-5 items-center justify-center rounded border-2 transition-all ${C?"border-sky-500 bg-sky-500":"border-slate-300"}`,children:C&&e.jsx("svg",{className:"h-3.5 w-3.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm font-medium truncate ${C?"text-sky-900":"text-slate-900"}`,children:f.name}),f.code&&e.jsxs("span",{className:`text-xs font-mono ${C?"text-sky-600":"text-slate-500"}`,children:["(",f.code,")"]})]})})]},f.id)})})})]})]}),X&&e.jsx("span",{className:"text-xs text-rose-500",children:X})]})}function ht(){const{props:T}=it(),{product:b,brands:J,categories:X,catalogs:R,diamondCatalog:B,colorstoneCatalog:G,diamonds:I,colorstones:Z,customerGroups:oe,metals:O,metalPurities:A,metalTones:P,errors:f}=T;b?.variants?.length?b.variants.map((t,n)=>({id:t.id,sku:t.sku??"",label:t.label??"",metal_id:t.metal_id??"",metal_purity_id:t.metal_purity_id??"",diamond_option_key:t.diamond_option_key??null,size_cm:t.size_cm?String(t.size_cm):"",price_adjustment:String(t.price_adjustment??0),is_default:t.is_default??n===0,inventory_quantity:t.inventory_quantity!==void 0&&t.inventory_quantity!==null?Number(t.inventory_quantity):0,metadata:t.metadata??{},metals:t.metals?.map(s=>({id:s.id,metal_id:s.metal_id??"",metal_purity_id:s.metal_purity_id??"",metal_tone_id:s.metal_tone_id??"",metal_weight:s.metal_weight?String(s.metal_weight):""}))??[],diamonds:t.diamonds?.map(s=>({id:s.id,diamond_id:s.diamond_id??"",diamonds_count:s.diamonds_count?String(s.diamonds_count):""}))??[],colorstones:t.colorstones?.map(s=>({id:s.id,colorstone_id:s.colorstone_id??"",stones_count:s.stones_count?String(s.stones_count):""}))??[]})):ce(!0);const C=b?.making_charge_discount_overrides?.length?b.making_charge_discount_overrides.map((t,n)=>({localKey:`${dt()}-${n}`,customer_group_id:t.customer_group_id!==null&&t.customer_group_id!==void 0?Number(t.customer_group_id):"",type:t.type??"percentage",value:t.value!==null&&t.value!==void 0?String(t.value):""})):[],W=k.useMemo(()=>{if(!b?.variants?.length)return{metalIds:[],metalPurityIds:[],metalToneIds:[],diamondOptions:[],colorstoneSelections:[]};const t=new Set,n=new Set,s=new Set,d=new Map,i=new Map;return b.variants.forEach(a=>{a.metals?.length&&a.metals.forEach(r=>{r.metal_id&&r.metal_id!==""&&t.add(typeof r.metal_id=="number"?r.metal_id:Number(r.metal_id)),r.metal_purity_id&&r.metal_purity_id!==""&&n.add(typeof r.metal_purity_id=="number"?r.metal_purity_id:Number(r.metal_purity_id)),r.metal_tone_id&&r.metal_tone_id!==""&&s.add(typeof r.metal_tone_id=="number"?r.metal_tone_id:Number(r.metal_tone_id))}),a.diamonds?.length&&a.diamonds.forEach(r=>{if(r.diamond_id&&r.diamond_id!==""&&r.diamond_id!==null){const _=typeof r.diamond_id=="number"?r.diamond_id:Number(r.diamond_id);d.has(_)||d.set(_,{diamond_id:_,count:r.diamonds_count&&r.diamonds_count!==""&&r.diamonds_count!==null?String(r.diamonds_count):""})}}),a.colorstones?.length&&a.colorstones.forEach(r=>{if(r.colorstone_id&&r.colorstone_id!==""&&r.colorstone_id!==null){const _=typeof r.colorstone_id=="number"?r.colorstone_id:Number(r.colorstone_id);i.has(_)||i.set(_,{colorstone_id:_,count:r.stones_count&&r.stones_count!==""&&r.stones_count!==null?String(r.stones_count):""})}})}),{metalIds:Array.from(t),metalPurityIds:Array.from(n),metalToneIds:Array.from(s),diamondSelections:Array.from(d.values()),colorstoneSelections:Array.from(i.values())}},[b]),ee=at(()=>({sku:b?.sku??"",name:b?.name??"",titleline:b?.titleline??"",description:b?.description??"",catalog_ids:b?.catalog_ids??[],brand_id:String(b?.brand_id??""),category_id:String(b?.category_id??""),collection:b?.collection??"",producttype:b?.producttype??"",gender:b?.gender??"",making_charge:b?.making_charge?String(b.making_charge):"",making_charge_discount_type:b?.making_charge_discount_type??null,making_charge_discount_value:b?.making_charge_discount_value!==null&&b?.making_charge_discount_value!==void 0?String(b.making_charge_discount_value):null,making_charge_discount_overrides:C,is_active:b?.is_active??!0,is_variant_product:!0,variants:b?.variants?.length?b.variants.map((t,n)=>({id:t.id,sku:t.sku??"",label:t.label??"",metal_id:t.metal_id??"",metal_purity_id:t.metal_purity_id??"",diamond_option_key:t.diamond_option_key??null,size_cm:t.size_cm?String(t.size_cm):"",price_adjustment:String(t.price_adjustment??0),is_default:t.is_default??n===0,inventory_quantity:t.inventory_quantity!==void 0&&t.inventory_quantity!==null?Number(t.inventory_quantity):0,metadata:t.metadata??{},metals:t.metals?.map(s=>({id:s.id,metal_id:s.metal_id??"",metal_purity_id:s.metal_purity_id??"",metal_tone_id:s.metal_tone_id??"",metal_weight:s.metal_weight?String(s.metal_weight):""}))??[],diamonds:t.diamonds?.map(s=>({id:s.id,diamond_id:s.diamond_id??"",diamonds_count:s.diamonds_count?String(s.diamonds_count):""}))??[],colorstones:t.colorstones?.map(s=>({id:s.id,colorstone_id:s.colorstone_id??"",stones_count:s.stones_count?String(s.stones_count):""}))??[]})):[ce(!0)],metal_ids:W.metalIds,metal_purity_ids:W.metalPurityIds,metal_tone_ids:W.metalToneIds,diamond_options:[],uses_diamond:(W.diamondSelections?.length??0)>0,diamond_selections:W.diamondSelections??[],colorstone_selections:W.colorstoneSelections??[],media_uploads:[],removed_media_ids:[]})),{setData:j,post:me,put:ze,processing:ue}=ee,x=ee.data,[xe,pe]=k.useState(x.description),te=k.useRef(null);k.useEffect(()=>{x.description!==xe&&pe(x.description)},[x.description]);const Se=k.useCallback(t=>{pe(t),te.current&&clearTimeout(te.current),te.current=setTimeout(()=>{j("description",t)},300)},[j]);k.useEffect(()=>()=>{te.current&&clearTimeout(te.current)},[]);const[_e,he]=k.useState(""),[Me,$e]=k.useState(new Set),[Le,De]=k.useState(new Set),[ut,Ee]=k.useState(new Set);k.useCallback(t=>{De(n=>{const s=new Set(n);return s.has(t)?s.delete(t):s.add(t),s})},[]),k.useCallback(t=>{$e(n=>{const s=new Set(n);return s.has(t)?s.delete(t):s.add(t),s})},[]),k.useCallback(t=>{Ee(n=>{const s=new Set(n);return s.has(t)?s.delete(t):s.add(t),s})},[]);const H=t=>Number.isFinite(t)?t.toFixed(3).replace(/\.?0+$/,""):"",fe=(t,n)=>{const s=parseFloat(t);if(!Number.isFinite(s))return"";const d=n==="mm"?s/10:s;return H(d)},le=(t,n)=>{const s=typeof t=="number"?t:parseFloat(t);if(!Number.isFinite(s))return"";const d=n==="mm"?s*10:s;return H(d)},Q=k.useMemo(()=>Object.fromEntries(A.map(t=>[t.id,t.name])),[A]),se=k.useMemo(()=>Object.fromEntries(P.map(t=>[t.id,t.name])),[P]),Y=k.useMemo(()=>Object.fromEntries(O.map(t=>[t.id,t.name])),[O]),ne=k.useMemo(()=>({types:Object.fromEntries(B.types.map(t=>[t.id,t.name])),shapes:Object.fromEntries(B.shapes.map(t=>[t.id,t.name])),colors:Object.fromEntries(B.colors.map(t=>[t.id,t.name])),clarities:Object.fromEntries(B.clarities.map(t=>[t.id,t.name])),cuts:Object.fromEntries(B.cuts.map(t=>[t.id,t.name]))}),[B]);k.useCallback(t=>{if(!t)return"";const n=[];return t.weight&&n.push(`${t.weight} Ct`),t.shape_id&&n.push(ne.shapes[Number(t.shape_id)]??""),t.clarity_id&&n.push(ne.clarities[Number(t.clarity_id)]??""),t.color_id&&n.push(ne.colors[Number(t.color_id)]??""),n.filter(Boolean).join(" - ")},[ne]);const re=k.useCallback((t,n)=>{let s="";if(t.metals&&t.metals.length>0){const l=t.metals.filter(c=>c.metal_id!==""&&typeof c.metal_id=="number").map(c=>({metal_id:c.metal_id,metal_purity_id:c.metal_purity_id!==""&&c.metal_purity_id!==null?Number(c.metal_purity_id):null,metal_tone_id:c.metal_tone_id!==""&&c.metal_tone_id!==null?Number(c.metal_tone_id):null}));if(l.length===0)s="";else{const c=new Map;l.forEach(m=>{c.has(m.metal_id)||c.set(m.metal_id,[]),c.get(m.metal_id).push(m)});const h=[];c.forEach((m,v)=>{const u=Y[v]??"";if(!u)return;const M=new Set(m.map(S=>S.metal_purity_id).filter(Boolean)),E=new Set(m.map(S=>S.metal_tone_id).filter(Boolean));let z="";if(M.size>1&&E.size===1){const S=Array.from(E)[0],V=S?se[S]??"":"",p=Array.from(M).map(L=>L?Q[L]??"":"").filter(Boolean).sort();p.length>0?V?z=`${p.join(" + ")} ${V} ${u}`:z=`${p.join(" + ")} ${u}`:z=u}else if(E.size>1&&M.size===1){const S=Array.from(M)[0],V=S?Q[S]??"":"",p=Array.from(E).map(L=>L?se[L]??"":"").filter(Boolean).sort();p.length>0?V?z=`${V} ${p.join(" + ")} ${u}`:z=`${p.join(" + ")} ${u}`:z=V?`${V} ${u}`:u}else{const S=m[0],V=S.metal_purity_id,p=S.metal_tone_id,L=V?Q[V]??"":"",D=p?se[p]??"":"";L&&D?z=`${L} ${D} ${u}`:L?z=`${L} ${u}`:D?z=`${D} ${u}`:z=u}z&&h.push(z)}),s=h.join(" / ")}}else if(t.metal_id!==""&&typeof t.metal_id=="number"){const l=Y[t.metal_id]??"";if(t.metal_purity_id!==""&&typeof t.metal_purity_id=="number"){const c=Q[t.metal_purity_id]??"";s=c?`${c} ${l}`:l}else s=l}let d="";if(t.diamonds&&t.diamonds.length>0){const l=[];t.diamonds.forEach(c=>{if(c.diamond_id&&typeof c.diamond_id=="number"){const h=c.diamonds_count?` (${c.diamonds_count})`:"";l.push(`Diamond${h}`)}}),d=l.join(" / ")}const i=t.metadata??{},a=typeof i.size_value=="string"||typeof i.size_value=="number"?String(i.size_value):"";let _=(i.size_unit==="mm"||i.size_unit==="cm"?i.size_unit:"cm")||"cm",g="";a?g=H(Number(a)):t.size_cm&&(g=H(parseFloat(t.size_cm)),_="cm");const w=g?`${g}${_}`:"",y=[d,s,w].filter(Boolean),$=y.length?y.join(" / "):"Variant",q=s,U=d;let F=null;t.diamonds&&t.diamonds.length>0&&(F=t.diamonds.map(l=>({diamond_id:l.diamond_id!==""&&l.diamond_id!==null?Number(l.diamond_id):null,diamonds_count:l.diamonds_count?Number(l.diamonds_count):null})));const o={metal_id:t.metal_id!==""&&t.metal_id!==null?Number(t.metal_id):null,metal_purity_id:t.metal_purity_id!==""&&t.metal_purity_id!==null?Number(t.metal_purity_id):null,diamond_option_key:t.diamond_option_key??null,diamond:F,size_cm:t.size_cm?Number(t.size_cm):null,auto_label:$};g?(o.size_value=g,o.size_unit=_):(delete o.size_value,delete o.size_unit);const N=typeof i.status=="string"&&i.status.trim().length>0?String(i.status):void 0;return N?o.status=N:o.status="enabled",{autoLabel:$,metalTone:q,stoneQuality:U,sizeText:w,metadata:o}},[le,H,Y,Q,se]),K=k.useCallback(t=>(t.variants||[]).map((n,s)=>{const d=re(n,t),i=n.metadata?.auto_label??"",a=!n.label||n.label===i,r=n.metadata?.auto_sku??"",_=(t.sku??"").trim(),w=`${_?_.replace(/[^A-Za-z0-9]/g,"").toUpperCase():"SKU"}-${String(s+1).padStart(2,"0")}`,y=!n.sku||n.sku===r;return{...n,sku:y?w:n.sku,label:a?d.autoLabel:n.label,metadata:{...d.metadata,auto_sku:w},is_default:n.is_default??s===0}}),[re]),Ve=k.useMemo(()=>{const t=x.metal_ids||[];return t.length===0?A||[]:(A||[]).filter(n=>t.includes(n.metal_id))},[x.metal_ids,A]),Ae=k.useMemo(()=>{const t=x.metal_ids||[];return t.length===0?P||[]:(P||[]).filter(n=>t.includes(n.metal_id))},[x.metal_ids,P]);k.useMemo(()=>[],[]),k.useMemo(()=>[],[]),k.useMemo(()=>[],[]),k.useMemo(()=>({}),[]);const Pe=t=>{j(n=>({...n,is_variant_product:t}))},Te=t=>{},ge=t=>{j(n=>{if(n.size_unit===t)return n;const s=(n.size_values||[]).map(i=>{const a=fe(i,n.size_unit||"cm");return a?le(a,t):i}),d={...n,size_unit:t,size_values:s,variants:(n.variants||[]).map(i=>{if(!i.size_cm)return{...i,metadata:{...i.metadata??{},size_unit:t}};const a={...i.metadata??{}},r=le(i.size_cm,t);return r?(a.size_value=r,a.size_unit=t):(delete a.size_value,a.size_unit=t),{...i,metadata:a}})};return d.variants=K(d),d})},qe=()=>{const t=_e.trim();if(!t)return;const n=parseFloat(t);if(!Number.isFinite(n)||n<=0)return;const s=H(n);j(d=>{if((d.size_values||[]).includes(s))return d;const i={...d,size_values:[...d.size_values||[],s]};return i.variants=K(i),i}),he("")},Be=t=>{j(n=>{const s={...n,size_values:(n.size_values||[]).filter(d=>d!==t)};return s.variants=K(s),s})},Ue=t=>{j(n=>{const s=n.metal_ids||[],i=s.includes(t)?s.filter(g=>g!==t):[...s,t],a=A.filter(g=>g.metal_id===t).map(g=>g.id),r=P.filter(g=>g.metal_id===t).map(g=>g.id),_={...n,metal_ids:i,metal_purity_ids:(n.metal_purity_ids||[]).filter(g=>!a.includes(g)),metal_tone_ids:(n.metal_tone_ids||[]).filter(g=>!r.includes(g)),metal_mix_mode:n.metal_mix_mode};return _.variants=K(_),_})},Fe=t=>{j(n=>{const s=n.metal_purity_ids||[],i=s.includes(t)?s.filter(a=>a!==t):[...s,t];return{...n,metal_purity_ids:i}})},Re=t=>{j(n=>{const s=n.metal_tone_ids||[],i=s.includes(t)?s.filter(a=>a!==t):[...s,t];return{...n,metal_tone_ids:i}})},We=()=>{j(t=>{const n=t.diamond_selections||[];return{...t,diamond_selections:[...n,{diamond_id:"",count:""}]}})},Ke=t=>{j(n=>{const s=n.diamond_selections||[];return{...n,diamond_selections:s.filter((d,i)=>i!==t)}})},be=(t,n,s)=>{j(d=>{const a=(d.diamond_selections||[]).map((r,_)=>_!==t?r:{...r,[n]:s});return{...d,diamond_selections:a}})},Oe=()=>{j(t=>{const n=t.colorstone_selections||[];return{...t,colorstone_selections:[...n,{colorstone_id:"",count:""}]}})},He=t=>{j(n=>{const s=n.colorstone_selections||[];return{...n,colorstone_selections:s.filter((d,i)=>i!==t)}})},ye=(t,n,s)=>{j(d=>{const a=(d.colorstone_selections||[]).map((r,_)=>_!==t?r:{...r,[n]:s});return{...d,colorstone_selections:a}})},Ge=t=>{j(n=>{if((n.variants||[]).length===1)return n;const s=(n.variants||[]).filter((i,a)=>a!==t);s.every(i=>!i.is_default)&&s.length>0&&(s[0].is_default=!0);const d={...n,variants:s};return d.variants=K(d),d})},ie=(t,n,s)=>{j(d=>{const i=(d.variants||[]).map((r,_)=>{if(_!==t)return r;const g={...r};switch(n){case"is_default":typeof s=="boolean"&&(g.is_default=s);break;case"metal_id":(s===""||typeof s=="number")&&(g.metal_id=s,(s===""||typeof s!="number")&&(g.metal_purity_id=""));break;case"metal_purity_id":(s===""||typeof s=="number")&&(g.metal_purity_id=s);break;case"diamond_option_key":g.diamond_option_key=s?String(s):null;break;case"size_cm":typeof s=="string"&&(g.size_cm=s);break;case"price_adjustment":typeof s=="string"&&(g.price_adjustment=s);break;case"sku":case"label":typeof s=="string"&&(g[n]=s);break;case"total_weight":s===""||s===null?g[n]="":(typeof s=="string"||typeof s=="number")&&(g[n]=s);break;case"inventory_quantity":if(s===""||s===null)g[n]=0;else if(typeof s=="string"){const w=parseInt(s,10);g[n]=isNaN(w)?0:w}else typeof s=="number"&&(g[n]=s);break}return g}),a={...d,variants:i};return a.variants=K(a),a})},Ie=(t,n)=>{j(s=>{const d=(s.variants||[]).map((a,r)=>{if(r!==t)return a;const _={...a.metadata??{}};return Object.entries(n).forEach(([g,w])=>{w===null?delete _[g]:_[g]=w}),{...a,metadata:_}}),i={...s,variants:d};return i.variants=K(i),i})},Ze=t=>{j(n=>({...n,variants:(n.variants||[]).map((s,d)=>({...s,is_default:d===t}))}))},Qe=t=>{j(n=>{const s=(n.variants||[]).map((d,i)=>{if(i!==t)return d;const a=d.diamonds||[];return{...d,diamonds:[...a,ct()]}});return{...n,variants:s}})},Ye=(t,n)=>{j(s=>{const d=(s.variants||[]).map((i,a)=>{if(a!==t)return i;const r=i.diamonds||[];return{...i,diamonds:r.filter((_,g)=>g!==n)}});return{...s,variants:d}})},de=(t,n,s,d)=>{j(i=>{const a=(i.variants||[]).map((r,_)=>{if(_!==t)return r;const w=(r.diamonds||[]).map((y,$)=>$!==n?y:{...y,[s]:d});return{...r,diamonds:w}});return{...i,variants:a}})},je=(t,n,s,d)=>{j(i=>{const a=(i.variants||[]).map((r,_)=>{if(_!==t)return r;const w=(r.metals||[]).map((y,$)=>$!==n?y:{...y,[s]:d});return{...r,metals:w}});return{...i,variants:a}})},Je=(t,n,s,d)=>{j(i=>{const a=(i.variants||[]).map((r,_)=>{if(_!==t)return r;const w=(r.colorstones||[]).map((y,$)=>$!==n?y:{...y,[s]:d});return{...r,colorstones:w}});return{...i,variants:a}})},Xe=t=>{const n=new Map;(t.metal_ids||[]).length>0&&(t.metal_purity_ids||[]).length>0&&(t.metal_purity_ids||[]).forEach(l=>{const c=A.find(h=>h.id===l);c&&(t.metal_ids||[]).includes(c.metal_id)&&(n.has(c.metal_id)||n.set(c.metal_id,[]),n.get(c.metal_id).push(l))});const s=new Map;(t.metal_ids||[]).length>0&&(t.metal_tone_ids||[]).length>0&&(t.metal_tone_ids||[]).forEach(l=>{const c=P.find(h=>h.id===l);c&&(t.metal_ids||[]).includes(c.metal_id)&&(s.has(c.metal_id)||s.set(c.metal_id,[]),s.get(c.metal_id).push(l))});const d=(l,c,h,m)=>{const v=[];return c.length===0&&h.length===0?[[{metal_id:l,metal_purity_id:null,metal_tone_id:null}]]:h.length===0&&c.length>0?c.map(u=>[{metal_id:l,metal_purity_id:u,metal_tone_id:null}]):c.length===0&&h.length>0?h.map(u=>[{metal_id:l,metal_purity_id:null,metal_tone_id:u}]):(m==="normal"?c.forEach(u=>{h.forEach(M=>{v.push([{metal_id:l,metal_purity_id:u,metal_tone_id:M}])})}):m==="mix_tones"?c.forEach(u=>{v.push(h.map(M=>({metal_id:l,metal_purity_id:u,metal_tone_id:M})))}):m==="mix_purities"&&h.forEach(u=>{v.push(c.map(M=>({metal_id:l,metal_purity_id:M,metal_tone_id:u})))}),v)},i=new Map;(t.metal_ids||[]).forEach(l=>{const c=n.get(l)||[],h=s.get(l)||[];let m="normal";if(t.metal_mix_mode){const u=t.metal_mix_mode[l];if(m=u==="normal"||u==="mix_tones"||u==="mix_purities"?u:m,m==="normal"){const M=t.metal_mix_mode[String(l)];m=M==="normal"||M==="mix_tones"||M==="mix_purities"?M:m}m==="normal"&&Object.keys(t.metal_mix_mode).forEach(M=>{const E=Number(M);if(E===l){const z=t.metal_mix_mode?.[E];(z==="normal"||z==="mix_tones"||z==="mix_purities")&&(m=z)}})}const v=d(l,c,h,m);i.set(l,v)});const a=[];if((t.metal_ids||[]).length>0){const l=m=>{if(m.length===0)return[[]];if(m.length===1)return m[0].map(z=>[z]);const[v,...u]=m,M=l(u),E=[];for(const z of v)for(const S of M)E.push([z,...S]);return E},c=(t.metal_ids||[]).map(m=>i.get(m)||[]),h=l(c);a.push(...h.map(m=>m.flat()))}const r=[];t.uses_diamond&&(t.diamond_options||[]).length>0?(t.diamond_options||[]).forEach(l=>{r.push({key:l.key,clarity_id:l.clarity_id!==""?Number(l.clarity_id):null,color_id:l.color_id!==""?Number(l.color_id):null,shape_id:l.shape_id!==""?Number(l.shape_id):null})}):r.push({key:"",clarity_id:null,color_id:null,shape_id:null});const _=t.size_dimension_enabled&&(t.size_values||[]).length>0?t.size_values||[]:[null],g=t.size_dimension_enabled&&(_||[]).length>0&&(_||[])[0]!==null,w=t.uses_diamond&&r.length>0&&r[0].key!=="",y=t.diamond_mixing_mode||"shared",$=w&&y==="as_variant";if(a.length===0&&!g&&!$)return t;const q=[],U=[];if(a.length>0?a.forEach(l=>{(_||[]).forEach(c=>{U.push({metals:l,size:c??null})})}):g?_.forEach(l=>{U.push({metals:[],size:l??null})}):U.push({metals:[],size:null}),y==="shared"){const l=w?r[0]:{key:"",clarity_id:null,color_id:null,shape_id:null};U.forEach(c=>{q.push({metals:c.metals,diamond:l,size:c.size})})}else U.forEach(l=>{w?r.forEach(c=>{q.push({metals:l.metals,diamond:c,size:l.size})}):q.push({metals:l.metals,diamond:{key:"",clarity_id:null,color_id:null,shape_id:null},size:l.size})});if(q.length===0)return t;const F=new Map;(t.variants||[]).forEach(l=>{if(!l.metals||l.metals.length===0)return;const c=l.size_cm||"no-size",h=l.diamond_option_key||"no-diamond",v=`${l.metals.filter(u=>u.metal_id!==""&&typeof u.metal_id=="number").map(u=>`${u.metal_id}-${u.metal_purity_id||"null"}-${u.metal_tone_id||"null"}`).sort().join("|")}::${c}::${h}`;F.set(v,{metals:l.metals.map(u=>({metal_id:typeof u.metal_id=="number"?u.metal_id:0,metal_purity_id:u.metal_purity_id!==""&&u.metal_purity_id!==null?typeof u.metal_purity_id=="number"?u.metal_purity_id:Number(u.metal_purity_id):null,metal_tone_id:u.metal_tone_id!==""&&u.metal_tone_id!==null?typeof u.metal_tone_id=="number"?u.metal_tone_id:Number(u.metal_tone_id):null,metal_weight:u.metal_weight||""})),diamonds:(l.diamonds||[]).map(u=>({diamond_id:u.diamond_id!==""&&u.diamond_id!==null?typeof u.diamond_id=="number"?u.diamond_id:Number(u.diamond_id):null,diamonds_count:u.diamonds_count||""}))})});const o=q.map((l,c)=>{const h=ce(c===0),m=l.size||"no-size",v=l.diamond.key||"no-diamond",M=`${l.metals.map(p=>`${p.metal_id}-${p.metal_purity_id||"null"}-${p.metal_tone_id||"null"}`).sort().join("|")}::${m}::${v}`,E=F.get(M);if(h.metals=l.metals.map(p=>{const L=E?.metals.find(D=>D.metal_id===p.metal_id&&D.metal_purity_id===(p.metal_purity_id??null)&&D.metal_tone_id===(p.metal_tone_id??null));return{id:void 0,metal_id:p.metal_id,metal_purity_id:p.metal_purity_id??"",metal_tone_id:p.metal_tone_id??"",metal_weight:L?.metal_weight||""}}),l.metals.length>0){const p=l.metals[0];h.metal_id=p.metal_id,p.metal_purity_id!==null&&(h.metal_purity_id=p.metal_purity_id)}(t.diamond_mixing_mode||"shared")==="shared"?t.diamond_selections&&t.diamond_selections.length>0?(h.diamonds=t.diamond_selections.filter(p=>p.diamond_id!==""&&p.diamond_id!==null).map(p=>{const L=E?.diamonds.find(D=>D.diamond_id===(typeof p.diamond_id=="number"?p.diamond_id:Number(p.diamond_id)));return{id:L?.id,diamond_id:typeof p.diamond_id=="number"?p.diamond_id:Number(p.diamond_id),diamonds_count:L?.diamonds_count||p.count||""}}),h.diamond_option_key=null):(h.diamond_option_key=null,h.diamonds=[]):(h.diamond_option_key=null,(t.diamond_selections||[]).length>0?h.diamonds=(t.diamond_selections||[]).map(p=>{const L=E?.diamonds.find(D=>D.diamond_id===(p.diamond_id!==""&&p.diamond_id!==null?typeof p.diamond_id=="number"?p.diamond_id:Number(p.diamond_id):null));return{id:void 0,diamond_id:p.diamond_id!==""&&p.diamond_id!==null?typeof p.diamond_id=="number"?p.diamond_id:Number(p.diamond_id):"",diamonds_count:L?.diamonds_count||p.count||""}}):h.diamonds=[]);const S={...h.metadata??{},status:"enabled"};if(l.size){const p=fe(l.size,t.size_unit||"cm");h.size_cm=p,S.size_value=l.size,S.size_unit=t.size_unit}else delete S.size_value,delete S.size_unit;const V=t.diamond_mixing_mode||"shared";return h.diamond_option_key&&(S.diamond_option_key=h.diamond_option_key,V==="as_variant"&&(S.diamond={clarity_id:l.diamond.clarity_id,color_id:l.diamond.color_id,shape_id:l.diamond.shape_id})),t.colorstone_selections&&t.colorstone_selections.length>0?h.colorstones=t.colorstone_selections.filter(p=>p.colorstone_id!==""&&p.colorstone_id!==null).map(p=>{const D=(t.variants||[]).find(ae=>ae.colorstones&&ae.colorstones.length>0)?.colorstones?.find(ae=>ae.colorstone_id===(typeof p.colorstone_id=="number"?p.colorstone_id:Number(p.colorstone_id)));return{id:D?.id,colorstone_id:typeof p.colorstone_id=="number"?p.colorstone_id:Number(p.colorstone_id),stones_count:D?.stones_count||p.count||""}}):h.colorstones=[],h.metadata=S,h}),N={...t,variants:o,metal_mix_mode:t.metal_mix_mode||{}};return N.variants=K(N),N},Ne=()=>{j(t=>Xe(t))},et=t=>{t.preventDefault();const n=(ee.data.media_uploads?.length??0)>0;ee.transform(d=>{const i=d,a={...i};i.media_uploads&&Array.isArray(i.media_uploads)&&i.media_uploads.length>0&&(a.media_uploads=i.media_uploads),a.sku=i.sku||"",a.name=i.name||"",a.titleline=i.titleline||null,a.collection=i.collection||null,a.producttype=i.producttype||null,a.gender=i.gender||null,a.description=i.description||"";const r=i.brand_id;if(r!==""&&r!==null&&r!==void 0){const y=Number(r);a.brand_id=isNaN(y)?null:y}else a.brand_id=null;const _=i.category_id;if(_!==""&&_!==null&&_!==void 0){const y=Number(_);a.category_id=isNaN(y)?null:y}else a.category_id=null;const g=i.making_charge;if(g===""||g===null||g===void 0)a.making_charge=0;else{const y=Number(g);a.making_charge=isNaN(y)?0:y}const w=y=>y==null||y===""?null:typeof y=="number"?y:Number(y);return a.making_charge_discount_type=i.making_charge_discount_type||null,a.making_charge_discount_value=i.making_charge_discount_type?w(i.making_charge_discount_value):null,a.making_charge_discount_overrides=i.making_charge_discount_overrides.map(y=>({customer_group_id:y.customer_group_id!==""?Number(y.customer_group_id):null,type:y.type,value:w(y.value)})).filter(y=>y.customer_group_id!==null&&y.value!==null),a.is_active=i.is_active??!0,delete a.metadata,(!a.media_uploads||Array.isArray(a.media_uploads)&&a.media_uploads.length===0)&&delete a.media_uploads,(!a.removed_media_ids||Array.isArray(a.removed_media_ids)&&a.removed_media_ids.length===0)&&delete a.removed_media_ids,a.sku||(a.sku=""),a.name||(a.name=""),a.brand_id===void 0&&(a.brand_id=null),a.category_id===void 0&&(a.category_id=null),a.making_charge===void 0&&(a.making_charge=0),i.variants&&Array.isArray(i.variants)?a.variants=i.variants:a.variants=[],i.variant_options!==void 0&&(a.variant_options=i.variant_options),i.metal_ids!==void 0&&(a.metal_ids=i.metal_ids),i.metal_purity_ids!==void 0&&(a.metal_purity_ids=i.metal_purity_ids),i.metal_tone_ids!==void 0&&(a.metal_tone_ids=i.metal_tone_ids),i.diamond_selections!==void 0&&(a.diamond_selections=i.diamond_selections),i.colorstone_selections!==void 0&&(a.colorstone_selections=i.colorstone_selections),b?.id&&n&&(a._method="PUT"),a});const s={preserveScroll:!0,forceFormData:n,onFinish:()=>{ee.transform(d=>d)}};b?.id?n?me(route("admin.products.update",b.id),s):ze(route("admin.products.update",b.id),s):me(route("admin.products.store"),s)},ve=f.variants,ke=k.useMemo(()=>Object.entries(f??{}).filter(([t])=>t.startsWith("media_uploads")).map(([,t])=>t),[f]),we=k.useMemo(()=>b?.media?[...b.media].sort((t,n)=>t.position-n.position):[],[b?.media]),tt=t=>{const n=x.removed_media_ids??[],d=n.includes(t)?n.filter(i=>i!==t):[...n,t];j("removed_media_ids",d)},st=t=>{const n=t.target.files?Array.from(t.target.files):[];n.length!==0&&(j("media_uploads",[...x.media_uploads??[],...n]),t.target.value="")},nt=t=>{j("media_uploads",(x.media_uploads??[]).filter((n,s)=>s!==t))},Ce=t=>(x.removed_media_ids??[]).includes(t);return e.jsxs(rt,{children:[e.jsx(ot,{title:b?.id?`Edit ${b.name}`:"New Product"}),e.jsxs("form",{onSubmit:et,className:"space-y-10",children:[e.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-xl shadow-slate-900/10",children:[e.jsxs("div",{className:"flex flex-col gap-4 border-b border-slate-100 pb-6 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:b?.id?"Update product":"Create product"}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Define product master information and atelier references."})]}),e.jsx("button",{type:"submit",disabled:ue,className:"inline-flex items-center gap-2 rounded-full bg-slate-900 px-5 py-2 text-sm font-semibold text-white shadow-lg shadow-slate-900/20 transition hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",children:ue?"Saving…":b?.id?"Save changes":"Create product"})]}),e.jsx("div",{className:"mt-6 space-y-6",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"SKU *"}),e.jsx("input",{type:"text",value:x.sku,onChange:t=>j("sku",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),f.sku&&e.jsx("span",{className:"text-xs text-rose-500",children:f.sku})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Product name *"}),e.jsx("input",{type:"text",value:x.name,onChange:t=>j("name",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),f.name&&e.jsx("span",{className:"text-xs text-rose-500",children:f.name})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Title Line *"}),e.jsx("input",{type:"text",value:x.titleline,onChange:t=>j("titleline",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Enter product title line"}),f.titleline&&e.jsx("span",{className:"text-xs text-rose-500",children:f.titleline})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Brand *"}),e.jsxs("select",{value:x.brand_id,onChange:t=>j("brand_id",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[e.jsx("option",{value:"",children:"Select brand"}),Object.entries(J).map(([t,n])=>e.jsx("option",{value:t,children:n},t))]}),f.brand_id&&e.jsx("span",{className:"text-xs text-rose-500",children:f.brand_id})]}),e.jsx(mt,{catalogs:R,selectedIds:Array.isArray(x.catalog_ids)?x.catalog_ids:[],onChange:t=>j("catalog_ids",t),error:f.catalog_ids})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Category *"}),e.jsxs("select",{value:x.category_id,onChange:t=>j("category_id",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[e.jsx("option",{value:"",children:"Select category"}),Object.entries(X).map(([t,n])=>e.jsx("option",{value:t,children:n},t))]}),f.category_id&&e.jsx("span",{className:"text-xs text-rose-500",children:f.category_id})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Collection *"}),e.jsx("input",{type:"text",value:x.collection,onChange:t=>j("collection",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Enter collection name"}),f.collection&&e.jsx("span",{className:"text-xs text-rose-500",children:f.collection})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Product Type *"}),e.jsx("input",{type:"text",value:x.producttype,onChange:t=>j("producttype",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Enter product type"}),f.producttype&&e.jsx("span",{className:"text-xs text-rose-500",children:f.producttype})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Gender *"}),e.jsxs("select",{value:x.gender,onChange:t=>j("gender",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[e.jsx("option",{value:"",children:"Select gender"}),e.jsx("option",{value:"Men",children:"Men"}),e.jsx("option",{value:"Women",children:"Women"}),e.jsx("option",{value:"Unisex",children:"Unisex"}),e.jsx("option",{value:"Kids",children:"Kids"})]}),f.gender&&e.jsx("span",{className:"text-xs text-rose-500",children:f.gender})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Making charge (₹) *"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:x.making_charge,onChange:t=>j("making_charge",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),f.making_charge&&e.jsx("span",{className:"text-xs text-rose-500",children:f.making_charge})]})]})]})})]}),e.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-xl shadow-slate-900/10",children:[e.jsx("div",{className:"flex flex-col gap-3 border-b border-slate-100 pb-4 lg:flex-row lg:items-center lg:justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Product description"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Provide merchandising copy, craftsmanship details, and any atelier notes for this SKU."})]})}),e.jsxs("div",{className:"mt-6",children:[e.jsx(lt,{value:xe,onChange:Se,className:"overflow-hidden rounded-3xl border border-slate-200",placeholder:"Detail the design notes, materials, finish, and atelier craftsmanship."}),f.description&&e.jsx("span",{className:"mt-2 block text-xs text-rose-500",children:f.description})]})]}),e.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-xl shadow-slate-900/10",children:[e.jsx("div",{className:"flex flex-col gap-4 border-b border-slate-100 pb-4 lg:flex-row lg:items-center lg:justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Product media"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Upload product images or videos for catalogue displays. You can also remove outdated media assets."})]})}),e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-[0.3em] text-slate-400",children:"Current media"}),e.jsx("div",{className:"mt-3 grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:we.length>0?we.map(t=>e.jsxs("div",{className:`relative overflow-hidden rounded-3xl border border-slate-200 bg-slate-50 shadow-sm transition ${Ce(t.id)?"opacity-50 ring-2 ring-rose-200":""}`,children:[t.type==="video"?e.jsx("video",{src:t.url,className:"h-48 w-full rounded-t-3xl bg-black object-cover",controls:!0,onError:n=>{console.error("Video load error:",t.url),n.target.style.display="none"},children:"Your browser does not support the video tag."}):e.jsx("img",{src:t.url,alt:"Product media",className:"h-48 w-full rounded-t-3xl object-cover",onError:n=>{console.error("Image load error:",t.url),n.target.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="400" height="300"%3E%3Crect fill="%23ddd" width="400" height="300"/%3E%3Ctext fill="%23999" font-family="sans-serif" font-size="18" x="50%25" y="50%25" text-anchor="middle" dy=".3em"%3EImage not found%3C/text%3E%3C/svg%3E'}}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 text-xs text-slate-500",children:[e.jsx("span",{className:"rounded-full bg-white/70 px-3 py-1 font-semibold text-slate-700",children:t.type.toUpperCase()}),e.jsx("button",{type:"button",onClick:()=>tt(t.id),className:"text-rose-500 transition hover:text-rose-600",children:Ce(t.id)?"Undo removal":"Remove"})]})]},t.id)):e.jsx("p",{className:"rounded-2xl border border-dashed border-slate-200 px-4 py-6 text-sm text-slate-500",children:"No media uploaded yet."})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-[0.3em] text-slate-400",children:"Upload new files"}),e.jsxs("label",{className:"mt-3 flex cursor-pointer flex-col items-center justify-center gap-3 rounded-3xl border border-dashed border-slate-300 bg-slate-50 px-6 py-10 text-center text-slate-500 transition hover:border-slate-400 hover:bg-slate-100",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-slate-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 15a4 4 0 014-4h10a4 4 0 014 4v3a2 2 0 01-2 2H5a2 2 0 01-2-2v-3z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 10l5-5m0 0l5 5m-5-5v12"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-700",children:"Click to upload"}),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"JPEG, PNG, WebP, MP4 up to 50MB each."})]}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:st,className:"hidden"})]}),ke.length>0&&e.jsx("ul",{className:"mt-3 space-y-1",children:ke.map((t,n)=>e.jsx("li",{className:"text-xs text-rose-500",children:t},`${n}-${t}`))}),(x.media_uploads??[]).length>0&&e.jsx("ul",{className:"mt-4 space-y-2",children:(x.media_uploads??[]).map((t,n)=>e.jsxs("li",{className:"flex items-center justify-between rounded-2xl border border-slate-200 px-4 py-2 text-sm text-slate-600",children:[e.jsx("span",{className:"truncate",children:t.name}),e.jsx("button",{type:"button",onClick:()=>nt(n),className:"text-rose-500 transition hover:text-rose-600",children:"Remove"})]},`${t.name}-${n}`))})]})]})]}),e.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-xl shadow-slate-900/10",children:[e.jsxs("div",{className:"flex flex-col gap-3 border-b border-slate-100 pb-4 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Variant configuration"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Decide whether this product uses a single price or multiple combinations across metals and diamonds."})]}),e.jsxs("label",{className:"inline-flex items-center gap-3 rounded-2xl border border-slate-200 px-4 py-3 text-sm text-slate-600",children:[e.jsx("input",{type:"checkbox",checked:x.is_variant_product??!0,onChange:t=>Pe(t.target.checked),className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500"}),"Variant product (multi-option catalogue)"]})]}),x.is_variant_product?e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900 mb-2",children:"Variant Configuration Options"}),e.jsx("p",{className:"text-xs text-slate-600 mb-4",children:"Use the configuration buttons in the variant table below to add metals (with purity and tone), diamonds, and colorstones to each variant."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-sky-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 13h8l-4-4m0 8l4-4"})}),e.jsx("span",{className:"text-slate-700",children:"Configure Metals"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-sky-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{className:"text-slate-700",children:"Configure Diamonds"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-sky-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{className:"text-slate-700",children:"Configure Colorstones"})]})]})]}),e.jsxs("div",{className:"space-y-4 rounded-2xl border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-[0.3em] text-slate-500",children:"Size dimension"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Maintain consistent size data across variants. Add numeric values and choose the preferred unit."})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-slate-600",children:[e.jsx("input",{type:"checkbox",checked:x.size_dimension_enabled,onChange:t=>Te(t.target.checked),className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500"}),"Use size dimension"]})]}),x.size_dimension_enabled&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:[e.jsx("span",{children:"Unit"}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-slate-600",children:[e.jsx("input",{type:"radio",name:"size-unit",value:"mm",checked:x.size_unit==="mm",onChange:()=>ge("mm"),className:"h-4 w-4 border-slate-300 text-sky-600 focus:ring-sky-500"}),"Millimetres (mm)"]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-slate-600",children:[e.jsx("input",{type:"radio",name:"size-unit",value:"cm",checked:x.size_unit==="cm",onChange:()=>ge("cm"),className:"h-4 w-4 border-slate-300 text-sky-600 focus:ring-sky-500"}),"Centimetres (cm)"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",step:"0.001",min:"0",value:_e,onChange:t=>he(t.target.value),className:"w-24 rounded-2xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:`e.g. 25${x.size_unit}`}),e.jsx("button",{type:"button",onClick:qe,className:"inline-flex items-center gap-2 rounded-full border border-slate-300 px-4 py-1.5 text-xs font-semibold uppercase tracking-[0.2em] text-slate-600 transition hover:border-slate-400 hover:text-slate-900",children:"Add size"})]}),(x.size_values||[]).length===0&&e.jsx("span",{className:"text-xs text-slate-400",children:"Add at least one size value to use in the variant matrix."})]}),(x.size_values||[]).length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:(x.size_values||[]).map(t=>e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-slate-300 bg-slate-50 px-3 py-1 text-xs font-semibold text-slate-600",children:[t,x.size_unit,e.jsx("button",{type:"button",onClick:()=>Be(t),className:"text-rose-500 transition hover:text-rose-600","aria-label":`Remove size ${t}${x.size_unit}`,children:"×"})]},`${t}-${x.size_unit}`))})]})]}),e.jsxs("div",{className:"space-y-4 rounded-2xl border border-slate-200 p-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-[0.3em] text-slate-500",children:"Metals"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Select metals that can be used in your product variants."})]}),O.length>0?e.jsx("div",{className:"flex flex-wrap gap-3",children:O.map(t=>{const n=(x.metal_ids||[]).includes(t.id);return e.jsxs("label",{className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-semibold transition ${n?"border-sky-400 bg-white text-sky-700":"border-slate-200 bg-white text-slate-600 hover:border-slate-300"}`,children:[e.jsx("input",{type:"checkbox",checked:n,onChange:()=>Ue(t.id),className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500"}),t.name]},t.id)})}):e.jsx("p",{className:"text-xs text-slate-400",children:"No metals available yet."})]}),(x.metal_ids||[]).length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:O.filter(t=>(x.metal_ids||[]).includes(t.id)).map(t=>{const n=Ve.filter(r=>r.metal_id===t.id),s=Ae.filter(r=>r.metal_id===t.id),d=n.filter(r=>(x.metal_purity_ids||[]).includes(r.id)),i=s.filter(r=>(x.metal_tone_ids||[]).includes(r.id)),a=d.length>0&&i.length>0?d.length*i.length:d.length>0?d.length:i.length>0?i.length:0;return e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between border-b border-slate-100 pb-3",children:[e.jsxs("h3",{className:"text-base font-semibold text-slate-900",children:["Metal: ",t.name]}),a>0&&e.jsxs("span",{className:"rounded-full bg-sky-50 px-3 py-1 text-xs font-semibold text-sky-700",children:[a," variant",a!==1?"s":""," for this metal"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-slate-600",children:"Purities for this metal"}),n.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(r=>{const _=(x.metal_purity_ids||[]).includes(r.id);return e.jsxs("label",{className:`inline-flex cursor-pointer items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold transition ${_?"border-sky-400 bg-sky-50 text-sky-700 shadow-sm":"border-slate-200 bg-white text-slate-600 hover:border-slate-300 hover:bg-slate-50"}`,children:[e.jsx("input",{type:"checkbox",checked:_,onChange:()=>Fe(r.id),className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500"}),r.name]},r.id)})}):e.jsxs("p",{className:"text-xs text-slate-400",children:["No purities available for ",t.name,"."]}),e.jsxs("p",{className:"mt-2 text-xs text-slate-500",children:["Choose all purities in which this design is available for ",t.name,"."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-xs font-semibold text-slate-600",children:"Tones for this metal"}),s.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(r=>{const _=(x.metal_tone_ids||[]).includes(r.id);return e.jsxs("label",{className:`inline-flex cursor-pointer items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold transition ${_?"border-sky-400 bg-sky-50 text-sky-700 shadow-sm":"border-slate-200 bg-white text-slate-600 hover:border-slate-300 hover:bg-slate-50"}`,children:[e.jsx("input",{type:"checkbox",checked:_,onChange:()=>Re(r.id),className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500"}),r.name]},r.id)})}):e.jsxs("p",{className:"text-xs text-slate-400",children:["No tones available for ",t.name,"."]}),e.jsxs("p",{className:"mt-2 text-xs text-slate-500",children:["Choose all tones in which this design is available for ",t.name,"."]})]})]})]},t.id)})}),(x.metal_ids||[]).length>0&&e.jsx("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-700",children:"Preview generated variants"}),e.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["This setup will generate approximately ",e.jsx("span",{className:"font-semibold text-slate-900",children:(x.variants||[]).length})," variant",(x.variants||[]).length!==1?"s":""," based on your current configuration."]})]}),e.jsx("button",{type:"button",onClick:Ne,className:"rounded-full border border-slate-300 bg-white px-4 py-2 text-xs font-semibold text-slate-700 transition hover:border-slate-400 hover:bg-slate-50",children:"Regenerate matrix"})]})})]}),e.jsxs("div",{className:"space-y-4 rounded-2xl border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-[0.3em] text-slate-500",children:"Diamonds"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Select diamonds and specify counts for your product variants."})]}),e.jsxs("button",{type:"button",onClick:We,className:"inline-flex items-center gap-2 rounded-full border border-slate-300 bg-white px-3 py-1.5 text-xs font-semibold text-slate-700 transition hover:border-sky-400 hover:bg-sky-50",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 5v14M5 12h14"})}),"Add Diamond"]})]}),(x.diamond_selections||[]).length>0?e.jsx("div",{className:"space-y-3",children:(x.diamond_selections||[]).map((t,n)=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border border-slate-200 bg-white p-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"mb-1 block text-xs font-semibold text-slate-600",children:"Diamond"}),e.jsxs("select",{value:t.diamond_id===""?"":t.diamond_id,onChange:s=>be(n,"diamond_id",s.target.value===""?"":Number(s.target.value)),className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[e.jsx("option",{value:"",children:"Select diamond"}),I.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"w-32",children:[e.jsx("label",{className:"mb-1 block text-xs font-semibold text-slate-600",children:"Count"}),e.jsx("input",{type:"number",min:"0",step:"1",value:t.count,onChange:s=>be(n,"count",s.target.value),className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"0"})]}),e.jsx("button",{type:"button",onClick:()=>Ke(n),className:"mt-6 rounded-full border border-rose-200 p-2 text-rose-600 transition hover:border-rose-300 hover:text-rose-700","aria-label":"Remove diamond",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]},n))}):e.jsx("p",{className:"text-xs text-slate-400",children:'No diamonds added. Click "Add Diamond" to add one.'})]}),e.jsxs("div",{className:"space-y-4 rounded-2xl border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-[0.3em] text-slate-500",children:"Colorstones"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Select colorstones and specify counts for your product variants."})]}),e.jsxs("button",{type:"button",onClick:Oe,className:"inline-flex items-center gap-2 rounded-full border border-slate-300 bg-white px-3 py-1.5 text-xs font-semibold text-slate-700 transition hover:border-sky-400 hover:bg-sky-50",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 5v14M5 12h14"})}),"Add Colorstone"]})]}),(x.colorstone_selections||[]).length>0?e.jsx("div",{className:"space-y-3",children:(x.colorstone_selections||[]).map((t,n)=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border border-slate-200 bg-white p-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"mb-1 block text-xs font-semibold text-slate-600",children:"Colorstone"}),e.jsxs("select",{value:t.colorstone_id===""?"":t.colorstone_id,onChange:s=>ye(n,"colorstone_id",s.target.value===""?"":Number(s.target.value)),className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[e.jsx("option",{value:"",children:"Select colorstone"}),Z.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"w-32",children:[e.jsx("label",{className:"mb-1 block text-xs font-semibold text-slate-600",children:"Count"}),e.jsx("input",{type:"number",min:"0",step:"1",value:t.count,onChange:s=>ye(n,"count",s.target.value),className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"0"})]}),e.jsx("button",{type:"button",onClick:()=>He(n),className:"mt-6 rounded-full border border-rose-200 p-2 text-rose-600 transition hover:border-rose-300 hover:text-rose-700","aria-label":"Remove colorstone",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]},n))}):e.jsx("p",{className:"text-xs text-slate-400",children:'No colorstones added. Click "Add Colorstone" to add one.'})]})]}):e.jsx("p",{className:"mt-6 rounded-2xl border border-dashed border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-600",children:"Variants are disabled. Customers will see the making charge defined above."})]}),e.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-xl shadow-slate-900/10 ring-1 ring-slate-200/80",children:[e.jsxs("div",{className:"flex flex-col gap-4 border-b border-slate-200 pb-6 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Variant Matrix"}),e.jsx("p",{className:"mt-2 text-sm text-slate-500",children:"Configure product variants with metals, diamonds, and colorstones. The default variant powers the customer catalogue card pricing."})]}),e.jsxs("button",{type:"button",onClick:Ne,className:"inline-flex items-center gap-2 rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-lg shadow-slate-900/20 transition hover:bg-slate-700",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h7"})}),"Generate Matrix"]})]}),ve&&e.jsx("div",{className:"mt-6 rounded-2xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-600 ring-1 ring-rose-200/50",children:ve}),e.jsx("div",{className:"mt-8 overflow-hidden rounded-3xl bg-white shadow-xl shadow-slate-900/10 ring-1 ring-slate-200/80",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200 text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-xs text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-5 py-3 text-left min-w-[150px]",children:"SKU"}),e.jsx("th",{className:"px-5 py-3 text-left min-w-[300px]",children:"Variant Label"}),e.jsx("th",{className:"px-5 py-3 text-left min-w-[250px]",children:"Metal"}),e.jsx("th",{className:"px-5 py-3 text-left min-w-[250px]",children:"Diamonds"}),e.jsx("th",{className:"px-5 py-3 text-left min-w-[250px]",children:"Colorstones"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Inventory Quantity"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Status"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Default"}),e.jsx("th",{className:"px-5 py-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 bg-white",children:[(x.variants||[]).map((t,n)=>{const s=re(t,x);s.metalTone;const d=(t.metals||[]).filter(o=>o.metal_id!==""&&o.metal_id!==null&&typeof o.metal_id=="number");d.reduce((o,N)=>{const l=parseFloat(N.metal_weight||"0");return o+(isNaN(l)?0:l)},0);const i=new Map;d.forEach(o=>{const N=o.metal_id;i.has(N)||i.set(N,[]),i.get(N).push({metal_id:N,metal_purity_id:o.metal_purity_id!==""&&o.metal_purity_id!==null?typeof o.metal_purity_id=="number"?o.metal_purity_id:Number(o.metal_purity_id):null,metal_tone_id:o.metal_tone_id!==""&&o.metal_tone_id!==null?typeof o.metal_tone_id=="number"?o.metal_tone_id:Number(o.metal_tone_id):null})});const a=[],r=[];i.forEach((o,N)=>{const l=Y[N]||"",c=new Set,h=new Set;if(o.forEach(m=>{if(m.metal_purity_id!==null){const v=typeof m.metal_purity_id=="number"?m.metal_purity_id:Number(m.metal_purity_id);Number.isFinite(v)&&c.add(v)}if(m.metal_tone_id!==null){const v=typeof m.metal_tone_id=="number"?m.metal_tone_id:Number(m.metal_tone_id);Number.isFinite(v)&&h.add(v)}}),c.size>0){const m=Array.from(c).map(v=>{const u=typeof v=="number"?v:Number(v);return Number.isFinite(u)&&Q[u]||""}).filter(Boolean).sort();m.length>0&&(c.size>1?a.push(`${m.join(" + ")} (${l})`):a.push(`${m[0]} (${l})`))}if(h.size>0){const m=Array.from(h).map(v=>{const u=typeof v=="number"?v:Number(v);return Number.isFinite(u)&&se[u]||""}).filter(Boolean).sort();m.length>0&&(h.size>1?r.push(`${m.join(" + ")} (${l})`):r.push(`${m[0]} (${l})`))}});let _=[];const g=(t.diamonds||[]).filter(o=>o.diamond_id!==""&&o.diamond_id!==null&&o.diamond_id!==void 0).map(o=>({diamond_id:typeof o.diamond_id=="number"?o.diamond_id:Number(o.diamond_id),diamonds_count:o.diamonds_count||""}));g.length>0?_=g:(t.diamonds||[]).length>0?_=(t.diamonds||[]).map(o=>({diamond_id:null,diamonds_count:o.diamonds_count||""})):(x.diamond_selections||[]).length>0&&(_=(x.diamond_selections||[]).filter(o=>o.diamond_id!==""&&o.diamond_id!==null&&o.diamond_id!==void 0).map(o=>({diamond_id:typeof o.diamond_id=="number"?o.diamond_id:Number(o.diamond_id),diamonds_count:o.count||""})));let w=[];const y=(t.colorstones||[]).filter(o=>o.colorstone_id!==""&&o.colorstone_id!==null&&o.colorstone_id!==void 0).map(o=>({colorstone_id:typeof o.colorstone_id=="number"?o.colorstone_id:Number(o.colorstone_id),stones_count:o.stones_count||""}));y.length>0?w=y:(t.colorstones||[]).length>0?w=(t.colorstones||[]).map(o=>({colorstone_id:null,stones_count:o.stones_count||""})):(x.colorstone_selections||[]).length>0&&(w=(x.colorstone_selections||[]).filter(o=>o.colorstone_id!==""&&o.colorstone_id!==null&&o.colorstone_id!==void 0).map(o=>({colorstone_id:typeof o.colorstone_id=="number"?o.colorstone_id:Number(o.colorstone_id),stones_count:o.count||""})));const $=t.metadata??{},q=typeof $.size_value=="string"||typeof $.size_value=="number"?String($.size_value):"",U=$.size_unit==="mm"||$.size_unit==="cm"?$.size_unit:"cm";q?`${q}${U}`:t.size_cm&&`${H(parseFloat(t.size_cm))}`;const F=typeof $.status=="string"&&$.status.trim().length>0?String($.status):"enabled";return s.autoLabel,e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`hover:bg-slate-50 ${F==="disabled"?"opacity-70":""} ${t.is_default?"bg-sky-50/30":""}`,children:[e.jsxs("td",{className:"px-5 py-3 align-middle min-w-[150px]",children:[e.jsx("input",{type:"text",value:t.sku,onChange:o=>ie(n,"sku",o.target.value),className:"w-full min-w-[120px] rounded-xl border border-slate-200 px-3 py-1.5 text-sm text-slate-700 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Variant SKU"}),f[`variants.${n}.sku`]&&e.jsx("p",{className:"mt-1 text-xs text-rose-500",children:f[`variants.${n}.sku`]})]}),e.jsxs("td",{className:"px-5 py-3 align-middle min-w-[300px]",children:[e.jsx("input",{type:"text",value:t.label,onChange:o=>ie(n,"label",o.target.value),className:"w-full min-w-[280px] rounded-xl border border-slate-200 px-3 py-1.5 text-sm text-slate-700 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Display label"}),f[`variants.${n}.label`]&&e.jsx("p",{className:"mt-1 text-xs text-rose-500",children:f[`variants.${n}.label`]})]}),e.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:e.jsx("div",{className:"space-y-3 min-w-[250px]",children:d.length>0?d.map((o,N)=>{const l=Y[o.metal_id]||"Unknown Metal",c=o.metal_purity_id&&typeof o.metal_purity_id=="number"&&A.find(v=>v.id===o.metal_purity_id)?.name||"",h=o.metal_tone_id&&typeof o.metal_tone_id=="number"&&P.find(v=>v.id===o.metal_tone_id)?.name||"",m=o.metal_weight||"";return e.jsxs("div",{className:"flex flex-col gap-2 rounded-lg border border-slate-200 bg-slate-50/50 p-3",children:[e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white px-3 py-2",children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Metal"}),e.jsx("div",{className:"text-sm font-semibold text-slate-800",children:l})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white px-3 py-2",children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Purity"}),e.jsx("div",{className:"text-sm text-slate-700",children:c||"—"})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white px-3 py-2",children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Tone"}),e.jsx("div",{className:"text-sm text-slate-700",children:h||"—"})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white px-3 py-2",children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1.5",children:"Weight (g)"}),e.jsx("input",{type:"number",step:"0.001",min:"0.001",required:!0,value:m,onChange:v=>{const u=v.target.value;je(n,N,"metal_weight",u)},className:`w-full rounded-lg border px-2.5 py-1.5 text-sm font-mono transition-colors ${!m||m===""?"border-rose-300 bg-rose-50 text-rose-500 focus:border-rose-400 focus:bg-white":"border-slate-200 bg-white text-slate-700 focus:border-sky-400"} focus:outline-none focus:ring-1 focus:ring-sky-200`,placeholder:"0.000"}),(!m||m==="")&&e.jsx("span",{className:"mt-1 text-[10px] text-rose-500",children:"Required"})]})]},N)}):e.jsx("span",{className:"text-sm text-slate-400",children:"—"})})}),e.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:e.jsx("div",{className:"space-y-3 min-w-[250px]",children:_.length>0?_.map((o,N)=>{const l=o.diamond_id&&I?.find(h=>h.id===o.diamond_id)?.name||"Diamond",c=o.diamonds_count||"";return e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border border-slate-200 bg-slate-50/50 p-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Diamond"}),e.jsx("div",{className:"text-sm font-semibold text-slate-800",children:l})]}),e.jsxs("div",{className:"w-24",children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Count"}),e.jsx("input",{type:"number",min:"1",step:"1",required:!0,value:c,onChange:h=>{const m=h.target.value;de(n,N,"diamonds_count",m)},className:`w-full rounded-lg border px-2.5 py-1.5 text-sm font-mono transition-colors ${!c||c===""?"border-rose-300 bg-rose-50 text-rose-500 focus:border-rose-400 focus:bg-white":"border-slate-200 bg-white text-slate-700 focus:border-sky-400"} focus:outline-none focus:ring-1 focus:ring-sky-200`,placeholder:"0"})]})]},N)}):e.jsx("span",{className:"text-sm text-slate-400",children:"—"})})}),e.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:e.jsx("div",{className:"space-y-3 min-w-[250px]",children:w.length>0?w.map((o,N)=>{const l=o.colorstone_id&&Z?.find(h=>h.id===o.colorstone_id)?.name||"Colorstone",c=o.stones_count||"";return e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border border-slate-200 bg-slate-50/50 p-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Colorstone"}),e.jsx("div",{className:"text-sm font-semibold text-slate-800",children:l})]}),e.jsxs("div",{className:"w-24",children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Count"}),e.jsx("input",{type:"number",min:"1",step:"1",required:!0,value:c,onChange:h=>{const m=h.target.value;Je(n,N,"stones_count",m)},className:`w-full rounded-lg border px-2.5 py-1.5 text-sm font-mono transition-colors ${!c||c===""?"border-rose-300 bg-rose-50 text-rose-500 focus:border-rose-400 focus:bg-white":"border-slate-200 bg-white text-slate-700 focus:border-sky-400"} focus:outline-none focus:ring-1 focus:ring-sky-200`,placeholder:"0"})]})]},N)}):e.jsx("span",{className:"text-sm text-slate-400",children:"—"})})}),e.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("input",{type:"number",min:"0",step:"1",required:!0,value:t.inventory_quantity!==void 0&&t.inventory_quantity!==null&&t.inventory_quantity!==""?String(t.inventory_quantity):"",onChange:o=>{const N=o.target.value.trim();if(N==="")ie(n,"inventory_quantity","");else{const l=parseInt(N,10);!isNaN(l)&&l>=0&&ie(n,"inventory_quantity",l)}},className:`w-full min-w-[100px] rounded-xl border px-3 py-1.5 text-sm text-slate-700 transition-colors ${t.inventory_quantity===void 0||t.inventory_quantity===null||t.inventory_quantity===""?"border-rose-300 bg-rose-50 text-rose-500 focus:border-rose-400 focus:bg-white":"border-slate-200 bg-white focus:border-sky-400"} focus:outline-none focus:ring-2 focus:ring-sky-200`,placeholder:"0"}),(t.inventory_quantity===void 0||t.inventory_quantity===null||t.inventory_quantity==="")&&e.jsx("span",{className:"text-[10px] text-rose-500",children:"Required"})]})}),e.jsx("td",{className:"px-5 py-3 text-slate-700",children:e.jsxs("select",{value:F,onChange:o=>Ie(n,{status:o.target.value}),className:`rounded-xl border px-3 py-1.5 text-sm text-slate-700 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200 ${F==="enabled"?"border-emerald-300 bg-emerald-50":"border-amber-300 bg-amber-50"}`,children:[e.jsx("option",{value:"enabled",children:"Enabled"}),e.jsx("option",{value:"disabled",children:"Disabled"})]})}),e.jsx("td",{className:"px-5 py-3 text-slate-700",children:e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-slate-600",children:[e.jsx("input",{type:"radio",name:"default-variant-table",checked:t.is_default,onChange:()=>Ze(n),className:"h-4 w-4 text-sky-600 focus:ring-sky-500"}),e.jsx("span",{children:t.is_default?"Default":"Set default"})]})}),e.jsx("td",{className:"px-5 py-3 text-right",children:e.jsx("div",{className:"flex items-center justify-end gap-2",children:e.jsx("button",{type:"button",onClick:()=>Ge(n),className:"inline-flex items-center justify-center rounded-full border border-rose-200 p-1.5 text-rose-600 transition hover:border-rose-300 hover:text-rose-700","aria-label":"Remove variant",title:"Remove Variant",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,className:"h-4 w-4",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 7h12m-9 3v6m6-6v6M10 4h4a1 1 0 0 1 1 1v1H9V5a1 1 0 0 1 1-1Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 7h14l-.8 11.2A2 2 0 0 1 16.2 20H7.8a2 2 0 0 1-1.99-1.8L5 7Z"})]})})})})]},t.id??`variant-${n}`),Le.has(n)&&e.jsx("tr",{children:e.jsx("td",{colSpan:13,className:"px-5 py-4",children:e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4",children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900",children:"Metals for this Variant"}),e.jsxs("p",{className:"mt-1 text-xs text-slate-600",children:[e.jsx("span",{className:"font-semibold text-rose-600",children:"Required:"})," Enter metal weight (in grams) for each metal in this variant."]})]})}),d.length===0?e.jsx("p",{className:"text-xs text-slate-400",children:"No metals assigned to this variant."}):e.jsx("div",{className:"space-y-3",children:d.map((o,N)=>{const l=Y[o.metal_id]||"Unknown Metal",c=o.metal_purity_id&&typeof o.metal_purity_id=="number"&&A.find(m=>m.id===o.metal_purity_id)?.name||"",h=o.metal_tone_id&&typeof o.metal_tone_id=="number"&&P.find(m=>m.id===o.metal_tone_id)?.name||"";return e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-4",children:[e.jsx("div",{className:"mb-3 flex items-center justify-between",children:e.jsxs("span",{className:"text-xs font-semibold text-slate-600",children:[l,c&&` — ${c}`,h&&` — ${h}`]})}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-3",children:e.jsxs("label",{className:"flex flex-col gap-1.5",children:[e.jsxs("span",{className:"text-xs font-semibold text-slate-700 flex items-center gap-1",children:[e.jsx("span",{children:"Metal Weight (g)"}),e.jsx("span",{className:"text-rose-500 font-bold text-sm",title:"Required field",children:"*"})]}),e.jsx("input",{type:"number",step:"0.001",min:"0.001",required:!0,value:o.metal_weight||"",onChange:m=>{const v=m.target.value;je(n,N,"metal_weight",v)},className:`rounded-xl border-2 px-3 py-2 text-sm font-medium transition-colors ${o.metal_weight?"border-slate-200 bg-white focus:border-sky-400":"border-rose-300 bg-rose-50 focus:border-rose-400 focus:bg-white"} focus:outline-none focus:ring-2 focus:ring-sky-200`,placeholder:"Enter weight (required)"}),!o.metal_weight&&e.jsx("span",{className:"text-xs text-rose-600 font-medium",children:"⚠️ This field is required"})]})})]},N)})})]})})}),Me.has(n)&&e.jsx("tr",{children:e.jsx("td",{colSpan:13,className:"px-5 py-4",children:e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900",children:"Diamonds for this Variant"}),x.diamond_mixing_mode==="shared"&&e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"This variant uses the shared diamond list defined above. All variants share the same diamonds."}),x.diamond_mixing_mode==="as_variant"&&e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"This variant has its specific diamond from the diamond mixes list. Each variant-diamond combination is a separate sellable variant."})]}),x.diamond_mixing_mode==="shared"&&e.jsx("p",{className:"mb-4 text-xs text-slate-500",children:'In "shared" mode, diamonds are managed in the "Diamond mixes" section above. All variants use the same diamond list.'}),x.diamond_mixing_mode==="as_variant"&&e.jsxs("button",{type:"button",onClick:()=>Qe(n),className:"inline-flex items-center gap-2 rounded-full border border-slate-300 bg-white px-3 py-1.5 text-xs font-semibold text-slate-700 transition hover:border-sky-400 hover:bg-sky-50",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 5v14M5 12h14"})}),"Add Diamond"]})]}),_.length===0?e.jsx("p",{className:"text-xs text-slate-400",children:x.diamond_mixing_mode==="shared"?"No diamonds assigned to this variant from the shared matrix.":'No diamonds added to this variant. Click "Add Diamond" to add one.'}):e.jsx("div",{className:"space-y-3",children:_.map((o,N)=>e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-semibold text-slate-600",children:["Diamond #",N+1]}),x.diamond_mixing_mode==="as_variant"&&e.jsx("button",{type:"button",onClick:()=>Ye(n,N),className:"text-xs text-rose-500 transition hover:text-rose-700",children:"Remove"})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("label",{className:"flex flex-col gap-1.5 text-xs font-medium text-slate-600",children:["Diamond",e.jsxs("select",{value:typeof o.diamond_id=="string"||!o.diamond_id?"":String(o.diamond_id),onChange:l=>de(n,N,"diamond_id",l.target.value===""?"":Number(l.target.value)),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[e.jsx("option",{value:"",children:"Select diamond"}),(I||[]).map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})]}),e.jsxs("label",{className:"flex flex-col gap-1.5 text-xs font-medium text-slate-600",children:["Number of Diamonds",e.jsx("input",{type:"number",step:"1",min:"0",value:o.diamonds_count,onChange:l=>de(n,N,"diamonds_count",l.target.value),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"0"})]})]})]},N))})]})})})]})}),(x.variants||[]).length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:17,className:"px-5 py-6 text-center text-xs uppercase tracking-[0.1em] text-slate-400",children:"No variants configured. Generate matrix to create variants."})})]})]})})})]})]})]})}export{ht as default};
