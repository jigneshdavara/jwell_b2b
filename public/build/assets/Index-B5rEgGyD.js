import{u as j,r as d,a as f,j as e,H as y,L as b,b as N}from"./app-DkJetrPT.js";import{A as w}from"./AuthenticatedLayout-DSD5Ys5v.js";import"./FlashMessage-BT8-rBiH.js";const v={pending:{label:"Pending review",style:"bg-amber-100 text-amber-700"},approved:{label:"Approved",style:"bg-emerald-100 text-emerald-700"},rejected:{label:"Rejected",style:"bg-rose-100 text-rose-700"},invoiced:{label:"Awaiting payment",style:"bg-sky-100 text-sky-700"},converted:{label:"Converted to order",style:"bg-slate-200 text-slate-700"},pending_customer_confirmation:{label:"Waiting for you",style:"bg-amber-100 text-amber-700"},customer_confirmed:{label:"You approved",style:"bg-emerald-100 text-emerald-700"},customer_declined:{label:"You declined",style:"bg-rose-100 text-rose-700"}},x={material_sending:{label:"Material sending",style:"bg-slate-100 text-slate-600"},material_received:{label:"Material received",style:"bg-sky-100 text-sky-700"},under_preparation:{label:"Under preparation",style:"bg-indigo-100 text-indigo-700"},completed:{label:"Completed",style:"bg-emerald-100 text-emerald-700"},awaiting_billing:{label:"Awaiting billing",style:"bg-amber-100 text-amber-700"},billing_confirmed:{label:"Billing confirmed",style:"bg-emerald-100 text-emerald-700"},ready_to_ship:{label:"Ready to ship",style:"bg-slate-900 text-white"}};function C(){const{quotations:n}=j().props,[a,o]=d.useState("all"),[t,c]=d.useState(null),l=f({message:""}),m=d.useMemo(()=>a==="all"?n:n.filter(s=>s.mode===a),[n,a]),i=s=>s?new Date(s).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}):"N/A",p=s=>s==null||s===""?"—":typeof s=="boolean"?s?"Yes":"No":String(s);d.useEffect(()=>{if(!t)return;const s=n.find(r=>r.id===t.id);s&&c(s)},[n]);const u=s=>{l.data.message.trim()&&l.post(route("frontend.quotations.messages.store",s),{onSuccess:()=>l.reset("message"),preserveScroll:!0})};return e.jsxs(w,{children:[e.jsx(y,{title:"Quotations"}),e.jsxs("div",{className:"space-y-10",children:[e.jsx("header",{className:"rounded-3xl bg-white p-6 shadow-xl ring-1 ring-slate-200/70",children:e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-semibold text-slate-900",children:"Quotation requests"}),e.jsx("p",{className:"mt-2 text-sm text-slate-500",children:"Track jewellery purchase and jobwork quotations. We’ll notify you as soon as our merchandising desk replies."})]}),e.jsxs(b,{href:route("frontend.catalog.index"),className:"inline-flex items-center gap-2 rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-slate-900/30 transition hover:bg-slate-700",children:["Browse catalogue",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})}),e.jsxs("section",{className:"rounded-3xl bg-white p-6 shadow-xl ring-1 ring-slate-200/70",children:[e.jsxs("div",{className:"mb-6 flex flex-wrap gap-3",children:[e.jsx("button",{type:"button",onClick:()=>o("all"),className:`rounded-full px-4 py-2 text-xs font-semibold transition ${a==="all"?"bg-slate-900 text-white shadow-lg shadow-slate-900/30":"bg-slate-200 text-slate-700 hover:bg-slate-300"}`,children:"All quotations"}),e.jsx("button",{type:"button",onClick:()=>o("purchase"),className:`rounded-full px-4 py-2 text-xs font-semibold transition ${a==="purchase"?"bg-slate-900 text-white shadow-lg shadow-slate-900/30":"bg-slate-200 text-slate-700 hover:bg-slate-300"}`,children:"Jewellery"}),e.jsx("button",{type:"button",onClick:()=>o("jobwork"),className:`rounded-full px-4 py-2 text-xs font-semibold transition ${a==="jobwork"?"bg-sky-600 text-white shadow-lg shadow-sky-600/30":"bg-slate-200 text-slate-700 hover:bg-slate-300"}`,children:"Jobwork"})]}),m.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 py-16 text-sm text-slate-500",children:[e.jsx("p",{children:"No quotation requests yet."}),e.jsx(b,{href:route("frontend.catalog.index"),className:"rounded-full bg-sky-600 px-4 py-2 text-sm font-semibold text-white shadow-lg shadow-sky-600/30 transition hover:bg-sky-500",children:"Start a quotation"})]}):e.jsx("div",{className:"space-y-4",children:m.map(s=>{const r=v[s.status]??{label:s.status,style:"bg-slate-200 text-slate-700"};return e.jsxs("article",{className:"flex flex-col gap-4 rounded-2xl border border-slate-200 p-5 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex flex-1 items-start gap-4",children:[s.product.thumbnail&&e.jsx("img",{src:s.product.thumbnail,alt:s.product.name,className:"h-20 w-20 rounded-xl object-cover shadow"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:s.product.name}),e.jsxs("p",{className:"text-xs uppercase tracking-[0.35em] text-slate-400",children:["SKU ",s.product.sku]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-xs text-slate-500",children:[e.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-[11px] font-medium uppercase tracking-wider text-slate-600",children:s.mode==="jobwork"?"Jobwork":"Jewellery"}),e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-[11px] font-medium ${r.style}`,children:r.label})]}),s.variant&&e.jsxs("p",{className:"mt-2 text-xs font-medium text-slate-500",children:["Variant: ",s.variant.metadata?.auto_label??s.variant.label]}),s.jobwork_status&&e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-[11px] font-semibold ${x[s.jobwork_status]?.style??"bg-slate-200 text-slate-600"}`,children:x[s.jobwork_status]?.label??s.jobwork_status.replace(/_/g," ")})}),s.selections&&e.jsx("ul",{className:"mt-2 text-xs text-slate-500",children:Object.entries(s.selections).map(([h,g])=>e.jsxs("li",{children:[e.jsxs("span",{className:"capitalize text-slate-400",children:[h.replace(/_/g," "),":"]})," ",e.jsx("span",{className:"text-slate-700",children:p(g)})]},h))}),s.order&&e.jsxs("p",{className:"mt-2 text-xs text-slate-500",children:["Linked order ",s.order.reference," · Status ",s.order.status]})]})]}),e.jsxs("div",{className:"flex flex-col items-start gap-3 md:items-end",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-600",children:[e.jsxs("span",{className:"rounded-full bg-slate-100 px-3 py-1 font-semibold text-slate-700",children:["Qty: ",s.quantity]}),s.created_at&&e.jsxs("span",{className:"text-xs text-slate-400",children:["Requested ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>c(s),className:"rounded-full border border-slate-300 px-3 py-1 text-xs font-semibold text-slate-600 transition hover:border-slate-400 hover:text-slate-900",children:"View details"}),s.notes&&e.jsx("p",{className:"max-w-sm rounded-2xl bg-slate-50 px-3 py-2 text-xs text-slate-500",children:s.notes}),s.status==="pending"&&e.jsx("button",{type:"button",onClick:()=>{window.confirm("Cancel this quotation request? This action cannot be undone.")&&N.delete(route("frontend.quotations.destroy",s.id),{preserveScroll:!0})},className:"text-xs font-semibold text-rose-500 hover:text-rose-600",children:"Cancel request"})]})]})]},s.id)})})]})]}),t&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 px-4",children:e.jsxs("div",{className:"w-full max-w-3xl space-y-5 rounded-3xl bg-white p-6 shadow-2xl",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.35em] text-slate-400",children:"Quotation"}),e.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:t.product.name}),e.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["SKU ",t.product.sku]})]}),e.jsx("button",{type:"button",onClick:()=>c(null),className:"rounded-full border border-slate-300 px-3 py-1 text-xs font-semibold text-slate-500 transition hover:border-slate-400 hover:text-slate-800",children:"Close"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2 text-sm text-slate-600",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-slate-800",children:"Mode:"})," ",t.mode==="jobwork"?"Jobwork":"Jewellery"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-slate-800",children:"Status:"})," ",t.status]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-slate-800",children:"Quantity:"})," ",t.quantity]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-slate-800",children:"Requested on:"})," ",i(t.created_at)]}),t.approved_at&&e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-slate-800",children:"Approved on:"})," ",i(t.approved_at)]})]}),e.jsxs("div",{className:"space-y-2 text-sm text-slate-600",children:[t.jobwork_status&&e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-slate-800",children:"Jobwork stage:"})," ",x[t.jobwork_status]?.label??t.jobwork_status.replace(/_/g," ")]}),t.order&&e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-slate-800",children:"Order:"})," ",t.order.reference," (",t.order.status,")"]}),t.order?.history?.length?e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"Status timeline"}),e.jsx("ul",{className:"space-y-1",children:t.order.history.map(s=>e.jsx("li",{className:"rounded-2xl border border-slate-200 px-3 py-2 text-xs text-slate-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-slate-700",children:s.status.replace(/_/g," ")}),e.jsx("span",{children:i(s.created_at)})]})},s.id))})]}):null]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-2xl bg-slate-50 p-4 text-sm text-slate-600",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"Your notes"}),e.jsx("p",{className:"mt-2 whitespace-pre-line",children:t.notes||"—"})]}),e.jsxs("div",{className:"rounded-2xl bg-slate-50 p-4 text-sm text-slate-600",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"Admin response"}),e.jsx("p",{className:"mt-2 whitespace-pre-line",children:t.admin_notes||"Awaiting response"})]})]}),t.selections&&Object.keys(t.selections).length>0&&e.jsxs("div",{className:"rounded-2xl bg-slate-50 p-4 text-sm text-slate-600",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"Selections"}),e.jsx("ul",{className:"mt-2 space-y-1",children:Object.entries(t.selections).map(([s,r])=>e.jsxs("li",{children:[e.jsxs("span",{className:"font-semibold text-slate-700",children:[s.replace(/_/g," "),":"]})," ",p(r)]},s))})]}),e.jsxs("div",{className:"space-y-4 rounded-2xl bg-slate-50 p-4 text-sm text-slate-600",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"Conversation"}),e.jsxs("div",{className:"space-y-3 max-h-64 overflow-y-auto pr-2",children:[t.messages.length===0&&e.jsx("p",{className:"text-xs text-slate-400",children:"No messages yet. Start the conversation below."}),t.messages.map(s=>e.jsxs("div",{className:`flex flex-col gap-1 rounded-2xl border px-3 py-2 ${s.sender==="admin"?"border-slate-200 bg-white":"border-sky-200 bg-sky-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-[11px] uppercase tracking-[0.25em] text-slate-400",children:[e.jsx("span",{children:s.sender==="admin"?"Admin":"You"}),e.jsx("span",{children:i(s.created_at)})]}),e.jsx("p",{className:"text-sm text-slate-700 whitespace-pre-line",children:s.message})]},s.id))]}),t.status!=="rejected"&&e.jsxs("form",{onSubmit:s=>{s.preventDefault(),u(t.id)},className:"space-y-2",children:[e.jsx("textarea",{value:l.data.message,onChange:s=>l.setData("message",s.target.value),className:"w-full min-h-[90px] rounded-2xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Share more details or ask a question...",disabled:l.processing}),l.errors.message&&e.jsx("p",{className:"text-xs text-rose-500",children:l.errors.message}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:l.processing||!l.data.message.trim(),className:"rounded-full bg-sky-600 px-4 py-2 text-xs font-semibold text-white shadow-sky-600/30 transition hover:bg-sky-500 disabled:cursor-not-allowed disabled:opacity-60",children:l.processing?"Sending…":"Send message"})})]})]})]})})]})}export{C as default};
