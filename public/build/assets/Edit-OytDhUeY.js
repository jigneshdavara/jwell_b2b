import{u as Be,r as w,a as qe,j as e,H as Fe}from"./app-ZBegTQyu.js";import{R as Re}from"./RichTextEditor-Co8OQcvX.js";import{A as Ue}from"./AdminLayout-DkY62K2h.js";const _e=(V=!1)=>({sku:"",label:"",metal_id:"",metal_purity_id:"",diamond_option_key:null,is_default:V,metadata:{},metals:[],diamonds:[]});function We({subcategories:V,selectedIds:m,parentCategoryId:P,onChange:W,error:F}){const[K,R]=w.useState(!1),[T,B]=w.useState(""),q=w.useRef(null),b=w.useMemo(()=>P?V.filter(N=>N.parent_id===Number(P)):[],[V,P]),G=w.useMemo(()=>{if(!T.trim())return b;const N=T.toLowerCase();return b.filter(z=>z.name.toLowerCase().includes(N))},[b,T]),H=N=>{m.includes(N)?W(m.filter(z=>z!==N)):W([...m,N])};w.useEffect(()=>{const N=z=>{q.current&&!q.current.contains(z.target)&&(R(!1),B(""))};return K&&document.addEventListener("mousedown",N),()=>{document.removeEventListener("mousedown",N)}},[K]);const d=w.useMemo(()=>m.map(N=>{const z=V.find(r=>r.id===N);return z?{id:N,name:z.name}:null}).filter(Boolean),[m,V]),S=N=>{W(m.filter(z=>z!==N))};return w.useEffect(()=>{if(P){const N=m.filter(z=>{const r=V.find(te=>te.id===z);return r&&r.parent_id===Number(P)});N.length!==m.length&&W(N)}else m.length>0&&W([])},[P]),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Subcategories"}),m.length>0&&e.jsxs("span",{className:"text-xs font-medium text-sky-600",children:[m.length," selected"]})]}),e.jsxs("div",{className:"relative",ref:q,children:[e.jsx("button",{type:"button",onClick:()=>R(!K),disabled:!P,className:`w-full rounded-2xl border ${F?"border-rose-300":"border-slate-200"} bg-white px-4 py-2.5 text-left focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200 transition-all ${K?"border-sky-400 ring-2 ring-sky-200":""} ${P?"":"opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex-1 min-h-[20px] flex flex-wrap gap-1.5",children:P?m.length===0?e.jsx("span",{className:"text-slate-400",children:"Select subcategories..."}):d.map(N=>e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-md bg-sky-50 px-2 py-1 text-xs font-medium text-sky-700 border border-sky-200",onClick:z=>z.stopPropagation(),children:[e.jsx("span",{children:N.name}),e.jsx("button",{type:"button",onClick:z=>{z.stopPropagation(),S(N.id)},className:"hover:bg-sky-100 rounded-full p-0.5 transition-colors",children:e.jsx("svg",{className:"h-3 w-3 text-sky-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},N.id)):e.jsx("span",{className:"text-slate-400",children:"Select parent category first"})}),e.jsx("svg",{className:`ml-2 h-5 w-5 text-slate-400 transition-transform flex-shrink-0 ${K?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),K&&P&&e.jsxs("div",{className:"absolute z-50 mt-2 w-full rounded-2xl border border-slate-200 bg-white shadow-lg shadow-slate-900/10 max-h-80 overflow-hidden",children:[b.length>5&&e.jsx("div",{className:"border-b border-slate-100 p-3",children:e.jsxs("div",{className:"relative",children:[e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("input",{type:"text",value:T,onChange:N=>B(N.target.value),placeholder:"Search subcategories...",className:"w-full rounded-xl border border-slate-200 bg-white pl-10 pr-4 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",onClick:N=>N.stopPropagation()})]})}),e.jsx("div",{className:"max-h-64 overflow-y-auto p-2",children:G.length===0?e.jsx("div",{className:"px-3 py-6 text-center text-sm text-slate-400",children:T?"No subcategories found":"No subcategories available"}):e.jsx("div",{className:"space-y-1",children:G.map(N=>{const z=m.includes(N.id);return e.jsxs("button",{type:"button",onClick:()=>H(N.id),className:`w-full flex items-center gap-3 rounded-xl px-3 py-2.5 text-left transition-colors ${z?"bg-sky-50 text-sky-700":"text-slate-700 hover:bg-slate-50"}`,children:[e.jsx("div",{className:`flex h-5 w-5 items-center justify-center rounded border-2 transition-all ${z?"border-sky-500 bg-sky-500":"border-slate-300"}`,children:z&&e.jsx("svg",{className:"h-3.5 w-3.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("span",{className:`text-sm font-medium truncate ${z?"text-sky-900":"text-slate-900"}`,children:N.name})})]},N.id)})})})]})]}),F&&e.jsx("span",{className:"text-xs text-rose-500",children:F})]})}function Ke({catalogs:V,selectedIds:m,onChange:P,error:W}){const[F,K]=w.useState(!1),[R,T]=w.useState(""),B=w.useRef(null),q=w.useMemo(()=>{if(!R.trim())return V;const d=R.toLowerCase();return V.filter(S=>S.name.toLowerCase().includes(d)||S.code?.toLowerCase().includes(d))},[V,R]),b=d=>{m.includes(d)?P(m.filter(S=>S!==d)):P([...m,d])};w.useEffect(()=>{const d=S=>{B.current&&!B.current.contains(S.target)&&(K(!1),T(""))};return F&&document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[F]);const G=w.useMemo(()=>m.map(d=>{const S=V.find(N=>N.id===d);return S?{id:d,name:S.name}:null}).filter(Boolean),[m,V]),H=d=>{P(m.filter(S=>S!==d))};return e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Catalogs"}),m.length>0&&e.jsxs("span",{className:"text-xs font-medium text-sky-600",children:[m.length," selected"]})]}),e.jsxs("div",{className:"relative",ref:B,children:[e.jsx("button",{type:"button",onClick:()=>K(!F),className:`w-full rounded-2xl border ${W?"border-rose-300":"border-slate-200"} bg-white px-4 py-2.5 text-left focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200 transition-all ${F?"border-sky-400 ring-2 ring-sky-200":""}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex-1 min-h-[20px] flex flex-wrap gap-1.5",children:m.length===0?e.jsx("span",{className:"text-slate-400",children:"Select catalogs..."}):G.map(d=>e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-md bg-sky-50 px-2 py-1 text-xs font-medium text-sky-700 border border-sky-200",onClick:S=>S.stopPropagation(),children:[e.jsx("span",{children:d.name}),e.jsx("button",{type:"button",onClick:S=>{S.stopPropagation(),H(d.id)},className:"hover:bg-sky-100 rounded-full p-0.5 transition-colors",children:e.jsx("svg",{className:"h-3 w-3 text-sky-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},d.id))}),e.jsx("svg",{className:`ml-2 h-5 w-5 text-slate-400 transition-transform flex-shrink-0 ${F?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),F&&e.jsxs("div",{className:"absolute z-50 mt-2 w-full rounded-2xl border border-slate-200 bg-white shadow-lg shadow-slate-900/10 max-h-80 overflow-hidden",children:[V.length>5&&e.jsx("div",{className:"border-b border-slate-100 p-3",children:e.jsxs("div",{className:"relative",children:[e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("input",{type:"text",value:R,onChange:d=>T(d.target.value),placeholder:"Search catalogs...",className:"w-full rounded-xl border border-slate-200 bg-white pl-10 pr-4 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",onClick:d=>d.stopPropagation()})]})}),e.jsx("div",{className:"max-h-64 overflow-y-auto p-2",children:q.length===0?e.jsx("div",{className:"px-3 py-6 text-center text-sm text-slate-400",children:R?"No catalogs found":"No catalogs available"}):e.jsx("div",{className:"space-y-1",children:q.map(d=>{const S=m.includes(d.id);return e.jsxs("button",{type:"button",onClick:()=>b(d.id),className:`w-full flex items-center gap-3 rounded-xl px-3 py-2.5 text-left transition-colors ${S?"bg-sky-50 text-sky-700":"text-slate-700 hover:bg-slate-50"}`,children:[e.jsx("div",{className:`flex h-5 w-5 items-center justify-center rounded border-2 transition-all ${S?"border-sky-500 bg-sky-500":"border-slate-300"}`,children:S&&e.jsx("svg",{className:"h-3.5 w-3.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm font-medium truncate ${S?"text-sky-900":"text-slate-900"}`,children:d.name}),d.code&&e.jsxs("span",{className:`text-xs font-mono ${S?"text-sky-600":"text-slate-500"}`,children:["(",d.code,")"]})]})})]},d.id)})})})]})]}),W&&e.jsx("span",{className:"text-xs text-rose-500",children:W})]})}function Je(){const{props:V}=Be(),{product:m,brands:P,parentCategories:W,subcategories:F,catalogs:K,diamonds:R,metals:T,metalPurities:B,metalTones:q,errors:b}=V,G=w.useMemo(()=>{if(!m?.variants?.length)return{metalPurityIds:[],metalToneIds:[],diamondOptions:[],metalSelections:[]};const t=new Set,s=new Set,n=new Map,o=new Map;return m.variants.forEach(i=>{i.metals?.length&&i.metals.forEach(a=>{if(a.metal_id&&a.metal_id!==""&&a.metal_id!==null){const h=typeof a.metal_id=="number"?a.metal_id:Number(a.metal_id),f=a.metal_purity_id&&a.metal_purity_id!==""?typeof a.metal_purity_id=="number"?a.metal_purity_id:Number(a.metal_purity_id):0,p=a.metal_tone_id&&a.metal_tone_id!==""?typeof a.metal_tone_id=="number"?a.metal_tone_id:Number(a.metal_tone_id):0,x=a.metal_weight?String(a.metal_weight):"",k=`${h}-${f}-${p}`;o.has(k)||o.set(k,{metal_id:h,metal_purity_id:f||0,metal_tone_id:p||0,weight:x}),f&&t.add(f),p&&s.add(p)}}),i.diamonds?.length&&i.diamonds.forEach(a=>{if(a.diamond_id&&a.diamond_id!==""&&a.diamond_id!==null){const h=typeof a.diamond_id=="number"?a.diamond_id:Number(a.diamond_id);n.has(h)||n.set(h,{diamond_id:h,count:a.diamonds_count&&a.diamonds_count!==""&&a.diamonds_count!==null?String(a.diamonds_count):""})}})}),{metalPurityIds:Array.from(t),metalToneIds:Array.from(s),diamondSelections:Array.from(n.values()),metalSelections:Array.from(o.values()).map(i=>({metal_id:i.metal_id,metal_purity_id:i.metal_purity_id||"",metal_tone_id:i.metal_tone_id||"",weight:i.weight}))}},[m]),H=qe(()=>({sku:m?.sku??"",name:m?.name??"",titleline:m?.titleline??"",description:m?.description??"",catalog_ids:m?.catalog_ids??[],subcategory_ids:m?.category_ids??[],brand_id:String(m?.brand_id??""),category_id:String(m?.category_id??""),collection:m?.collection??"",producttype:m?.producttype??"",gender:m?.gender??"",making_charge_amount:m?.making_charge_amount?String(m.making_charge_amount):"",making_charge_types:(()=>{const t=m?.making_charge_amount&&Number(m.making_charge_amount)>0,s=m?.making_charge_percentage&&Number(m.making_charge_percentage)>0;return t&&s?["fixed","percentage"]:s?["percentage"]:t?["fixed"]:["fixed"]})(),making_charge_percentage:m?.making_charge_percentage?String(m.making_charge_percentage):"",is_active:m?.is_active??!0,variants:m?.variants?.length?m.variants.map((t,s)=>({id:t.id,sku:t.sku??"",label:t.label??"",metal_id:t.metal_id??"",metal_purity_id:t.metal_purity_id??"",diamond_option_key:t.diamond_option_key??null,is_default:t.is_default??s===0,inventory_quantity:t.inventory_quantity!==void 0&&t.inventory_quantity!==null?Number(t.inventory_quantity):0,metadata:t.metadata??{},metals:t.metals?.map(n=>({id:n.id,metal_id:n.metal_id??"",metal_purity_id:n.metal_purity_id??"",metal_tone_id:n.metal_tone_id??"",metal_weight:n.metal_weight?String(n.metal_weight):""}))??[],diamonds:t.diamonds?.map(n=>({id:n.id,diamond_id:n.diamond_id??"",diamonds_count:n.diamonds_count?String(n.diamonds_count):""}))??[]})):[_e(!0)],diamond_options:[],uses_diamond:(G.diamondSelections?.length??0)>0,diamond_selections:G.diamondSelections??[],metal_selections:G.metalSelections??[],selected_metals:[],metal_configurations:{},media_uploads:[],removed_media_ids:[]})),{setData:d,post:S,put:N,processing:z}=H,r=H.data,[te,le]=w.useState(r.description),X=w.useRef(null);w.useEffect(()=>{r.description!==te&&le(r.description)},[r.description]);const be=w.useCallback(t=>{le(t),X.current&&clearTimeout(X.current),X.current=setTimeout(()=>{d("description",t)},300)},[d]);w.useEffect(()=>()=>{X.current&&clearTimeout(X.current)},[]);const[re,oe]=w.useState(""),[ye,Oe]=w.useState(new Set),[je,He]=w.useState(new Set),I=t=>Number.isFinite(t)?t.toFixed(3).replace(/\.?0+$/,""):"",Ne=(t,s)=>{const n=parseFloat(t);if(!Number.isFinite(n))return"";const o=s==="mm"?n/10:n;return I(o)},de=(t,s)=>{const n=typeof t=="number"?t:parseFloat(t);if(!Number.isFinite(n))return"";const o=s==="mm"?n*10:n;return I(o)},Y=w.useMemo(()=>Object.fromEntries(B.map(t=>[t.id,t.name])),[B]),ee=w.useMemo(()=>Object.fromEntries(q.map(t=>[t.id,t.name])),[q]),J=w.useMemo(()=>Object.fromEntries(T.map(t=>[t.id,t.name])),[T]),ne=w.useCallback((t,s)=>{let n="";if(t.metals&&t.metals.length>0){const c=t.metals.filter(g=>g.metal_id!==""&&typeof g.metal_id=="number").map(g=>({metal_id:g.metal_id,metal_purity_id:g.metal_purity_id!==""&&g.metal_purity_id!==null?Number(g.metal_purity_id):null,metal_tone_id:g.metal_tone_id!==""&&g.metal_tone_id!==null?Number(g.metal_tone_id):null}));if(c.length===0)n="";else{const g=new Map;c.forEach(y=>{g.has(y.metal_id)||g.set(y.metal_id,[]),g.get(y.metal_id).push(y)});const M=[];g.forEach((y,ie)=>{const A=J[ie]??"";if(!A)return;const O=new Set(y.map(D=>D.metal_purity_id).filter(Boolean)),v=new Set(y.map(D=>D.metal_tone_id).filter(Boolean));let L="";if(O.size>1&&v.size===1){const D=Array.from(v)[0],E=D?ee[D]??"":"",$=Array.from(O).map(U=>U?Y[U]??"":"").filter(Boolean).sort();$.length>0?E?L=`${$.join(" + ")} ${E} ${A}`:L=`${$.join(" + ")} ${A}`:L=A}else if(v.size>1&&O.size===1){const D=Array.from(O)[0],E=D?Y[D]??"":"",$=Array.from(v).map(U=>U?ee[U]??"":"").filter(Boolean).sort();$.length>0?E?L=`${E} ${$.join(" + ")} ${A}`:L=`${$.join(" + ")} ${A}`:L=E?`${E} ${A}`:A}else{const D=y[0],E=D.metal_purity_id,$=D.metal_tone_id,U=E?Y[E]??"":"",Q=$?ee[$]??"":"";U&&Q?L=`${U} ${Q} ${A}`:U?L=`${U} ${A}`:Q?L=`${Q} ${A}`:L=A}L&&M.push(L)}),n=M.join(" / ")}}else if(t.metal_id!==""&&typeof t.metal_id=="number"){const c=J[t.metal_id]??"";if(t.metal_purity_id!==""&&typeof t.metal_purity_id=="number"){const g=Y[t.metal_purity_id]??"";n=g?`${g} ${c}`:c}else n=c}let o="";if(t.diamonds&&t.diamonds.length>0){const c=[];t.diamonds.forEach(g=>{if(g.diamond_id&&typeof g.diamond_id=="number"){const M=g.diamonds_count?` (${g.diamonds_count})`:"";c.push(`Diamond${M}`)}}),o=c.join(" / ")}const i=t.metadata??{},a=typeof i.size_value=="string"||typeof i.size_value=="number"?String(i.size_value):"";let f=(i.size_unit==="mm"||i.size_unit==="cm"?i.size_unit:"cm")||"cm",p="";a&&(p=I(Number(a)));const x=p?`${p}${f}`:"",k=[o,n,x].filter(Boolean),l=k.length?k.join(" / "):"Variant",_=n;let j=null;t.diamonds&&t.diamonds.length>0&&(j=t.diamonds.map(c=>({diamond_id:c.diamond_id!==""&&c.diamond_id!==null?Number(c.diamond_id):null,diamonds_count:c.diamonds_count?Number(c.diamonds_count):null})));const u={metal_id:t.metal_id!==""&&t.metal_id!==null?Number(t.metal_id):null,metal_purity_id:t.metal_purity_id!==""&&t.metal_purity_id!==null?Number(t.metal_purity_id):null,diamond_option_key:t.diamond_option_key??null,diamond:j,auto_label:l};p?(u.size_value=p,u.size_unit=f):(delete u.size_value,delete u.size_unit);const C=typeof i.status=="string"&&i.status.trim().length>0?String(i.status):void 0;return C?u.status=C:u.status="enabled",{autoLabel:l,metalTone:_,sizeText:x,metadata:u}},[de,I,J,Y,ee]),Z=w.useCallback(t=>(t.variants||[]).map((s,n)=>{const o=ne(s,t),i=s.metadata?.auto_label??"",a=!s.label||s.label===i,h=s.metadata?.auto_sku??"",f=(t.sku??"").trim(),x=`${f?f.replace(/[^A-Za-z0-9]/g,"").toUpperCase():"SKU"}-${String(n+1).padStart(2,"0")}`,k=!s.sku||s.sku===h;return{...s,sku:k?x:s.sku,label:a?o.autoLabel:s.label,metadata:{...o.metadata,auto_sku:x},is_default:s.is_default??n===0}}),[ne]),ve=t=>{},ce=t=>{d(s=>{if(s.size_unit===t)return s;const n=(s.size_values||[]).map(i=>{const a=Ne(i,s.size_unit||"cm");return a?de(a,t):i}),o={...s,size_unit:t,size_values:n,variants:(s.variants||[]).map(i=>{const a={...i.metadata??{}},h=a.size_value;return h?(a.size_value=h,a.size_unit=t):(delete a.size_value,a.size_unit=t),{...i,metadata:a}})};return o.variants=Z(o),o})},ke=()=>{const t=re.trim();if(!t)return;const s=parseFloat(t);if(!Number.isFinite(s)||s<=0)return;const n=I(s);d(o=>{if((o.size_values||[]).includes(n))return o;const i={...o,size_values:[...o.size_values||[],n]};return i.variants=Z(i),i}),oe("")},we=t=>{d(s=>{const n={...s,size_values:(s.size_values||[]).filter(o=>o!==t)};return n.variants=Z(n),n})},Ce=()=>{d(t=>{const s=t.diamond_selections||[];return{...t,diamond_selections:[...s,{diamond_id:"",count:""}]}})},Se=t=>{d(s=>{const n=s.diamond_selections||[];return{...s,diamond_selections:n.filter((o,i)=>i!==t)}})},me=(t,s,n)=>{d(o=>{const a=(o.diamond_selections||[]).map((h,f)=>f!==t?h:{...h,[s]:n});return{...o,diamond_selections:a}})},ze=t=>{d(s=>{if((s.variants||[]).length===1)return s;const n=(s.variants||[]).filter((i,a)=>a!==t);n.every(i=>!i.is_default)&&n.length>0&&(n[0].is_default=!0);const o={...s,variants:n};return o.variants=Z(o),o})},se=(t,s,n)=>{d(o=>{const i=(o.variants||[]).map((h,f)=>{if(f!==t)return h;const p={...h};switch(s){case"is_default":typeof n=="boolean"&&(p.is_default=n);break;case"metal_id":(n===""||typeof n=="number")&&(p.metal_id=n,(n===""||typeof n!="number")&&(p.metal_purity_id=""));break;case"metal_purity_id":(n===""||typeof n=="number")&&(p.metal_purity_id=n);break;case"diamond_option_key":p.diamond_option_key=n?String(n):null;break;case"sku":case"label":typeof n=="string"&&(p[s]=n);break;case"inventory_quantity":if(n===""||n===null)p[s]=0;else if(typeof n=="string"){const x=parseInt(n,10);p[s]=isNaN(x)?0:x}else typeof n=="number"&&(p[s]=n);break}return p}),a={...o,variants:i};return a.variants=Z(a),a})},$e=(t,s)=>{d(n=>{const o=(n.variants||[]).map((a,h)=>{if(h!==t)return a;const f={...a.metadata??{}};return Object.entries(s).forEach(([p,x])=>{x===null?delete f[p]:f[p]=x}),{...a,metadata:f}}),i={...n,variants:o};return i.variants=Z(i),i})},Me=t=>{d(s=>({...s,variants:(s.variants||[]).map((n,o)=>({...n,is_default:o===t}))}))},Le=(t,s)=>{d(n=>{const o=(n.variants||[]).map((i,a)=>{if(a!==t)return i;const h=i.diamonds||[];return{...i,diamonds:h.filter((f,p)=>p!==s)}});return{...n,variants:o}})},ae=(t,s,n,o)=>{d(i=>{const a=(i.variants||[]).map((h,f)=>{if(f!==t)return h;const x=(h.diamonds||[]).map((k,l)=>l!==s?k:{...k,[n]:o});return{...h,diamonds:x}});return{...i,variants:a}})},ue=(t,s,n,o)=>{d(i=>{const a=(i.variants||[]).map((h,f)=>{if(f!==t)return h;const x=(h.metals||[]).map((k,l)=>l!==s?k:{...k,[n]:o});return{...h,metals:x}});return{...i,variants:a}})},De=t=>{const s=[],n=t.selected_metals||[],o=t.metal_configurations||{};n.length>0&&n.forEach(u=>{const C=o[u]||{purities:[],tones:[]},c=C.purities.length>0?C.purities:[null],g=C.tones.length>0?C.tones:[null];c.forEach(M=>{g.forEach(y=>{s.push([{metal_id:u,metal_purity_id:M!==null?M:null,metal_tone_id:y!==null?y:null}])})})});const i=[];t.uses_diamond&&(t.diamond_options||[]).length>0?(t.diamond_options||[]).forEach(u=>{i.push({key:u.key,clarity_id:u.clarity_id!==""?Number(u.clarity_id):null,color_id:u.color_id!==""?Number(u.color_id):null,shape_id:u.shape_id!==""?Number(u.shape_id):null})}):i.push({key:"",clarity_id:null,color_id:null,shape_id:null});const a=t.size_dimension_enabled&&(t.size_values||[]).length>0?t.size_values||[]:[null],h=t.size_dimension_enabled&&(a||[]).length>0&&(a||[])[0]!==null,f=t.uses_diamond&&i.length>0&&i[0].key!=="";if(s.length===0&&!h&&!f)return t;const p=[],x=[];s.length>0?s.forEach(u=>{(a||[]).forEach(C=>{x.push({metals:u,size:C??null})})}):h?a.forEach(u=>{x.push({metals:[],size:u??null})}):x.push({metals:[],size:null});const k=f?i[0]:{key:"",clarity_id:null,color_id:null,shape_id:null};if(x.forEach(u=>{p.push({metals:u.metals,diamond:k,size:u.size})}),p.length===0)return t;const l=new Map;(t.variants||[]).forEach(u=>{if(!u.metals||u.metals.length===0)return;const C=u.metadata?.size_value||"no-size",c=u.diamond_option_key||"no-diamond",M=`${u.metals.filter(y=>y.metal_id!==""&&typeof y.metal_id=="number").map(y=>`${y.metal_id}-${y.metal_purity_id||"null"}-${y.metal_tone_id||"null"}`).sort().join("|")}::${C}::${c}`;l.set(M,{metals:u.metals.map(y=>({metal_id:typeof y.metal_id=="number"?y.metal_id:0,metal_purity_id:y.metal_purity_id!==""&&y.metal_purity_id!==null?typeof y.metal_purity_id=="number"?y.metal_purity_id:Number(y.metal_purity_id):null,metal_tone_id:y.metal_tone_id!==""&&y.metal_tone_id!==null?typeof y.metal_tone_id=="number"?y.metal_tone_id:Number(y.metal_tone_id):null,metal_weight:y.metal_weight||""})),diamonds:(u.diamonds||[]).map(y=>({diamond_id:y.diamond_id!==""&&y.diamond_id!==null?typeof y.diamond_id=="number"?y.diamond_id:Number(y.diamond_id):null,diamonds_count:y.diamonds_count||""}))})});const _=p.map((u,C)=>{const c=_e(C===0),g=u.size||"no-size",M=u.diamond.key||"no-diamond",ie=`${u.metals.map(v=>`${v.metal_id}-${v.metal_purity_id||"null"}-${v.metal_tone_id||"null"}`).sort().join("|")}::${g}::${M}`,A=l.get(ie);if(c.metals=u.metals.map(v=>{const L=A?.metals.find(E=>E.metal_id===v.metal_id&&E.metal_purity_id===(v.metal_purity_id??null)&&E.metal_tone_id===(v.metal_tone_id??null));let D="";if((t.metal_selections||[]).length>0){const E=(t.metal_selections||[]).find($=>{const U=typeof $.metal_id=="number"?$.metal_id:Number($.metal_id),Q=$.metal_purity_id===""?null:typeof $.metal_purity_id=="number"?$.metal_purity_id:Number($.metal_purity_id),Te=$.metal_tone_id===""?null:typeof $.metal_tone_id=="number"?$.metal_tone_id:Number($.metal_tone_id);return U===v.metal_id&&Q===(v.metal_purity_id??null)&&Te===(v.metal_tone_id??null)});E&&(D=E.weight||"")}return{id:void 0,metal_id:v.metal_id,metal_purity_id:v.metal_purity_id??"",metal_tone_id:v.metal_tone_id??"",metal_weight:L?.metal_weight||D||""}}),u.metals.length>0){const v=u.metals[0];c.metal_id=v.metal_id,v.metal_purity_id!==null&&(c.metal_purity_id=v.metal_purity_id)}c.diamond_option_key=null,(t.diamond_selections||[]).length>0?c.diamonds=(t.diamond_selections||[]).map(v=>{const L=A?.diamonds.find(D=>D.diamond_id===(v.diamond_id!==""&&v.diamond_id!==null?typeof v.diamond_id=="number"?v.diamond_id:Number(v.diamond_id):null));return{id:L?.id,diamond_id:v.diamond_id!==""&&v.diamond_id!==null?typeof v.diamond_id=="number"?v.diamond_id:Number(v.diamond_id):"",diamonds_count:L?.diamonds_count||v.count||""}}):c.diamonds=[];const O={...c.metadata??{},status:"enabled"};return u.size?(O.size_value=u.size,O.size_unit=t.size_unit):(delete O.size_value,delete O.size_unit),c.diamond_option_key&&(O.diamond_option_key=c.diamond_option_key),c.metadata=O,c}),j={...t,variants:_};return j.variants=Z(j),j},xe=()=>{d(t=>De(t))},Ee=t=>{t.preventDefault();const s=(H.data.media_uploads?.length??0)>0;H.transform(o=>{const i=o,a={...i};i.media_uploads&&Array.isArray(i.media_uploads)&&i.media_uploads.length>0&&(a.media_uploads=i.media_uploads),a.sku=i.sku||"",a.name=i.name||"",a.titleline=i.titleline||null,a.collection=i.collection||null,a.producttype=i.producttype||null,a.gender=i.gender||null,a.description=i.description||"";const h=i.brand_id;if(h!==""&&h!==null&&h!==void 0){const x=Number(h);a.brand_id=isNaN(x)?null:x}else a.brand_id=null;const f=i.category_id;if(f!==""&&f!==null&&f!==void 0){const x=Number(f);a.category_id=isNaN(x)?null:x}else a.category_id=null;const p=i.making_charge_types||[];if(p.includes("fixed")){const x=i.making_charge_amount;if(x===""||x===null||x===void 0)a.making_charge_amount=0;else{const k=Number(x);a.making_charge_amount=isNaN(k)?0:k}}else a.making_charge_amount=0;if(p.includes("percentage")){const x=i.making_charge_percentage;if(x===""||x===null||x===void 0)a.making_charge_percentage=null;else{const k=Number(x);a.making_charge_percentage=isNaN(k)?null:k}}else a.making_charge_percentage=null;return a.is_active=i.is_active??!0,delete a.metadata,(!a.media_uploads||Array.isArray(a.media_uploads)&&a.media_uploads.length===0)&&delete a.media_uploads,(!a.removed_media_ids||Array.isArray(a.removed_media_ids)&&a.removed_media_ids.length===0)&&delete a.removed_media_ids,a.sku||(a.sku=""),a.name||(a.name=""),a.brand_id===void 0&&(a.brand_id=null),a.category_id===void 0&&(a.category_id=null),a.making_charge_amount===void 0&&(a.making_charge_amount=0),i.subcategory_ids&&Array.isArray(i.subcategory_ids)&&i.subcategory_ids.length>0?a.category_ids=i.subcategory_ids:a.category_ids=[],delete a.subcategory_ids,i.variants&&Array.isArray(i.variants)?a.variants=i.variants:a.variants=[],i.diamond_selections!==void 0&&(a.diamond_selections=i.diamond_selections),m?.id&&s&&(a._method="PUT"),a});const n={preserveScroll:!0,forceFormData:s,onFinish:()=>{H.transform(o=>o)}};m?.id?s?S(route("admin.products.update",m.id),n):N(route("admin.products.update",m.id),n):S(route("admin.products.store"),n)},pe=b.variants,he=w.useMemo(()=>Object.entries(b??{}).filter(([t])=>t.startsWith("media_uploads")).map(([,t])=>t),[b]),fe=w.useMemo(()=>m?.media?[...m.media].sort((t,s)=>t.display_order-s.display_order):[],[m?.media]),Ve=t=>{const s=r.removed_media_ids??[],o=s.includes(t)?s.filter(i=>i!==t):[...s,t];d("removed_media_ids",o)},Pe=t=>{const s=t.target.files?Array.from(t.target.files):[];s.length!==0&&(d("media_uploads",[...r.media_uploads??[],...s]),t.target.value="")},Ae=t=>{d("media_uploads",(r.media_uploads??[]).filter((s,n)=>n!==t))},ge=t=>(r.removed_media_ids??[]).includes(t);return e.jsxs(Ue,{children:[e.jsx(Fe,{title:m?.id?`Edit ${m.name}`:"New Product"}),e.jsxs("form",{onSubmit:Ee,className:"space-y-10",children:[e.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-xl shadow-slate-900/10",children:[e.jsxs("div",{className:"flex flex-col gap-4 border-b border-slate-100 pb-6 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:m?.id?"Update product":"Create product"}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Define product master information and atelier references."})]}),e.jsx("button",{type:"submit",disabled:z,className:"inline-flex items-center gap-2 rounded-full bg-slate-900 px-5 py-2 text-sm font-semibold text-white shadow-lg shadow-slate-900/20 transition hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",children:z?"Saving…":m?.id?"Save changes":"Create product"})]}),e.jsx("div",{className:"mt-6 space-y-6",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"SKU *"}),e.jsx("input",{type:"text",value:r.sku,onChange:t=>d("sku",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),b.sku&&e.jsx("span",{className:"text-xs text-rose-500",children:b.sku})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Product name *"}),e.jsx("input",{type:"text",value:r.name,onChange:t=>d("name",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),b.name&&e.jsx("span",{className:"text-xs text-rose-500",children:b.name})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Product Type *"}),e.jsx("input",{type:"text",value:r.producttype,onChange:t=>d("producttype",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Enter product type"}),b.producttype&&e.jsx("span",{className:"text-xs text-rose-500",children:b.producttype})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Title Line *"}),e.jsx("input",{type:"text",value:r.titleline,onChange:t=>d("titleline",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Enter product title line"}),b.titleline&&e.jsx("span",{className:"text-xs text-rose-500",children:b.titleline})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Collection *"}),e.jsx("input",{type:"text",value:r.collection,onChange:t=>d("collection",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Enter collection name"}),b.collection&&e.jsx("span",{className:"text-xs text-rose-500",children:b.collection})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Gender *"}),e.jsxs("select",{value:r.gender,onChange:t=>d("gender",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[e.jsx("option",{value:"",children:"Select gender"}),e.jsx("option",{value:"Men",children:"Men"}),e.jsx("option",{value:"Women",children:"Women"}),e.jsx("option",{value:"Unisex",children:"Unisex"}),e.jsx("option",{value:"Kids",children:"Kids"})]}),b.gender&&e.jsx("span",{className:"text-xs text-rose-500",children:b.gender})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Brand *"}),e.jsxs("select",{value:r.brand_id,onChange:t=>d("brand_id",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[e.jsx("option",{value:"",children:"Select brand"}),Object.entries(P).map(([t,s])=>e.jsx("option",{value:t,children:s},t))]}),b.brand_id&&e.jsx("span",{className:"text-xs text-rose-500",children:b.brand_id})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Category *"}),e.jsxs("select",{value:r.category_id,onChange:t=>d("category_id",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[e.jsx("option",{value:"",children:"Select category"}),(W||[]).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),b.category_id&&e.jsx("span",{className:"text-xs text-rose-500",children:b.category_id})]}),e.jsx(We,{subcategories:F||[],selectedIds:Array.isArray(r.subcategory_ids)?r.subcategory_ids:[],parentCategoryId:r.category_id===""||r.category_id===null||r.category_id===void 0||isNaN(Number(r.category_id))?"":Number(r.category_id),onChange:t=>d("subcategory_ids",t),error:b.subcategory_ids}),e.jsx(Ke,{catalogs:K,selectedIds:Array.isArray(r.catalog_ids)?r.catalog_ids:[],onChange:t=>d("catalog_ids",t),error:b.catalog_ids}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{className:"mb-2 block",children:"Making Charge *"}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.making_charge_types?.includes("fixed")??!1,onChange:t=>{const s=r.making_charge_types||[];t.target.checked?d("making_charge_types",[...s,"fixed"]):d("making_charge_types",s.filter(n=>n!=="fixed"))},className:"h-5 w-5 rounded border-slate-300 text-elvee-blue focus:ring-2 focus:ring-elvee-blue focus:ring-offset-0"}),e.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Fixed Amount"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.making_charge_types?.includes("percentage")??!1,onChange:t=>{const s=r.making_charge_types||[];t.target.checked?d("making_charge_types",[...s,"percentage"]):d("making_charge_types",s.filter(n=>n!=="percentage"))},className:"h-5 w-5 rounded border-slate-300 text-elvee-blue focus:ring-2 focus:ring-elvee-blue focus:ring-offset-0"}),e.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Percentage"})]})]})]}),b.making_charge_types&&(!r.making_charge_types||r.making_charge_types.length===0)&&e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"block text-xs text-rose-500",children:b.making_charge_types})}),(r.making_charge_types?.includes("fixed")??!1)&&e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsxs("span",{children:["Making Charge (₹) ",r.making_charge_types?.includes("percentage")??!1?"":"*"]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:r.making_charge_amount,onChange:t=>d("making_charge_amount",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Enter fixed making charge"}),b.making_charge_amount&&e.jsx("span",{className:"text-xs text-rose-500",children:b.making_charge_amount})]}),(r.making_charge_types?.includes("percentage")??!1)&&e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsxs("span",{children:["Making Charge Percentage (%) ",r.making_charge_types?.includes("fixed")??!1?"":"*"]}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:r.making_charge_percentage,onChange:t=>d("making_charge_percentage",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Enter percentage (e.g., 10 for 10%)"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Percentage will be calculated on metal cost"}),b.making_charge_percentage&&e.jsx("span",{className:"text-xs text-rose-500",children:b.making_charge_percentage})]}),b.making_charge_types&&r.making_charge_types&&r.making_charge_types.length>0&&e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"block text-xs text-rose-500",children:b.making_charge_types})})]})]})})]}),e.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-xl shadow-slate-900/10",children:[e.jsx("div",{className:"flex flex-col gap-3 border-b border-slate-100 pb-4 lg:flex-row lg:items-center lg:justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Product description"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Provide merchandising copy, craftsmanship details, and any atelier notes for this SKU."})]})}),e.jsxs("div",{className:"mt-6",children:[e.jsx(Re,{value:te,onChange:be,className:"overflow-hidden rounded-3xl border border-slate-200",placeholder:"Detail the design notes, materials, finish, and atelier craftsmanship."}),b.description&&e.jsx("span",{className:"mt-2 block text-xs text-rose-500",children:b.description})]})]}),e.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-xl shadow-slate-900/10",children:[e.jsx("div",{className:"flex flex-col gap-4 border-b border-slate-100 pb-4 lg:flex-row lg:items-center lg:justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Product media"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Upload product images or videos for catalogue displays. You can also remove outdated media assets."})]})}),e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-[0.3em] text-slate-400",children:"Current media"}),e.jsx("div",{className:"mt-3 grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:fe.length>0?fe.map(t=>e.jsxs("div",{className:`relative overflow-hidden rounded-3xl border border-slate-200 bg-slate-50 shadow-sm transition ${ge(t.id)?"opacity-50 ring-2 ring-rose-200":""}`,children:[t.type==="video"?e.jsx("video",{src:t.url,className:"h-48 w-full rounded-t-3xl bg-black object-cover",controls:!0,onError:s=>{console.error("Video load error:",t.url),s.target.style.display="none"},children:"Your browser does not support the video tag."}):e.jsx("img",{src:t.url,alt:"Product media",className:"h-48 w-full rounded-t-3xl object-cover",onError:s=>{console.error("Image load error:",t.url),s.target.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="400" height="300"%3E%3Crect fill="%23ddd" width="400" height="300"/%3E%3Ctext fill="%23999" font-family="sans-serif" font-size="18" x="50%25" y="50%25" text-anchor="middle" dy=".3em"%3EImage not found%3C/text%3E%3C/svg%3E'}}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 text-xs text-slate-500",children:[e.jsx("span",{className:"rounded-full bg-white/70 px-3 py-1 font-semibold text-slate-700",children:t.type.toUpperCase()}),e.jsx("button",{type:"button",onClick:()=>Ve(t.id),className:"text-rose-500 transition hover:text-rose-600",children:ge(t.id)?"Undo removal":"Remove"})]})]},t.id)):e.jsx("p",{className:"rounded-2xl border border-dashed border-slate-200 px-4 py-6 text-sm text-slate-500",children:"No media uploaded yet."})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-[0.3em] text-slate-400",children:"Upload new files"}),e.jsxs("label",{className:"mt-3 flex cursor-pointer flex-col items-center justify-center gap-3 rounded-3xl border border-dashed border-slate-300 bg-slate-50 px-6 py-10 text-center text-slate-500 transition hover:border-slate-400 hover:bg-slate-100",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-slate-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 15a4 4 0 014-4h10a4 4 0 014 4v3a2 2 0 01-2 2H5a2 2 0 01-2-2v-3z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 10l5-5m0 0l5 5m-5-5v12"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-700",children:"Click to upload"}),e.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"JPEG, PNG, WebP, MP4 up to 50MB each."})]}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:Pe,className:"hidden"})]}),he.length>0&&e.jsx("ul",{className:"mt-3 space-y-1",children:he.map((t,s)=>e.jsx("li",{className:"text-xs text-rose-500",children:t},`${s}-${t}`))}),(r.media_uploads??[]).length>0&&e.jsx("ul",{className:"mt-4 space-y-2",children:(r.media_uploads??[]).map((t,s)=>e.jsxs("li",{className:"flex items-center justify-between rounded-2xl border border-slate-200 px-4 py-2 text-sm text-slate-600",children:[e.jsx("span",{className:"truncate",children:t.name}),e.jsx("button",{type:"button",onClick:()=>Ae(s),className:"text-rose-500 transition hover:text-rose-600",children:"Remove"})]},`${t.name}-${s}`))})]})]})]}),e.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-xl shadow-slate-900/10",children:[e.jsx("div",{className:"flex flex-col gap-3 border-b border-slate-100 pb-4 lg:flex-row lg:items-center lg:justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Variant configuration"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Decide whether this product uses a single price or multiple combinations across metals and diamonds."})]})}),e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900 mb-2",children:"Variant Configuration Options"}),e.jsx("p",{className:"text-xs text-slate-600 mb-4",children:"Use the configuration buttons in the variant table below to add metals (with purity and tone) and diamonds to each variant."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-sky-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 13h8l-4-4m0 8l4-4"})}),e.jsx("span",{className:"text-slate-700",children:"Configure Metals"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-sky-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{className:"text-slate-700",children:"Configure Diamonds"})]})]})]}),e.jsxs("div",{className:"space-y-4 rounded-2xl border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-[0.3em] text-slate-500",children:"Size dimension"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Maintain consistent size data across variants. Add numeric values and choose the preferred unit."})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-slate-600",children:[e.jsx("input",{type:"checkbox",checked:r.size_dimension_enabled,onChange:t=>ve(t.target.checked),className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500"}),"Use size dimension"]})]}),r.size_dimension_enabled&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:[e.jsx("span",{children:"Unit"}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-slate-600",children:[e.jsx("input",{type:"radio",name:"size-unit",value:"mm",checked:r.size_unit==="mm",onChange:()=>ce("mm"),className:"h-4 w-4 border-slate-300 text-sky-600 focus:ring-sky-500"}),"Millimetres (mm)"]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-slate-600",children:[e.jsx("input",{type:"radio",name:"size-unit",value:"cm",checked:r.size_unit==="cm",onChange:()=>ce("cm"),className:"h-4 w-4 border-slate-300 text-sky-600 focus:ring-sky-500"}),"Centimetres (cm)"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",step:"0.001",min:"0",value:re,onChange:t=>oe(t.target.value),className:"w-24 rounded-2xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:`e.g. 25${r.size_unit}`}),e.jsx("button",{type:"button",onClick:ke,className:"inline-flex items-center gap-2 rounded-full border border-slate-300 px-4 py-1.5 text-xs font-semibold uppercase tracking-[0.2em] text-slate-600 transition hover:border-slate-400 hover:text-slate-900",children:"Add size"})]}),(r.size_values||[]).length===0&&e.jsx("span",{className:"text-xs text-slate-400",children:"Add at least one size value to use in the variant matrix."})]}),(r.size_values||[]).length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:(r.size_values||[]).map(t=>e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-slate-300 bg-slate-50 px-3 py-1 text-xs font-semibold text-slate-600",children:[t,r.size_unit,e.jsx("button",{type:"button",onClick:()=>we(t),className:"text-rose-500 transition hover:text-rose-600","aria-label":`Remove size ${t}${r.size_unit}`,children:"×"})]},`${t}-${r.size_unit}`))})]})]}),e.jsxs("div",{className:"space-y-4 rounded-2xl border border-slate-200 p-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-[0.3em] text-slate-500",children:"Metals"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Select metals that can be used in your product variants."})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:T.map(t=>{const s=(r.selected_metals||[]).includes(t.id);return e.jsxs("label",{className:`
                                                    inline-flex items-center justify-center rounded-full px-4 py-2 text-sm font-medium transition-all cursor-pointer
                                                    ${s?"bg-sky-600 text-white shadow-sm":"border border-slate-200 bg-white text-slate-700 hover:border-slate-300"}
                                                `,children:[e.jsx("input",{type:"checkbox",checked:s,onChange:n=>{d(o=>{const i=o.selected_metals||[],a=n.target.checked?[...i,t.id]:i.filter(f=>f!==t.id),h={...o.metal_configurations||{}};return n.target.checked?h[t.id]||(h[t.id]={purities:[],tones:[]}):delete h[t.id],{...o,selected_metals:a,metal_configurations:h}})},className:`mr-2 h-4 w-4 rounded border-2 ${s?"border-white bg-white text-sky-600":"border-slate-300 bg-white text-slate-700"} focus:ring-2 focus:ring-sky-500 focus:ring-offset-0`}),t.name]},t.id)})}),e.jsx("div",{className:"space-y-4",children:T.map(t=>{if(!(r.selected_metals||[]).includes(t.id))return null;const n=(r.metal_configurations||{})[t.id]||{purities:[],tones:[]},o=B.filter(p=>p.metal_id===t.id),i=q.filter(p=>p.metal_id===t.id),a=n.purities.length>0?n.purities.length:o.length>0?o.length:1,h=n.tones.length>0?n.tones.length:i.length>0?i.length:1,f=a*h;return e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-4",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-900",children:["Metal: ",t.name]}),f>0&&e.jsxs("span",{className:"text-xs font-medium text-sky-600",children:[f," variant",f!==1?"s":""," for this metal"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"mb-3 text-xs text-slate-600",children:["Choose all purities in which this design is available for ",t.name,"."]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:o.map(p=>{const x=n.purities.includes(p.id);return e.jsxs("label",{className:`
                                                                        inline-flex items-center justify-center rounded-full px-4 py-2 text-sm font-medium transition-all cursor-pointer
                                                                        ${x?"bg-sky-600 text-white shadow-sm":"border border-slate-200 bg-white text-slate-700 hover:border-slate-300"}
                                                                    `,children:[e.jsx("input",{type:"checkbox",checked:x,onChange:k=>{d(l=>{const _={...l.metal_configurations||{}};_[t.id]||(_[t.id]={purities:[],tones:[]});const j=_[t.id].purities||[];return _[t.id].purities=k.target.checked?[...j,p.id]:j.filter(u=>u!==p.id),{...l,metal_configurations:_}})},className:`mr-2 h-4 w-4 rounded border-2 ${x?"border-white bg-white text-sky-600":"border-slate-300 bg-white text-slate-700"} focus:ring-2 focus:ring-sky-500 focus:ring-offset-0`}),p.name]},p.id)})})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"mb-3 text-xs text-slate-600",children:["Choose all tones in which this design is available for ",t.name,"."]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:i.map(p=>{const x=n.tones.includes(p.id);return e.jsxs("label",{className:`
                                                                        inline-flex items-center justify-center rounded-full px-4 py-2 text-sm font-medium transition-all cursor-pointer
                                                                        ${x?"bg-sky-600 text-white shadow-sm":"border border-slate-200 bg-white text-slate-700 hover:border-slate-300"}
                                                                    `,children:[e.jsx("input",{type:"checkbox",checked:x,onChange:k=>{d(l=>{const _={...l.metal_configurations||{}};_[t.id]||(_[t.id]={purities:[],tones:[]});const j=_[t.id].tones||[];return _[t.id].tones=k.target.checked?[...j,p.id]:j.filter(u=>u!==p.id),{...l,metal_configurations:_}})},className:`mr-2 h-4 w-4 rounded border-2 ${x?"border-white bg-white text-sky-600":"border-slate-300 bg-white text-slate-700"} focus:ring-2 focus:ring-sky-500 focus:ring-offset-0`}),p.name]},p.id)})})]})]},t.id)})})]}),(()=>{const t=r.selected_metals||[],s=r.metal_configurations||{};let n=0;t.forEach(h=>{const f=s[h]||{purities:[],tones:[]},p=B.filter(_=>_.metal_id===h),x=q.filter(_=>_.metal_id===h),k=f.purities.length>0?f.purities.length:p.length>0?p.length:1,l=f.tones.length>0?f.tones.length:x.length>0?x.length:1;n+=k*l});const o=r.size_dimension_enabled&&(r.size_values||[]).length>0?(r.size_values||[]).length:1,i=(r.diamond_selections||[]).length>0?(r.diamond_selections||[]).length:1,a=n>0?n*o*i:o*i;return t.length>0||r.size_dimension_enabled||(r.diamond_selections||[]).length>0?e.jsx("div",{className:"rounded-2xl border border-slate-200 bg-white p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Preview generated variants"}),e.jsxs("p",{className:"mt-1 text-xs text-slate-600",children:["This setup will generate approximately ",a," variant",a!==1?"s":""," based on your current configuration."]})]}),e.jsx("button",{type:"button",onClick:xe,className:"inline-flex items-center gap-2 rounded-full border border-slate-300 bg-white px-4 py-2 text-sm font-semibold text-slate-700 transition hover:border-slate-400 hover:bg-slate-50",children:"Regenerate matrix"})]})}):null})(),e.jsxs("div",{className:"space-y-4 rounded-2xl border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-[0.3em] text-slate-500",children:"Diamonds"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Select diamonds and specify counts for your product variants."})]}),e.jsxs("button",{type:"button",onClick:Ce,className:"inline-flex items-center gap-2 rounded-full border border-slate-300 bg-white px-3 py-1.5 text-xs font-semibold text-slate-700 transition hover:border-sky-400 hover:bg-sky-50",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 5v14M5 12h14"})}),"Add Diamond"]})]}),(r.diamond_selections||[]).length>0?e.jsx("div",{className:"space-y-3",children:(r.diamond_selections||[]).map((t,s)=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border border-slate-200 bg-white p-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"mb-1 block text-xs font-semibold text-slate-600",children:"Diamond"}),e.jsxs("select",{value:t.diamond_id===""?"":t.diamond_id,onChange:n=>me(s,"diamond_id",n.target.value===""?"":Number(n.target.value)),className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[e.jsx("option",{value:"",children:"Select diamond"}),R.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})]}),e.jsxs("div",{className:"w-32",children:[e.jsx("label",{className:"mb-1 block text-xs font-semibold text-slate-600",children:"Count"}),e.jsx("input",{type:"number",min:"0",step:"1",value:t.count,onChange:n=>me(s,"count",n.target.value),className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"0"})]}),e.jsx("button",{type:"button",onClick:()=>Se(s),className:"mt-6 rounded-full border border-rose-200 p-2 text-rose-600 transition hover:border-rose-300 hover:text-rose-700","aria-label":"Remove diamond",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]},s))}):e.jsx("p",{className:"text-xs text-slate-400",children:'No diamonds added. Click "Add Diamond" to add one.'})]})]})]}),e.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-xl shadow-slate-900/10 ring-1 ring-slate-200/80",children:[e.jsxs("div",{className:"flex flex-col gap-4 border-b border-slate-200 pb-6 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Variant Matrix"}),e.jsx("p",{className:"mt-2 text-sm text-slate-500",children:"Configure product variants with metals and diamonds. The default variant powers the customer catalogue card pricing."})]}),e.jsxs("button",{type:"button",onClick:xe,className:"inline-flex items-center gap-2 rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-lg shadow-slate-900/20 transition hover:bg-slate-700",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h7"})}),"Generate Matrix"]})]}),pe&&e.jsx("div",{className:"mt-6 rounded-2xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-600 ring-1 ring-rose-200/50",children:pe}),e.jsx("div",{className:"mt-8 overflow-hidden rounded-3xl bg-white shadow-xl shadow-slate-900/10 ring-1 ring-slate-200/80",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200 text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-xs text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-5 py-3 text-left min-w-[150px]",children:"SKU"}),e.jsx("th",{className:"px-5 py-3 text-left min-w-[300px]",children:"Variant Label"}),e.jsx("th",{className:"px-5 py-3 text-left min-w-[250px]",children:"Metal"}),e.jsx("th",{className:"px-5 py-3 text-left min-w-[250px]",children:"Diamonds"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Inventory Quantity"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Status"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Default"}),e.jsx("th",{className:"px-5 py-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 bg-white",children:[(r.variants||[]).map((t,s)=>{const n=ne(t,r);n.metalTone;const o=(t.metals||[]).filter(l=>l.metal_id!==""&&l.metal_id!==null&&typeof l.metal_id=="number");o.reduce((l,_)=>{const j=parseFloat(_.metal_weight||"0");return l+(isNaN(j)?0:j)},0);const i=new Map;o.forEach(l=>{const _=l.metal_id;i.has(_)||i.set(_,[]),i.get(_).push({metal_id:_,metal_purity_id:l.metal_purity_id!==""&&l.metal_purity_id!==null?typeof l.metal_purity_id=="number"?l.metal_purity_id:Number(l.metal_purity_id):null,metal_tone_id:l.metal_tone_id!==""&&l.metal_tone_id!==null?typeof l.metal_tone_id=="number"?l.metal_tone_id:Number(l.metal_tone_id):null})});const a=[],h=[];i.forEach((l,_)=>{const j=J[_]||"",u=new Set,C=new Set;if(l.forEach(c=>{if(c.metal_purity_id!==null){const g=typeof c.metal_purity_id=="number"?c.metal_purity_id:Number(c.metal_purity_id);Number.isFinite(g)&&u.add(g)}if(c.metal_tone_id!==null){const g=typeof c.metal_tone_id=="number"?c.metal_tone_id:Number(c.metal_tone_id);Number.isFinite(g)&&C.add(g)}}),u.size>0){const c=Array.from(u).map(g=>{const M=typeof g=="number"?g:Number(g);return Number.isFinite(M)&&Y[M]||""}).filter(Boolean).sort();c.length>0&&(u.size>1?a.push(`${c.join(" + ")} (${j})`):a.push(`${c[0]} (${j})`))}if(C.size>0){const c=Array.from(C).map(g=>{const M=typeof g=="number"?g:Number(g);return Number.isFinite(M)&&ee[M]||""}).filter(Boolean).sort();c.length>0&&(C.size>1?h.push(`${c.join(" + ")} (${j})`):h.push(`${c[0]} (${j})`))}});let f=[];const p=(t.diamonds||[]).filter(l=>l.diamond_id!==""&&l.diamond_id!==null&&l.diamond_id!==void 0).map(l=>({diamond_id:typeof l.diamond_id=="number"?l.diamond_id:Number(l.diamond_id),diamonds_count:l.diamonds_count||""}));p.length>0?f=p:(t.diamonds||[]).length>0?f=(t.diamonds||[]).map(l=>({diamond_id:null,diamonds_count:l.diamonds_count||""})):(r.diamond_selections||[]).length>0&&(f=(r.diamond_selections||[]).filter(l=>l.diamond_id!==""&&l.diamond_id!==null&&l.diamond_id!==void 0).map(l=>({diamond_id:typeof l.diamond_id=="number"?l.diamond_id:Number(l.diamond_id),diamonds_count:l.count||""})));const x=t.metadata??{};(typeof x.size_value=="string"||typeof x.size_value=="number")&&String(x.size_value),(x.size_unit==="mm"||x.size_unit==="cm")&&x.size_unit;const k=typeof x.status=="string"&&x.status.trim().length>0?String(x.status):"enabled";return n.autoLabel,e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`hover:bg-slate-50 ${k==="disabled"?"opacity-70":""} ${t.is_default?"bg-sky-50/30":""}`,children:[e.jsxs("td",{className:"px-5 py-3 align-middle min-w-[150px]",children:[e.jsx("input",{type:"text",value:t.sku,onChange:l=>se(s,"sku",l.target.value),className:"w-full min-w-[120px] rounded-xl border border-slate-200 px-3 py-1.5 text-sm text-slate-700 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Variant SKU"}),b[`variants.${s}.sku`]&&e.jsx("p",{className:"mt-1 text-xs text-rose-500",children:b[`variants.${s}.sku`]})]}),e.jsxs("td",{className:"px-5 py-3 align-middle min-w-[300px]",children:[e.jsx("input",{type:"text",value:t.label,onChange:l=>se(s,"label",l.target.value),className:"w-full min-w-[280px] rounded-xl border border-slate-200 px-3 py-1.5 text-sm text-slate-700 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Display label"}),b[`variants.${s}.label`]&&e.jsx("p",{className:"mt-1 text-xs text-rose-500",children:b[`variants.${s}.label`]})]}),e.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:e.jsx("div",{className:"space-y-3 min-w-[250px]",children:o.length>0?o.map((l,_)=>{const j=J[l.metal_id]||"Unknown Metal",u=l.metal_purity_id&&typeof l.metal_purity_id=="number"&&B.find(g=>g.id===l.metal_purity_id)?.name||"",C=l.metal_tone_id&&typeof l.metal_tone_id=="number"&&q.find(g=>g.id===l.metal_tone_id)?.name||"",c=l.metal_weight||"";return e.jsxs("div",{className:"flex flex-col gap-2 rounded-lg border border-slate-200 bg-slate-50/50 p-3",children:[e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white px-3 py-2",children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Metal"}),e.jsx("div",{className:"text-sm font-semibold text-slate-800",children:j})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white px-3 py-2",children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Purity"}),e.jsx("div",{className:"text-sm text-slate-700",children:u||"—"})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white px-3 py-2",children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Tone"}),e.jsx("div",{className:"text-sm text-slate-700",children:C||"—"})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white px-3 py-2",children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1.5",children:"Weight (g)"}),e.jsx("input",{type:"number",step:"0.001",min:"0.001",required:!0,value:c,onChange:g=>{const M=g.target.value;ue(s,_,"metal_weight",M)},className:`w-full rounded-lg border px-2.5 py-1.5 text-sm font-mono transition-colors ${!c||c===""?"border-rose-300 bg-rose-50 text-rose-500 focus:border-rose-400 focus:bg-white":"border-slate-200 bg-white text-slate-700 focus:border-sky-400"} focus:outline-none focus:ring-1 focus:ring-sky-200`,placeholder:"0.000"}),(!c||c==="")&&e.jsx("span",{className:"mt-1 text-[10px] text-rose-500",children:"Required"})]})]},_)}):e.jsx("span",{className:"text-sm text-slate-400",children:"—"})})}),e.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:e.jsx("div",{className:"space-y-3 min-w-[250px]",children:f.length>0?f.map((l,_)=>{const j=l.diamond_id&&R?.find(C=>C.id===l.diamond_id)?.name||"Diamond",u=l.diamonds_count||"";return e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border border-slate-200 bg-slate-50/50 p-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Diamond"}),e.jsx("div",{className:"text-sm font-semibold text-slate-800",children:j})]}),e.jsxs("div",{className:"w-24",children:[e.jsx("div",{className:"text-xs font-medium text-slate-500 mb-1",children:"Count"}),e.jsx("input",{type:"number",min:"1",step:"1",required:!0,value:u,onChange:C=>{const c=C.target.value;ae(s,_,"diamonds_count",c)},className:`w-full rounded-lg border px-2.5 py-1.5 text-sm font-mono transition-colors ${!u||u===""?"border-rose-300 bg-rose-50 text-rose-500 focus:border-rose-400 focus:bg-white":"border-slate-200 bg-white text-slate-700 focus:border-sky-400"} focus:outline-none focus:ring-1 focus:ring-sky-200`,placeholder:"0"})]})]},_)}):e.jsx("span",{className:"text-sm text-slate-400",children:"—"})})}),e.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("input",{type:"number",min:"0",step:"1",required:!0,value:t.inventory_quantity!==void 0&&t.inventory_quantity!==null&&t.inventory_quantity!==""?String(t.inventory_quantity):"",onChange:l=>{const _=l.target.value.trim();if(_==="")se(s,"inventory_quantity","");else{const j=parseInt(_,10);!isNaN(j)&&j>=0&&se(s,"inventory_quantity",j)}},className:`w-full min-w-[100px] rounded-xl border px-3 py-1.5 text-sm text-slate-700 transition-colors ${t.inventory_quantity===void 0||t.inventory_quantity===null||t.inventory_quantity===""?"border-rose-300 bg-rose-50 text-rose-500 focus:border-rose-400 focus:bg-white":"border-slate-200 bg-white focus:border-sky-400"} focus:outline-none focus:ring-2 focus:ring-sky-200`,placeholder:"0"}),(t.inventory_quantity===void 0||t.inventory_quantity===null||t.inventory_quantity==="")&&e.jsx("span",{className:"text-[10px] text-rose-500",children:"Required"})]})}),e.jsx("td",{className:"px-5 py-3 text-slate-700",children:e.jsxs("select",{value:k,onChange:l=>$e(s,{status:l.target.value}),className:`rounded-xl border px-3 py-1.5 text-sm text-slate-700 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200 ${k==="enabled"?"border-emerald-300 bg-emerald-50":"border-amber-300 bg-amber-50"}`,children:[e.jsx("option",{value:"enabled",children:"Enabled"}),e.jsx("option",{value:"disabled",children:"Disabled"})]})}),e.jsx("td",{className:"px-5 py-3 text-slate-700",children:e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-slate-600",children:[e.jsx("input",{type:"radio",name:"default-variant-table",checked:t.is_default,onChange:()=>Me(s),className:"h-4 w-4 text-sky-600 focus:ring-sky-500"}),e.jsx("span",{children:t.is_default?"Default":"Set default"})]})}),e.jsx("td",{className:"px-5 py-3 text-right",children:e.jsx("div",{className:"flex items-center justify-end gap-2",children:e.jsx("button",{type:"button",onClick:()=>ze(s),className:"inline-flex items-center justify-center rounded-full border border-rose-200 p-1.5 text-rose-600 transition hover:border-rose-300 hover:text-rose-700","aria-label":"Remove variant",title:"Remove Variant",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,className:"h-4 w-4",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 7h12m-9 3v6m6-6v6M10 4h4a1 1 0 0 1 1 1v1H9V5a1 1 0 0 1 1-1Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 7h14l-.8 11.2A2 2 0 0 1 16.2 20H7.8a2 2 0 0 1-1.99-1.8L5 7Z"})]})})})})]},t.id??`variant-${s}`),je.has(s)&&e.jsx("tr",{children:e.jsx("td",{colSpan:13,className:"px-5 py-4",children:e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4",children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900",children:"Metals for this Variant"}),e.jsxs("p",{className:"mt-1 text-xs text-slate-600",children:[e.jsx("span",{className:"font-semibold text-rose-600",children:"Required:"})," Enter metal weight (in grams) for each metal in this variant."]})]})}),o.length===0?e.jsx("p",{className:"text-xs text-slate-400",children:"No metals assigned to this variant."}):e.jsx("div",{className:"space-y-3",children:o.map((l,_)=>{const j=J[l.metal_id]||"Unknown Metal",u=l.metal_purity_id&&typeof l.metal_purity_id=="number"&&B.find(c=>c.id===l.metal_purity_id)?.name||"",C=l.metal_tone_id&&typeof l.metal_tone_id=="number"&&q.find(c=>c.id===l.metal_tone_id)?.name||"";return e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-4",children:[e.jsx("div",{className:"mb-3 flex items-center justify-between",children:e.jsxs("span",{className:"text-xs font-semibold text-slate-600",children:[j,u&&` — ${u}`,C&&` — ${C}`]})}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-3",children:e.jsxs("label",{className:"flex flex-col gap-1.5",children:[e.jsxs("span",{className:"text-xs font-semibold text-slate-700 flex items-center gap-1",children:[e.jsx("span",{children:"Metal Weight (g)"}),e.jsx("span",{className:"text-rose-500 font-bold text-sm",title:"Required field",children:"*"})]}),e.jsx("input",{type:"number",step:"0.001",min:"0.001",required:!0,value:l.metal_weight||"",onChange:c=>{const g=c.target.value;ue(s,_,"metal_weight",g)},className:`rounded-xl border-2 px-3 py-2 text-sm font-medium transition-colors ${l.metal_weight?"border-slate-200 bg-white focus:border-sky-400":"border-rose-300 bg-rose-50 focus:border-rose-400 focus:bg-white"} focus:outline-none focus:ring-2 focus:ring-sky-200`,placeholder:"Enter weight (required)"}),!l.metal_weight&&e.jsx("span",{className:"text-xs text-rose-600 font-medium",children:"⚠️ This field is required"})]})})]},_)})})]})})}),ye.has(s)&&e.jsx("tr",{children:e.jsx("td",{colSpan:13,className:"px-5 py-4",children:e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4",children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-900",children:"Diamonds for this Variant"}),e.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"This variant uses the shared diamond list defined above. All variants share the same diamonds."})]})}),f.length===0?e.jsx("p",{className:"text-xs text-slate-400",children:"No diamonds assigned to this variant from the shared matrix."}):e.jsx("div",{className:"space-y-3",children:f.map((l,_)=>e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-semibold text-slate-600",children:["Diamond #",_+1]}),e.jsx("button",{type:"button",onClick:()=>Le(s,_),className:"text-xs text-rose-500 transition hover:text-rose-700",children:"Remove"})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs("label",{className:"flex flex-col gap-1.5 text-xs font-medium text-slate-600",children:["Diamond",e.jsxs("select",{value:typeof l.diamond_id=="string"||!l.diamond_id?"":String(l.diamond_id),onChange:j=>ae(s,_,"diamond_id",j.target.value===""?"":Number(j.target.value)),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[e.jsx("option",{value:"",children:"Select diamond"}),(R||[]).map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))]})]}),e.jsxs("label",{className:"flex flex-col gap-1.5 text-xs font-medium text-slate-600",children:["Number of Diamonds",e.jsx("input",{type:"number",step:"1",min:"0",value:l.diamonds_count,onChange:j=>ae(s,_,"diamonds_count",j.target.value),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"0"})]})]})]},_))})]})})})]})}),(r.variants||[]).length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:17,className:"px-5 py-6 text-center text-xs uppercase tracking-[0.1em] text-slate-400",children:"No variants configured. Generate matrix to create variants."})})]})]})})})]})]})]})}export{Je as default};
