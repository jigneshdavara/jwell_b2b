import{u as q,r as i,j as e,H as B,b as p}from"./app-CQCZKZrJ.js";import{A as P}from"./AdminLayout-BZicIsUi.js";import{C as w}from"./ConfirmationModal-BcfsSNSy.js";import"./Modal-BSfrKywo.js";import"./transition-HN-EBMLS.js";import"./SecondaryButton-CiqsN9c_.js";function J(){const{users:m,userGroups:j,availableTypes:h,errors:l}=q().props,[a,n]=i.useState({name:"",email:"",password:"",password_confirmation:"",user_group_id:"",type:h[0]?.value??"admin"}),[r,g]=i.useState(null),[o,c]=i.useState([]),[x,b]=i.useState(null),[_,y]=i.useState(!1),k=(s,t)=>{d(s)||p.patch(route("admin.users.group.update",s.id),{user_group_id:t||null},{preserveScroll:!0,preserveState:!0})},S=s=>{s.preventDefault();const t={name:a.name,email:a.email,user_group_id:a.user_group_id||null,type:a.type};a.password&&(t.password=a.password,t.password_confirmation=a.password_confirmation);const f=()=>{n({name:"",email:"",password:"",password_confirmation:"",user_group_id:"",type:h[0]?.value??"admin"}),g(null)};r?p.patch(route("admin.users.update",r.id),t,{preserveScroll:!0,onSuccess:()=>f()}):p.post(route("admin.users.store"),{...a,user_group_id:a.user_group_id||null},{preserveScroll:!0,onSuccess:()=>f()})},C=s=>{g(s),n({name:s.name,email:s.email,password:"",password_confirmation:"",user_group_id:s.user_group?.id?String(s.user_group.id):"",type:s.type})},N=()=>{g(null),n({name:"",email:"",password:"",password_confirmation:"",user_group_id:"",type:h[0]?.value??"admin"})},d=s=>s.type==="super-admin",u=i.useMemo(()=>m.data.filter(s=>!d(s)).map(s=>s.id),[m.data]),v=u.length>0&&u.every(s=>o.includes(s));i.useEffect(()=>{c(s=>s.filter(t=>u.includes(t)))},[u]);const U=s=>{d(s)||c(t=>t.includes(s.id)?t.filter(f=>f!==s.id):[...t,s.id])},D=()=>{c(v?[]:u)},A=s=>{d(s)||b(s)},E=()=>{x&&p.delete(route("admin.users.destroy",x.id),{preserveScroll:!0,onSuccess:()=>{c(s=>s.filter(t=>t!==x.id)),r?.id===x.id&&N(),b(null)}})},T=()=>{o.length!==0&&y(!0)},I=()=>{p.delete(route("admin.users.bulk-destroy"),{data:{ids:o},preserveScroll:!0,onSuccess:()=>{c([]),y(!1)}})},L=r?`Edit ${r.name}`:"Create user";return e.jsxs(P,{children:[e.jsx(B,{title:"Users"}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-xl shadow-slate-900/10 ring-1 ring-slate-200/80",children:[e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"User directory"}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Create admin accounts and limit what they see by assigning user groups."})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("button",{type:"button",onClick:T,disabled:o.length===0,className:"rounded-full border border-rose-200 px-4 py-2 font-semibold text-rose-600 transition hover:border-rose-300 hover:text-rose-700 disabled:cursor-not-allowed disabled:opacity-40",children:["Bulk delete (",o.length,")"]}),r&&e.jsx("button",{type:"button",onClick:N,className:"rounded-full border border-slate-300 px-4 py-2 font-semibold text-slate-600 transition hover:border-slate-400 hover:text-slate-900",children:"Cancel edit"})]})]}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Only accounts with admin access should live here. Keep at least one Super Admin active at all times."})]}),e.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-xl shadow-slate-900/10 ring-1 ring-slate-200/80",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:L}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"New team accounts default to admin-level access and can be restricted by assigning a user group."}),e.jsxs("form",{onSubmit:S,className:"mt-6 grid gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Name"}),e.jsx("input",{type:"text",value:a.name,onChange:s=>n(t=>({...t,name:s.target.value})),required:!0,className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),l?.name&&e.jsx("span",{className:"text-xs text-rose-500",children:l.name})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Email"}),e.jsx("input",{type:"email",value:a.email,onChange:s=>n(t=>({...t,email:s.target.value})),required:!0,className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),l?.email&&e.jsx("span",{className:"text-xs text-rose-500",children:l.email})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Password"}),e.jsx("input",{type:"password",value:a.password,onChange:s=>n(t=>({...t,password:s.target.value})),required:!r,className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",minLength:8}),l?.password&&e.jsx("span",{className:"text-xs text-rose-500",children:l.password}),r&&e.jsx("span",{className:"text-xs text-slate-400",children:"Leave blank to keep the existing password."}),l?.password_confirmation&&e.jsx("span",{className:"text-xs text-rose-500",children:l.password_confirmation})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Confirm password"}),e.jsx("input",{type:"password",value:a.password_confirmation,onChange:s=>n(t=>({...t,password_confirmation:s.target.value})),required:!r,className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",minLength:8})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"User role"}),e.jsx("select",{value:a.type,onChange:s=>n(t=>({...t,type:s.target.value,user_group_id:s.target.value==="super-admin"?"":t.user_group_id})),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",disabled:r?.type==="super-admin",children:h.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),l?.type&&e.jsx("span",{className:"text-xs text-rose-500",children:l.type})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600 md:col-span-2 md:max-w-xs",children:[e.jsx("span",{children:"User group (optional)"}),a.type==="super-admin"||r?.type==="super-admin"?e.jsx("div",{className:"rounded-2xl border border-dashed border-slate-200 px-4 py-2 text-sm text-slate-400",children:"Super administrators bypass group restrictions."}):e.jsxs("select",{value:a.user_group_id,onChange:s=>n(t=>({...t,user_group_id:s.target.value})),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[e.jsx("option",{value:"",children:"Admin (no restrictions)"}),j.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),l?.user_group_id&&e.jsx("span",{className:"text-xs text-rose-500",children:l.user_group_id})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx("button",{type:"submit",className:"rounded-full bg-slate-900 px-5 py-2 text-sm font-semibold text-white shadow shadow-slate-900/20 transition hover:bg-slate-700",children:r?"Save changes":"Create user"})})]})]}),e.jsx("div",{className:"overflow-hidden rounded-3xl bg-white shadow-xl shadow-slate-900/10 ring-1 ring-slate-200/80",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200 text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-xs uppercase tracking-[0.3em] text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-5 py-3",children:e.jsx("input",{type:"checkbox",checked:v,onChange:D,className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500","aria-label":"Select all users"})}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Name"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Email"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Role"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"User group"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Joined"}),e.jsx("th",{className:"px-5 py-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 bg-white",children:m.data.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-5 py-6 text-center text-sm text-slate-500",children:"No team users found."})}):m.data.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"px-5 py-3",children:e.jsx("input",{type:"checkbox",checked:o.includes(s.id),onChange:()=>U(s),disabled:d(s),className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500 disabled:cursor-not-allowed disabled:opacity-40","aria-label":`Select ${s.name}`})}),e.jsx("td",{className:"px-5 py-3 font-medium text-slate-900",children:s.name}),e.jsx("td",{className:"px-5 py-3 text-slate-600",children:s.email}),e.jsx("td",{className:"px-5 py-3 text-slate-500",children:s.type_label||"Admin"}),e.jsx("td",{className:"px-5 py-3 text-slate-600",children:d(s)?e.jsx("span",{className:"rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold uppercase tracking-[0.18em] text-slate-500",children:"Super admin"}):e.jsxs("select",{value:s.user_group?.id??"",onChange:t=>k(s,t.target.value),className:"rounded-2xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[e.jsx("option",{value:"",children:"No group assigned"}),j.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})}),e.jsx("td",{className:"px-5 py-3 text-slate-500",children:s.joined_at?new Date(s.joined_at).toLocaleDateString("en-IN"):"â€”"}),e.jsx("td",{className:"px-5 py-3 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>C(s),className:"rounded-full border border-slate-300 px-4 py-1 text-xs font-semibold text-slate-600 transition hover:border-slate-400 hover:text-slate-900",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>A(s),disabled:d(s),className:"rounded-full border border-rose-200 px-4 py-1 text-xs font-semibold text-rose-600 transition hover:border-rose-300 hover:text-rose-700 disabled:cursor-not-allowed disabled:opacity-40",children:"Delete"})]})})]},s.id))})]})})]}),e.jsx(w,{show:x!==null,onClose:()=>b(null),onConfirm:E,title:"Delete User Account",message:"Are you sure you want to delete this user account? This action cannot be undone.",confirmText:"Delete",variant:"danger"}),e.jsx(w,{show:_,onClose:()=>y(!1),onConfirm:I,title:"Delete Users",message:`Are you sure you want to delete ${o.length} selected user(s)? This action cannot be undone.`,confirmText:"Delete",variant:"danger"})]})}export{J as default};
