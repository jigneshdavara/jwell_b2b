import{u as h,a as i,j as e,H as b,L as d,b as g}from"./app-CPxam-6j.js";import{A as f}from"./AdminLayout-CgpCltH7.js";function y(){const{quotation:s,jobworkStages:c}=h().props,o=i({admin_notes:s.admin_notes??""}),n=i({admin_notes:s.admin_notes??""}),l=i({jobwork_status:s.jobwork_status??"material_sending",admin_notes:s.admin_notes??""}),a=i({message:""}),x=t=>{t.preventDefault(),o.post(route("admin.quotations.approve",s.id),{preserveScroll:!0})},m=t=>{t.preventDefault(),n.post(route("admin.quotations.reject",s.id),{preserveScroll:!0})},u=t=>{t.preventDefault(),l.post(route("admin.quotations.jobwork-status",s.id),{preserveScroll:!0})},p=t=>{t.preventDefault(),a.data.message.trim()&&a.post(route("admin.quotations.messages.store",s.id),{preserveScroll:!0,onSuccess:()=>a.reset("message")})};return e.jsxs(f,{children:[e.jsx(b,{title:`Quotation #${s.id}`}),e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"rounded-3xl bg-white p-6 shadow-xl ring-1 ring-slate-200/80",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-semibold text-slate-900",children:["Quotation #",s.id]}),e.jsxs("p",{className:"mt-1 text-sm text-slate-500",children:["Mode: ",s.mode==="jobwork"?"Jobwork":"Jewellery purchase"," · Status: ",s.status]})]}),e.jsx(d,{href:route("admin.quotations.index"),className:"inline-flex items-center gap-2 rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600 transition hover:border-slate-400 hover:text-slate-900",children:"Back to list"})]})}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.5fr_1fr]",children:[e.jsxs("section",{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-xl ring-1 ring-slate-200/80",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Product"}),e.jsxs("div",{className:"mt-4 flex flex-col gap-4 md:flex-row",children:[s.product.media[0]&&e.jsx("img",{src:s.product.media[0].url,alt:s.product.media[0].alt,className:"h-32 w-32 rounded-2xl object-cover"}),e.jsxs("div",{className:"space-y-2 text-sm text-slate-600",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-semibold text-slate-900",children:s.product.name}),e.jsxs("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-400",children:["SKU ",s.product.sku]})]}),e.jsxs("div",{className:"grid gap-2 text-xs md:grid-cols-2",children:[e.jsxs("span",{className:"rounded-full bg-slate-100 px-3 py-1 font-semibold text-slate-700",children:["Qty ",s.quantity]}),e.jsxs("span",{className:"rounded-full bg-slate-100 px-3 py-1 font-semibold text-slate-700",children:["Base ₹ ",(s.product.base_price??0).toLocaleString("en-IN")]}),e.jsxs("span",{className:"rounded-full bg-slate-100 px-3 py-1 font-semibold text-slate-700",children:["Making ₹ ",(s.product.making_charge??0).toLocaleString("en-IN")]}),s.variant&&e.jsxs("span",{className:"rounded-full bg-slate-100 px-3 py-1 font-semibold text-slate-700",children:["Variant adj. ₹ ",s.variant.price_adjustment.toLocaleString("en-IN")]})]}),s.selections&&e.jsxs("div",{className:"rounded-2xl bg-slate-50 px-4 py-3 text-xs text-slate-500",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"Selections"}),e.jsx("ul",{className:"mt-2 space-y-1",children:Object.entries(s.selections).map(([t,r])=>e.jsxs("li",{children:[e.jsxs("span",{className:"capitalize text-slate-400",children:[t.replace(/_/g," "),":"]})," ",e.jsx("span",{className:"text-slate-700",children:r==null||r===""?"—":String(r)})]},t))})]})]})]})]}),e.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-xl ring-1 ring-slate-200/80",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Customer"}),e.jsxs("div",{className:"mt-3 text-sm text-slate-600",children:[e.jsx("p",{className:"font-semibold text-slate-900",children:s.user?.name??"Unknown"}),e.jsx("p",{className:"text-slate-500",children:s.user?.email}),s.notes&&e.jsxs("div",{className:"mt-3 rounded-2xl bg-slate-50 px-4 py-3 text-xs text-slate-500",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"Customer notes"}),e.jsx("p",{className:"mt-2 whitespace-pre-line",children:s.notes})]})]})]}),s.order&&e.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-xl ring-1 ring-slate-200/80",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Linked order"}),e.jsxs("p",{className:"mt-3 text-sm text-slate-600",children:["Order reference"," ",e.jsx(d,{href:route("admin.orders.show",s.order.id),className:"font-semibold text-sky-600 hover:text-sky-500",children:s.order.reference})," ","· Status ",s.order.status," · Total ₹"," ",s.order.total_amount.toLocaleString("en-IN")]}),s.order?.history?.length?e.jsxs("div",{className:"mt-4 space-y-2 text-xs text-slate-500",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"Status timeline"}),e.jsx("ul",{className:"space-y-2",children:s.order.history.map(t=>e.jsx("li",{className:"rounded-2xl border border-slate-200 px-3 py-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-slate-700",children:t.status.replace(/_/g," ")}),e.jsx("span",{children:t.created_at?new Date(t.created_at).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"})]})},t.id))})]}):null]}),e.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-xl ring-1 ring-slate-200/80",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Conversation"}),e.jsxs("div",{className:"mt-4 space-y-3 max-h-72 overflow-y-auto pr-2 text-sm text-slate-600",children:[s.messages.length===0&&e.jsx("p",{className:"text-xs text-slate-400",children:"No messages yet. Start by sending the customer a note below."}),s.messages.map(t=>e.jsxs("div",{className:`flex flex-col gap-1 rounded-2xl border px-3 py-2 ${t.sender==="admin"?"border-slate-200 bg-white":"border-sky-200 bg-sky-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-[11px] uppercase tracking-[0.25em] text-slate-400",children:[e.jsx("span",{children:t.sender==="admin"?t.author??"Admin":"Customer"}),e.jsx("span",{children:t.created_at?new Date(t.created_at).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"})]}),e.jsx("p",{className:"whitespace-pre-line text-sm text-slate-700",children:t.message})]},t.id))]}),e.jsxs("form",{onSubmit:p,className:"mt-4 space-y-2 text-sm text-slate-600",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{children:"Message"}),e.jsx("textarea",{value:a.data.message,onChange:t=>a.setData("message",t.target.value),className:"min-h-[120px] rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Request more information or share updates with the client...",disabled:a.processing})]}),a.errors.message&&e.jsx("p",{className:"text-xs text-rose-500",children:a.errors.message}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:a.processing||!a.data.message.trim(),className:"rounded-full bg-sky-600 px-4 py-2 text-xs font-semibold text-white shadow-sky-600/30 transition hover:bg-sky-500 disabled:cursor-not-allowed disabled:opacity-60",children:a.processing?"Sending…":"Send message"})})]})]})]}),e.jsxs("aside",{className:"space-y-6",children:[(s.status==="pending"||s.status==="customer_confirmed")&&e.jsxs("form",{onSubmit:x,className:"space-y-4 rounded-3xl bg-white p-6 shadow-xl ring-1 ring-emerald-200/80",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900",children:"Approve quotation"}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Approving will ",s.mode==="jobwork"?"move the request into jobwork workflow.":"create an order in pending payment."]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Internal notes"}),e.jsx("textarea",{value:o.data.admin_notes,onChange:t=>o.setData("admin_notes",t.target.value),className:"min-h-[90px] rounded-2xl border border-slate-200 px-4 py-2 focus:border-emerald-400 focus:outline-none focus:ring-2 focus:ring-emerald-200"})]}),e.jsx("button",{type:"submit",disabled:o.processing,className:"w-full rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-lg shadow-emerald-600/30 transition hover:bg-emerald-500 disabled:cursor-not-allowed disabled:opacity-70",children:"Approve quotation"})]}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),o.reset(),n.reset(),l.reset("admin_notes");const r=new FormData(t.currentTarget);g.post(route("admin.quotations.request-confirmation",s.id),r,{preserveScroll:!0})},className:"space-y-4 rounded-3xl bg-white p-6 shadow-xl ring-1 ring-slate-200/80",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900",children:"Request customer confirmation"}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Quantity"}),e.jsx("input",{type:"number",name:"quantity",defaultValue:s.quantity,min:1,className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Variant"}),e.jsxs("select",{name:"product_variant_id",defaultValue:s.variant?.id??"",className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[e.jsx("option",{value:"",children:"Keep current"}),s.product.variants.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))]})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Notes to customer"}),e.jsx("textarea",{name:"notes",className:"min-h-[80px] rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Explain changes or pricing impact..."})]}),e.jsx("button",{type:"submit",className:"w-full rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600 transition hover:border-slate-400 hover:text-slate-900",children:"Send for customer approval"})]}),s.status!=="rejected"&&e.jsxs("form",{onSubmit:m,className:"space-y-4 rounded-3xl bg-white p-6 shadow-xl ring-1 ring-rose-200/80",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900",children:"Reject quotation"}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Reason / feedback"}),e.jsx("textarea",{value:n.data.admin_notes,onChange:t=>n.setData("admin_notes",t.target.value),className:"min-h-[90px] rounded-2xl border border-slate-200 px-4 py-2 focus:border-rose-400 focus:outline-none focus:ring-2 focus:ring-rose-200"})]}),e.jsx("button",{type:"submit",disabled:n.processing,className:"w-full rounded-full border border-rose-300 px-4 py-2 text-sm font-semibold text-rose-600 transition hover:border-rose-400 hover:text-rose-700 disabled:cursor-not-allowed disabled:opacity-70",children:"Reject quotation"})]}),s.mode==="jobwork"&&s.status==="approved"&&e.jsxs("form",{onSubmit:u,className:"space-y-4 rounded-3xl bg-white p-6 shadow-xl ring-1 ring-sky-200/80",children:[e.jsx("h3",{className:"text-base font-semibold text-slate-900",children:"Jobwork stage"}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Current stage"}),e.jsx("select",{value:l.data.jobwork_status,onChange:t=>l.setData("jobwork_status",t.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:Object.entries(c).map(([t,r])=>e.jsx("option",{value:t,children:r},t))})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Notes"}),e.jsx("textarea",{value:l.data.admin_notes,onChange:t=>l.setData("admin_notes",t.target.value),className:"min-h-[80px] rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"})]}),e.jsx("button",{type:"submit",disabled:l.processing,className:"w-full rounded-full bg-sky-600 px-4 py-2 text-sm font-semibold text-white shadow-lg shadow-sky-600/30 transition hover:bg-sky-500 disabled:cursor-not-allowed disabled:opacity-70",children:"Update stage"})]})]})]})]})]})}export{y as default};
