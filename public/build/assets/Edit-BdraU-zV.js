import{u as et,a as tt,r as E,j as t,H as st}from"./app-DlYpOb3X.js";import{R as it}from"./RichTextEditor-Qf4OxWMd.js";import{A as at}from"./AdminLayout-vRMPHNh2.js";const ne=(te=!1)=>({sku:"",label:"",metal_id:"",metal_purity_id:"",diamond_option_key:null,size_cm:"",price_adjustment:"0",is_default:te,metadata:{},metals:[],diamonds:[]}),de=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`local-${Date.now()}-${Math.random().toString(16).slice(2,8)}`,je=()=>({key:de(),type_id:"",shape_id:"",color_id:"",clarity_id:"",cut_id:"",weight:"",diamonds_count:""}),lt=()=>({id:void 0,diamond_type_id:"",diamond_shape_id:"",diamond_color_id:"",diamond_clarity_id:"",diamond_cut_id:"",diamonds_count:"",total_carat:""});function mt(){const{props:te}=et(),{product:g,brands:ke,categories:we,productCatalogs:ve,diamondCatalog:L,customerGroups:nt,metals:H,metalPurities:F,metalTones:U,errors:D}=te,ze=g?.diamond_options?.length?g.diamond_options.map((e,i)=>({key:e.key??`${de()}-${i}`,type_id:e.type_id??"",shape_id:e.shape_id??"",color_id:e.color_id??"",clarity_id:e.clarity_id??"",cut_id:e.cut_id??"",weight:e.weight!==null&&e.weight!==void 0?String(e.weight):"",diamonds_count:e.diamonds_count!==null&&e.diamonds_count!==void 0?String(e.diamonds_count):""})):[],$e=g?.variants?.length?g.variants.map((e,i)=>({id:e.id,sku:e.sku??"",label:e.label??"",metal_id:e.metal_id??"",metal_purity_id:e.metal_purity_id??"",diamond_option_key:e.diamond_option_key??null,size_cm:e.size_cm?String(e.size_cm):"",price_adjustment:String(e.price_adjustment??0),is_default:e.is_default??i===0,inventory_quantity:e.inventory_quantity!==void 0&&e.inventory_quantity!==null?Number(e.inventory_quantity):0,metadata:e.metadata??{},metals:e.metals?.map(s=>({id:s.id,metal_id:s.metal_id??"",metal_purity_id:s.metal_purity_id??"",metal_tone_id:s.metal_tone_id??"",weight_grams:s.weight_grams?String(s.weight_grams):"",metal_weight:s.metal_weight?String(s.metal_weight):s.weight_grams?String(s.weight_grams):""}))??[],diamonds:e.diamonds?.map(s=>({id:s.id,diamond_type_id:s.diamond_type_id??"",diamond_shape_id:s.diamond_shape_id??"",diamond_color_id:s.diamond_color_id??"",diamond_clarity_id:s.diamond_clarity_id??"",diamond_cut_id:s.diamond_cut_id??"",diamonds_count:s.diamonds_count?String(s.diamonds_count):"",total_carat:s.total_carat?String(s.total_carat):""}))??[]})):[ne(!0)],Ce=g?.making_charge_discount_overrides?.length?g.making_charge_discount_overrides.map((e,i)=>({localKey:`${de()}-${i}`,customer_group_id:e.customer_group_id!==null&&e.customer_group_id!==void 0?Number(e.customer_group_id):"",type:e.type??"percentage",value:e.value!==null&&e.value!==void 0?String(e.value):""})):[],se=g?.metadata?.size_dimension??null,Se=se?.unit==="cm"?"cm":"mm",re=Array.isArray(se?.values)?(se?.values??[]).map(e=>String(e)):[],Me=re.length>0,ie=tt(()=>({sku:g?.sku??"",name:g?.name??"",description:g?.description??"",brand_id:String(g?.brand_id??""),category_id:String(g?.category_id??""),product_catalog_ids:(g?.product_catalog_ids??[]).map(e=>String(e)),gross_weight:g?.gross_weight?String(g.gross_weight):"",net_weight:g?.net_weight?String(g.net_weight):"",making_charge:g?.making_charge?String(g.making_charge):"",making_charge_discount_type:g?.making_charge_discount_type??null,making_charge_discount_value:g?.making_charge_discount_value!==null&&g?.making_charge_discount_value!==void 0?String(g.making_charge_discount_value):null,making_charge_discount_overrides:Ce,is_jobwork_allowed:g?.is_jobwork_allowed??!1,visibility:g?.visibility??"public",standard_pricing:{labour_brand:g?.standard_pricing?.labour_brand?String(g.standard_pricing.labour_brand):"",diamond_rate:g?.standard_pricing?.diamond_rate?String(g.standard_pricing.diamond_rate):"",gold_rate:g?.standard_pricing?.gold_rate?String(g.standard_pricing.gold_rate):"",colourstone_rate:g?.standard_pricing?.colourstone_rate?String(g.standard_pricing.colourstone_rate):""},variants:$e,is_variant_product:g?.is_variant_product??!0,mixed_metal_tones_per_purity:g?.mixed_metal_tones_per_purity??!1,mixed_metal_purities_per_tone:g?.mixed_metal_purities_per_tone??!1,metal_mix_mode:(()=>{const e=g?.metal_mix_mode;if(!e)return{};if(Array.isArray(e))return e.length===0?{}:{};if(typeof e!="object")return{};const i=Object.keys(e);if(i.length===0)return{};const s={};return i.forEach(n=>{const r=Number(n),h=e[n];!isNaN(r)&&r>0&&(h==="normal"||h==="mix_tones"||h==="mix_purities")&&(s[r]=h)}),s})(),uses_diamond:g?.uses_diamond??!1,diamond_mixing_mode:g?.diamond_mixing_mode&&(g.diamond_mixing_mode==="shared"||g.diamond_mixing_mode==="as_variant")?g.diamond_mixing_mode:"shared",metal_ids:g?.metal_ids??[],metal_purity_ids:g?.metal_purity_ids??[],metal_tone_ids:g?.metal_tone_ids??[],diamond_options:ze,diamond_type_ids:g?.diamond_type_ids??[],diamond_clarity_ids:g?.diamond_clarity_ids??[],diamond_color_ids:g?.diamond_color_ids??[],diamond_shape_ids:g?.diamond_shape_ids??[],diamond_cut_ids:g?.diamond_cut_ids??[],media_uploads:[],removed_media_ids:[],size_dimension_enabled:Me,size_unit:Se,size_values:re})),{setData:w,post:oe,put:me,processing:ce}=ie,c=ie.data,[ue,_e]=E.useState(""),[De,Ee]=E.useState(new Set),[Ve,Le]=E.useState(new Set);E.useCallback(e=>{Le(i=>{const s=new Set(i);return s.has(e)?s.delete(e):s.add(e),s})},[]),E.useCallback(e=>{Ee(i=>{const s=new Set(i);return s.has(e)?s.delete(e):s.add(e),s})},[]);const B=e=>Number.isFinite(e)?e.toFixed(3).replace(/\.?0+$/,""):"",xe=(e,i)=>{const s=parseFloat(e);if(!Number.isFinite(s))return"";const n=i==="mm"?s/10:s;return B(n)},Z=(e,i)=>{const s=typeof e=="number"?e:parseFloat(e);if(!Number.isFinite(s))return"";const n=i==="mm"?s*10:s;return B(n)},W=E.useMemo(()=>Object.fromEntries(F.map(e=>[e.id,e.name])),[F]),Y=E.useMemo(()=>Object.fromEntries(U.map(e=>[e.id,e.name])),[U]),G=E.useMemo(()=>Object.fromEntries(H.map(e=>[e.id,e.name])),[H]),P=E.useMemo(()=>({types:Object.fromEntries(L.types.map(e=>[e.id,e.name])),shapes:Object.fromEntries(L.shapes.map(e=>[e.id,e.name])),colors:Object.fromEntries(L.colors.map(e=>[e.id,e.name])),clarities:Object.fromEntries(L.clarities.map(e=>[e.id,e.name])),cuts:Object.fromEntries(L.cuts.map(e=>[e.id,e.name]))}),[L]),J=E.useCallback(e=>{if(!e)return"";const i=[];return e.weight&&i.push(`${e.weight} Ct`),e.shape_id&&i.push(P.shapes[Number(e.shape_id)]??""),e.clarity_id&&i.push(P.clarities[Number(e.clarity_id)]??""),e.color_id&&i.push(P.colors[Number(e.color_id)]??""),e.type_id&&i.push(P.types[Number(e.type_id)]??""),e.cut_id&&i.push(P.cuts[Number(e.cut_id)]??""),i.filter(Boolean).join(" - ")},[P]),X=E.useCallback((e,i)=>{let s="";if(e.metals&&e.metals.length>0){const a=e.metals.filter(o=>o.metal_id!==""&&typeof o.metal_id=="number").map(o=>({metal_id:o.metal_id,metal_purity_id:o.metal_purity_id!==""&&o.metal_purity_id!==null?Number(o.metal_purity_id):null,metal_tone_id:o.metal_tone_id!==""&&o.metal_tone_id!==null?Number(o.metal_tone_id):null}));if(a.length===0)s="";else{const o=new Map;a.forEach(v=>{o.has(v.metal_id)||o.set(v.metal_id,[]),o.get(v.metal_id).push(v)});const b=[];o.forEach((v,A)=>{const u=G[A]??"";if(!u)return;const l=new Set(v.map(z=>z.metal_purity_id).filter(Boolean)),_=new Set(v.map(z=>z.metal_tone_id).filter(Boolean));let x="";if(l.size>1&&_.size===1){const z=Array.from(_)[0],M=z?Y[z]??"":"",m=Array.from(l).map(k=>k?W[k]??"":"").filter(Boolean).sort();m.length>0?M?x=`${m.join(" + ")} ${M} ${u}`:x=`${m.join(" + ")} ${u}`:x=u}else if(_.size>1&&l.size===1){const z=Array.from(l)[0],M=z?W[z]??"":"",m=Array.from(_).map(k=>k?Y[k]??"":"").filter(Boolean).sort();m.length>0?M?x=`${M} ${m.join(" + ")} ${u}`:x=`${m.join(" + ")} ${u}`:x=M?`${M} ${u}`:u}else{const z=v[0],M=z.metal_purity_id,m=z.metal_tone_id,k=M?W[M]??"":"",S=m?Y[m]??"":"";k&&S?x=`${k} ${S} ${u}`:k?x=`${k} ${u}`:S?x=`${S} ${u}`:x=u}x&&b.push(x)}),s=b.join(" / ")}}else if(e.metal_id!==""&&typeof e.metal_id=="number"){const a=G[e.metal_id]??"";if(e.metal_purity_id!==""&&typeof e.metal_purity_id=="number"){const o=W[e.metal_purity_id]??"";s=o?`${o} ${a}`:a}else s=a}let n="";if(e.diamonds&&e.diamonds.length>0){const a=[];e.diamonds.forEach(o=>{const b=[];o.diamond_type_id!==""&&o.diamond_type_id!==null&&b.push(P.types[Number(o.diamond_type_id)]||""),o.diamond_clarity_id!==""&&o.diamond_clarity_id!==null&&b.push(P.clarities[Number(o.diamond_clarity_id)]||""),o.diamond_color_id!==""&&o.diamond_color_id!==null&&b.push(P.colors[Number(o.diamond_color_id)]||""),o.diamond_shape_id!==""&&o.diamond_shape_id!==null&&b.push(P.shapes[Number(o.diamond_shape_id)]||""),o.diamond_cut_id!==""&&o.diamond_cut_id!==null&&b.push(P.cuts[Number(o.diamond_cut_id)]||""),o.total_carat&&o.total_carat!==""&&b.push(`${o.total_carat}ct`),b.length>0&&a.push(b.filter(Boolean).join(" — "))}),n=a.join(" / ")}else{const a=i.diamond_options.find(o=>o.key===e.diamond_option_key)??null;n=J(a)}const r=e.metadata??{},h=typeof r.size_value=="string"||typeof r.size_value=="number"?String(r.size_value):"",f=r.size_unit==="mm"||r.size_unit==="cm"?r.size_unit:i.size_unit;let d=i.size_dimension_enabled?f:"cm",y="";i.size_dimension_enabled?h?y=B(Number(h)):e.size_cm&&(y=Z(e.size_cm,i.size_unit)):e.size_cm&&(y=B(parseFloat(e.size_cm)),d="cm");const j=y?`${y}${d}`:"",V=[n,s,j].filter(Boolean),p=V.length?V.join(" / "):"Variant",q=s,O=n;let N=null;if(e.diamonds&&e.diamonds.length>0)N=e.diamonds.map(a=>({type_id:a.diamond_type_id!==""&&a.diamond_type_id!==null?Number(a.diamond_type_id):null,shape_id:a.diamond_shape_id!==""&&a.diamond_shape_id!==null?Number(a.diamond_shape_id):null,color_id:a.diamond_color_id!==""&&a.diamond_color_id!==null?Number(a.diamond_color_id):null,clarity_id:a.diamond_clarity_id!==""&&a.diamond_clarity_id!==null?Number(a.diamond_clarity_id):null,cut_id:a.diamond_cut_id!==""&&a.diamond_cut_id!==null?Number(a.diamond_cut_id):null,total_carat:a.total_carat?Number(a.total_carat):null}));else{const a=i.diamond_options.find(o=>o.key===e.diamond_option_key)??null;a&&(N={key:a.key,type_id:a.type_id!==""?Number(a.type_id):null,shape_id:a.shape_id!==""?Number(a.shape_id):null,color_id:a.color_id!==""?Number(a.color_id):null,clarity_id:a.clarity_id!==""?Number(a.clarity_id):null,cut_id:a.cut_id!==""?Number(a.cut_id):null,weight:a.weight?Number(a.weight):null})}const $={metal_id:e.metal_id!==""&&e.metal_id!==null?Number(e.metal_id):null,metal_purity_id:e.metal_purity_id!==""&&e.metal_purity_id!==null?Number(e.metal_purity_id):null,diamond_option_key:e.diamond_option_key??null,diamond:N,size_cm:e.size_cm?Number(e.size_cm):null,auto_label:p};y?($.size_value=y,$.size_unit=d):(delete $.size_value,delete $.size_unit);const C=typeof r.status=="string"&&r.status.trim().length>0?String(r.status):void 0;return C?$.status=C:$.status="enabled",{autoLabel:p,metalTone:q,stoneQuality:O,sizeText:j,metadata:$}},[J,Z,B,G,W,Y]),T=E.useCallback(e=>e.variants.map((i,s)=>{const n=X(i,e),r=i.metadata?.auto_label??"",h=!i.label||i.label===r,f=i.metadata?.auto_sku??"",d=(e.sku??"").trim(),j=`${d?d.replace(/[^A-Za-z0-9]/g,"").toUpperCase():"SKU"}-${String(s+1).padStart(2,"0")}`,V=!i.sku||i.sku===f;return{...i,sku:V?j:i.sku,label:h?n.autoLabel:i.label,metadata:{...n.metadata,auto_sku:j},is_default:i.is_default??s===0}}),[X]),ae=E.useMemo(()=>c.metal_ids.length===0?[]:F.filter(e=>c.metal_ids.includes(e.metal_id)),[c.metal_ids,F]),le=E.useMemo(()=>c.metal_ids.length===0?[]:U.filter(e=>c.metal_ids.includes(e.metal_id)),[c.metal_ids,U]);E.useMemo(()=>ae.filter(e=>c.metal_purity_ids.includes(e.id)),[c.metal_purity_ids,ae]),E.useMemo(()=>le.filter(e=>c.metal_tone_ids.includes(e.id)),[c.metal_tone_ids,le]);const pe=E.useMemo(()=>c.diamond_options.map(e=>({key:e.key,label:J(e)||`Option ${e.key.slice(-4)}`})),[J,c.diamond_options]);E.useMemo(()=>pe.reduce((e,i)=>(e[i.key]=i.label,e),{}),[pe]);const Pe=e=>{w(i=>{const s={...i,is_variant_product:e,uses_diamond:e?i.uses_diamond:!1,metal_ids:e?i.metal_ids:[],metal_purity_ids:e?i.metal_purity_ids:[],metal_tone_ids:e?i.metal_tone_ids:[],diamond_options:e?i.diamond_options:[],size_dimension_enabled:e?i.size_dimension_enabled:!1,size_values:e?i.size_values:[],size_unit:e?i.size_unit:"mm",variants:e?i.variants.length>0?i.variants:[ne(!0)]:[]};return e||(s.size_dimension_enabled=!1,s.size_values=[],s.size_unit="mm"),s.variants=T(s),s})},Ae=e=>{w(i=>{const s=e&&i.diamond_options.length===0?[je()]:e?i.diamond_options:[],n={...i,uses_diamond:e,diamond_mixing_mode:i.diamond_mixing_mode||"shared",diamond_options:s,variants:e?i.variants:i.variants.map(r=>({...r,diamond_option_key:null,diamonds:[]}))};return e||(n.diamond_type_ids=[],n.diamond_clarity_ids=[],n.diamond_color_ids=[],n.diamond_shape_ids=[],n.diamond_cut_ids=[]),n.variants=T(n),n})},Oe=e=>{w(i=>{const s={...i,size_dimension_enabled:e,size_values:e?i.size_values:[],size_unit:e?i.size_unit:"mm",variants:i.variants.map(n=>{if(e)return{...n};const r={...n.metadata??{}};return delete r.size_value,delete r.size_unit,{...n,size_cm:"",metadata:r}})};return s.variants=T(s),s})},he=e=>{w(i=>{if(i.size_unit===e)return i;const s=i.size_values.map(r=>{const h=xe(r,i.size_unit);return h?Z(h,e):r}),n={...i,size_unit:e,size_values:s,variants:i.variants.map(r=>{if(!r.size_cm)return{...r,metadata:{...r.metadata??{},size_unit:e}};const h={...r.metadata??{}},f=Z(r.size_cm,e);return f?(h.size_value=f,h.size_unit=e):(delete h.size_value,h.size_unit=e),{...r,metadata:h}})};return n.variants=T(n),n})},Te=()=>{const e=ue.trim();if(!e)return;const i=parseFloat(e);if(!Number.isFinite(i)||i<=0)return;const s=B(i);w(n=>{if(n.size_values.includes(s))return n;const r={...n,size_values:[...n.size_values,s]};return r.variants=T(r),r}),_e("")},qe=e=>{w(i=>{const s={...i,size_values:i.size_values.filter(n=>n!==e)};return s.variants=T(s),s})},Fe=e=>{w(i=>{const n=i.metal_ids.includes(e)?i.metal_ids.filter(d=>d!==e):[...i.metal_ids,e],r=F.filter(d=>d.metal_id===e).map(d=>d.id),h=U.filter(d=>d.metal_id===e).map(d=>d.id),f={...i,metal_ids:n,metal_purity_ids:i.metal_purity_ids.filter(d=>!r.includes(d)),metal_tone_ids:i.metal_tone_ids.filter(d=>!h.includes(d)),metal_mix_mode:i.metal_mix_mode};return f.variants=T(f),f})},Ue=e=>{w(i=>{const n=i.metal_purity_ids.includes(e)?i.metal_purity_ids.filter(r=>r!==e):[...i.metal_purity_ids,e];return{...i,metal_purity_ids:n}})},Be=e=>{w(i=>{const n=i.metal_tone_ids.includes(e)?i.metal_tone_ids.filter(r=>r!==e):[...i.metal_tone_ids,e];return{...i,metal_tone_ids:n}})},Ke=()=>{w(e=>{const i={...e,diamond_options:[...e.diamond_options,je()]};return i.variants=T(i),i})},K=(e,i,s)=>{w(n=>{const r=n.diamond_options.map(f=>{if(f.key!==e)return f;if(i==="weight"||i==="diamonds_count")return{...f,[i]:s===null?"":String(s)};const d=s===null||s===""?"":typeof s=="number"?s:s===""?"":Number(s);return{...f,[i]:d}}),h={...n,diamond_options:r};return h.variants=T(h),h})},Re=e=>{w(i=>{const s=i.diamond_options.filter(r=>r.key!==e),n={...i,diamond_options:s,variants:i.variants.map(r=>r.diamond_option_key===e?{...r,diamond_option_key:null}:r)};return n.variants=T(n),n})},We=e=>{w(i=>{if(i.variants.length===1)return i;const s=i.variants.filter((r,h)=>h!==e);s.every(r=>!r.is_default)&&s.length>0&&(s[0].is_default=!0);const n={...i,variants:s};return n.variants=T(n),n})},Q=(e,i,s)=>{w(n=>{const r=n.variants.map((f,d)=>{if(d!==e)return f;const y={...f};switch(i){case"is_default":typeof s=="boolean"&&(y.is_default=s);break;case"metal_id":(s===""||typeof s=="number")&&(y.metal_id=s,(s===""||typeof s!="number")&&(y.metal_purity_id=""));break;case"metal_purity_id":(s===""||typeof s=="number")&&(y.metal_purity_id=s);break;case"diamond_option_key":y.diamond_option_key=s?String(s):null;break;case"size_cm":typeof s=="string"&&(y.size_cm=s);break;case"price_adjustment":typeof s=="string"&&(y.price_adjustment=s);break;case"sku":case"label":typeof s=="string"&&(y[i]=s);break;case"total_weight":s===""||s===null?y[i]="":(typeof s=="string"||typeof s=="number")&&(y[i]=s);break;case"inventory_quantity":if(s===""||s===null)y[i]=0;else if(typeof s=="string"){const j=parseInt(s,10);y[i]=isNaN(j)?0:j}else typeof s=="number"&&(y[i]=s);break}return y}),h={...n,variants:r};return h.variants=T(h),h})},Ge=(e,i)=>{w(s=>{const n=s.variants.map((h,f)=>{if(f!==e)return h;const d={...h.metadata??{}};return Object.entries(i).forEach(([y,j])=>{j===null?delete d[y]:d[y]=j}),{...h,metadata:d}}),r={...s,variants:n};return r.variants=T(r),r})},He=e=>{w(i=>({...i,variants:i.variants.map((s,n)=>({...s,is_default:n===e}))}))},Ye=e=>{w(i=>{const s=i.variants.map((n,r)=>{if(r!==e)return n;const h=n.diamonds||[];return{...n,diamonds:[...h,lt()]}});return{...i,variants:s}})},Qe=(e,i)=>{w(s=>{const n=s.variants.map((r,h)=>{if(h!==e)return r;const f=r.diamonds||[];return{...r,diamonds:f.filter((d,y)=>y!==i)}});return{...s,variants:n}})},R=(e,i,s,n)=>{w(r=>{const h=r.variants.map((f,d)=>{if(d!==e)return f;const j=(f.diamonds||[]).map((V,p)=>p!==i?V:{...V,[s]:n});return{...f,diamonds:j}});return{...r,variants:h}})},I=(e,i,s,n)=>{w(r=>{const h=r.variants.map((f,d)=>{if(d!==e)return f;const j=(f.metals||[]).map((V,p)=>p!==i?V:{...V,[s]:n});return{...f,metals:j}});return{...r,variants:h}})},ee=e=>{const i=new Map;e.metal_ids.length>0&&e.metal_purity_ids.length>0&&e.metal_purity_ids.forEach(a=>{const o=F.find(b=>b.id===a);o&&e.metal_ids.includes(o.metal_id)&&(i.has(o.metal_id)||i.set(o.metal_id,[]),i.get(o.metal_id).push(a))});const s=new Map;e.metal_ids.length>0&&e.metal_tone_ids.length>0&&e.metal_tone_ids.forEach(a=>{const o=U.find(b=>b.id===a);o&&e.metal_ids.includes(o.metal_id)&&(s.has(o.metal_id)||s.set(o.metal_id,[]),s.get(o.metal_id).push(a))});const n=(a,o,b,v)=>{const A=[];return o.length===0&&b.length===0?[[{metal_id:a,metal_purity_id:null,metal_tone_id:null}]]:b.length===0&&o.length>0?o.map(u=>[{metal_id:a,metal_purity_id:u,metal_tone_id:null}]):o.length===0&&b.length>0?b.map(u=>[{metal_id:a,metal_purity_id:null,metal_tone_id:u}]):(v==="normal"?o.forEach(u=>{b.forEach(l=>{A.push([{metal_id:a,metal_purity_id:u,metal_tone_id:l}])})}):v==="mix_tones"?o.forEach(u=>{A.push(b.map(l=>({metal_id:a,metal_purity_id:u,metal_tone_id:l})))}):v==="mix_purities"&&b.forEach(u=>{A.push(o.map(l=>({metal_id:a,metal_purity_id:l,metal_tone_id:u})))}),A)},r=new Map;e.metal_ids.forEach(a=>{const o=i.get(a)||[],b=s.get(a)||[];let v="normal";e.metal_mix_mode&&(v=e.metal_mix_mode[a]||v,v==="normal"&&e.metal_mix_mode[String(a)]&&(v=e.metal_mix_mode[String(a)]||v),v==="normal"&&Object.keys(e.metal_mix_mode).forEach(u=>{const l=Number(u);if(l===a){const _=e.metal_mix_mode[l];(_==="normal"||_==="mix_tones"||_==="mix_purities")&&(v=_)}}));const A=n(a,o,b,v);r.set(a,A)});const h=[];if(e.metal_ids.length>0){const a=v=>{if(v.length===0)return[[]];if(v.length===1)return v[0].map(x=>[x]);const[A,...u]=v,l=a(u),_=[];for(const x of A)for(const z of l)_.push([x,...z]);return _},o=e.metal_ids.map(v=>r.get(v)||[]),b=a(o);h.push(...b.map(v=>v.flat()))}const f=[];e.uses_diamond&&e.diamond_options.length>0?e.diamond_options.forEach(a=>{f.push({key:a.key,type_id:a.type_id!==""?Number(a.type_id):null,clarity_id:a.clarity_id!==""?Number(a.clarity_id):null,color_id:a.color_id!==""?Number(a.color_id):null,shape_id:a.shape_id!==""?Number(a.shape_id):null,cut_id:a.cut_id!==""?Number(a.cut_id):null})}):f.push({key:"",type_id:null,clarity_id:null,color_id:null,shape_id:null,cut_id:null});const d=e.size_dimension_enabled&&e.size_values.length>0?e.size_values:[null],y=e.size_dimension_enabled&&d.length>0&&d[0]!==null,j=e.uses_diamond&&f.length>0&&f[0].key!=="",V=e.diamond_mixing_mode||"shared",p=j&&V==="as_variant";if(h.length===0&&!y&&!p)return e;const q=[],O=[];if(h.length>0?h.forEach(a=>{d.forEach(o=>{O.push({metals:a,size:o??null})})}):y?d.forEach(a=>{O.push({metals:[],size:a??null})}):O.push({metals:[],size:null}),V==="shared"){const a=j?f[0]:{key:"",type_id:null,clarity_id:null,color_id:null,shape_id:null,cut_id:null};O.forEach(o=>{q.push({metals:o.metals,diamond:a,size:o.size})})}else O.forEach(a=>{j?f.forEach(o=>{q.push({metals:a.metals,diamond:o,size:a.size})}):q.push({metals:a.metals,diamond:{key:"",type_id:null,clarity_id:null,color_id:null,shape_id:null,cut_id:null},size:a.size})});if(q.length===0)return e;const N=new Map;e.variants.forEach(a=>{if(!a.metals||a.metals.length===0)return;const o=a.size_cm||"no-size",b=a.diamond_option_key||"no-diamond",A=`${a.metals.filter(u=>u.metal_id!==""&&typeof u.metal_id=="number").map(u=>`${u.metal_id}-${u.metal_purity_id||"null"}-${u.metal_tone_id||"null"}`).sort().join("|")}::${o}::${b}`;N.set(A,{metals:a.metals.map(u=>({metal_id:typeof u.metal_id=="number"?u.metal_id:0,metal_purity_id:u.metal_purity_id!==""&&u.metal_purity_id!==null?typeof u.metal_purity_id=="number"?u.metal_purity_id:Number(u.metal_purity_id):null,metal_tone_id:u.metal_tone_id!==""&&u.metal_tone_id!==null?typeof u.metal_tone_id=="number"?u.metal_tone_id:Number(u.metal_tone_id):null,metal_weight:u.metal_weight||u.weight_grams||"",weight_grams:u.weight_grams||u.metal_weight||""})),diamonds:(a.diamonds||[]).map(u=>({diamond_type_id:u.diamond_type_id!==""&&u.diamond_type_id!==null?typeof u.diamond_type_id=="number"?u.diamond_type_id:Number(u.diamond_type_id):null,diamond_shape_id:u.diamond_shape_id!==""&&u.diamond_shape_id!==null?typeof u.diamond_shape_id=="number"?u.diamond_shape_id:Number(u.diamond_shape_id):null,diamond_color_id:u.diamond_color_id!==""&&u.diamond_color_id!==null?typeof u.diamond_color_id=="number"?u.diamond_color_id:Number(u.diamond_color_id):null,diamond_clarity_id:u.diamond_clarity_id!==""&&u.diamond_clarity_id!==null?typeof u.diamond_clarity_id=="number"?u.diamond_clarity_id:Number(u.diamond_clarity_id):null,diamond_cut_id:u.diamond_cut_id!==""&&u.diamond_cut_id!==null?typeof u.diamond_cut_id=="number"?u.diamond_cut_id:Number(u.diamond_cut_id):null,diamonds_count:u.diamonds_count||"",total_carat:u.total_carat||""}))})});const $=q.map((a,o)=>{const b=ne(o===0),v=a.size||"no-size",A=a.diamond.key||"no-diamond",l=`${a.metals.map(m=>`${m.metal_id}-${m.metal_purity_id||"null"}-${m.metal_tone_id||"null"}`).sort().join("|")}::${v}::${A}`,_=N.get(l);if(b.metals=a.metals.map(m=>{const k=_?.metals.find(S=>S.metal_id===m.metal_id&&S.metal_purity_id===(m.metal_purity_id??null)&&S.metal_tone_id===(m.metal_tone_id??null));return{id:void 0,metal_id:m.metal_id,metal_purity_id:m.metal_purity_id??"",metal_tone_id:m.metal_tone_id??"",weight_grams:k?.weight_grams||"",metal_weight:k?.metal_weight||""}}),a.metals.length>0){const m=a.metals[0];b.metal_id=m.metal_id,m.metal_purity_id!==null&&(b.metal_purity_id=m.metal_purity_id)}if((e.diamond_mixing_mode||"shared")==="shared")e.uses_diamond&&e.diamond_options.length>0?(b.diamonds=e.diamond_options.map(m=>{const k=_?.diamonds.find(S=>S.diamond_type_id===(m.type_id!==""?m.type_id:null)&&S.diamond_shape_id===(m.shape_id!==""?m.shape_id:null)&&S.diamond_color_id===(m.color_id!==""?m.color_id:null)&&S.diamond_clarity_id===(m.clarity_id!==""?m.clarity_id:null)&&S.diamond_cut_id===(m.cut_id!==""?m.cut_id:null));return{id:void 0,diamond_type_id:m.type_id!==""?m.type_id:"",diamond_clarity_id:m.clarity_id!==""?m.clarity_id:"",diamond_color_id:m.color_id!==""?m.color_id:"",diamond_shape_id:m.shape_id!==""?m.shape_id:"",diamond_cut_id:m.cut_id!==""?m.cut_id:"",diamonds_count:k?.diamonds_count||(m.diamonds_count!==""&&m.diamonds_count!==null&&m.diamonds_count!==void 0?m.diamonds_count:""),total_carat:k?.total_carat||m.weight||""}}),b.diamond_option_key=e.diamond_options[0].key||null):(b.diamond_option_key=null,b.diamonds=[]);else{const m=a.diamond.key||null;if(b.diamond_option_key=m,m&&(a.diamond.type_id||a.diamond.clarity_id||a.diamond.color_id||a.diamond.shape_id||a.diamond.cut_id)){const k=_?.diamonds.find(S=>S.diamond_type_id===(a.diamond.type_id??null)&&S.diamond_shape_id===(a.diamond.shape_id??null)&&S.diamond_color_id===(a.diamond.color_id??null)&&S.diamond_clarity_id===(a.diamond.clarity_id??null)&&S.diamond_cut_id===(a.diamond.cut_id??null));b.diamonds=[{id:void 0,diamond_type_id:a.diamond.type_id??"",diamond_clarity_id:a.diamond.clarity_id??"",diamond_color_id:a.diamond.color_id??"",diamond_shape_id:a.diamond.shape_id??"",diamond_cut_id:a.diamond.cut_id??"",diamonds_count:k?.diamonds_count||"",total_carat:k?.total_carat||""}]}else b.diamonds=[]}const z={...b.metadata??{},status:"enabled"};if(a.size){const m=xe(a.size,e.size_unit);b.size_cm=m,z.size_value=a.size,z.size_unit=e.size_unit}else delete z.size_value,delete z.size_unit;const M=e.diamond_mixing_mode||"shared";return b.diamond_option_key&&(z.diamond_option_key=b.diamond_option_key,M==="as_variant"&&(z.diamond={type_id:a.diamond.type_id,clarity_id:a.diamond.clarity_id,color_id:a.diamond.color_id,shape_id:a.diamond.shape_id,cut_id:a.diamond.cut_id})),b.metadata=z,b}),C={...e,variants:$,metal_mix_mode:e.metal_mix_mode||{}};return C.variants=T(C),C},ge=()=>{w(e=>ee(e))},Ze=e=>{e.preventDefault(),ie.transform(i=>{const s=i,n={...s};n.uses_diamond=s.uses_diamond,n.diamond_mixing_mode=s.diamond_mixing_mode||"shared",n.metal_ids=[...s.metal_ids],n.metal_purity_ids=[...s.metal_purity_ids],n.metal_tone_ids=[...s.metal_tone_ids];const r={};s.metal_mix_mode&&typeof s.metal_mix_mode=="object"&&Object.keys(s.metal_mix_mode).forEach(d=>{const y=Number(d),j=s.metal_mix_mode[y];!isNaN(y)&&y>0&&(j==="normal"||j==="mix_tones"||j==="mix_purities")&&(r[String(y)]=j)}),n.metal_mix_mode=r,n.diamond_type_ids=s.uses_diamond?[...s.diamond_type_ids]:[],n.diamond_clarity_ids=s.uses_diamond?[...s.diamond_clarity_ids]:[],n.diamond_color_ids=s.uses_diamond?[...s.diamond_color_ids]:[],n.diamond_shape_ids=s.uses_diamond?[...s.diamond_shape_ids]:[],n.diamond_cut_ids=s.uses_diamond?[...s.diamond_cut_ids]:[],n.diamond_options=s.uses_diamond?s.diamond_options.map(d=>({key:d.key,type_id:d.type_id!==""?Number(d.type_id):null,shape_id:d.shape_id!==""?Number(d.shape_id):null,color_id:d.color_id!==""?Number(d.color_id):null,clarity_id:d.clarity_id!==""?Number(d.clarity_id):null,cut_id:d.cut_id!==""?Number(d.cut_id):null,weight:d.weight?Number(d.weight):null,diamonds_count:d.diamonds_count?Number(d.diamonds_count):null})):[];const h=d=>d==null||d===""?null:typeof d=="number"?d:Number(d);n.making_charge_discount_type=s.making_charge_discount_type||null,n.making_charge_discount_value=s.making_charge_discount_type?h(s.making_charge_discount_value):null,n.making_charge_discount_overrides=s.making_charge_discount_overrides.map(d=>({customer_group_id:d.customer_group_id!==""?Number(d.customer_group_id):null,type:d.type,value:h(d.value)})).filter(d=>d.customer_group_id!==null&&d.value!==null),n.variants=s.is_variant_product?s.variants.map(d=>{const y=X(d,s),j=(d.metals||[]).length>0?(d.metals||[]).map(p=>({id:p.id,metal_id:p.metal_id!==""&&p.metal_id!==null?Number(p.metal_id):null,metal_purity_id:p.metal_purity_id!==""&&p.metal_purity_id!==null?Number(p.metal_purity_id):null,metal_tone_id:p.metal_tone_id!==""&&p.metal_tone_id!==null?Number(p.metal_tone_id):null,weight_grams:p.weight_grams!==""&&p.weight_grams!==null?p.weight_grams:null,metal_weight:p.metal_weight!==""&&p.metal_weight!==null?p.metal_weight:p.weight_grams!==""&&p.weight_grams!==null?p.weight_grams:null,metadata:{}})).filter(p=>p.metal_id!==null&&p.metal_id>0):[],V=(d.diamonds||[]).map(p=>({id:p.id,diamond_type_id:p.diamond_type_id!==""&&p.diamond_type_id!==null?Number(p.diamond_type_id):null,diamond_shape_id:p.diamond_shape_id!==""&&p.diamond_shape_id!==null?Number(p.diamond_shape_id):null,diamond_color_id:p.diamond_color_id!==""&&p.diamond_color_id!==null?Number(p.diamond_color_id):null,diamond_clarity_id:p.diamond_clarity_id!==""&&p.diamond_clarity_id!==null?Number(p.diamond_clarity_id):null,diamond_cut_id:p.diamond_cut_id!==""&&p.diamond_cut_id!==null?Number(p.diamond_cut_id):null,diamonds_count:p.diamonds_count!==""&&p.diamonds_count!==null?Number(p.diamonds_count):null,total_carat:p.total_carat!==""&&p.total_carat!==null?p.total_carat:null,metadata:{}})).filter(p=>p.diamond_type_id!==null||p.diamond_shape_id!==null||p.diamond_color_id!==null||p.diamond_clarity_id!==null||p.diamond_cut_id!==null);return{id:d.id,sku:d.sku,label:d.label||y.autoLabel,metal_id:j.length===0&&d.metal_id!==""&&d.metal_id!==null&&d.metal_id>0?Number(d.metal_id):null,metal_purity_id:j.length===0&&d.metal_purity_id!==""&&d.metal_purity_id!==null&&d.metal_purity_id>0?Number(d.metal_purity_id):null,metal_tone:y.metalTone||null,stone_quality:y.stoneQuality||null,size:y.sizeText||null,price_adjustment:d.price_adjustment,inventory_quantity:d.inventory_quantity!==void 0&&d.inventory_quantity!==null&&d.inventory_quantity!==""?typeof d.inventory_quantity=="number"?d.inventory_quantity:Number(d.inventory_quantity):0,is_default:d.is_default,metadata:y.metadata,metals:j,diamonds:V}}):[];const f=s.size_values.map(d=>parseFloat(d)).filter(d=>Number.isFinite(d)&&d>0);return s.size_dimension_enabled&&f.length>0?n.metadata={size_dimension:{unit:s.size_unit,values:f}}:n.metadata=null,n.metadata||delete n.metadata,delete n.size_dimension_enabled,delete n.size_unit,delete n.size_values,s.is_variant_product||(n.uses_diamond=!1,n.metal_ids=[],n.metal_purity_ids=[],n.metal_tone_ids=[],n.uses_diamond=!1,n.diamond_type_ids=[],n.diamond_clarity_ids=[],n.diamond_color_ids=[],n.diamond_shape_ids=[],n.diamond_cut_ids=[]),(n.media_uploads?.length??0)===0&&delete n.media_uploads,(n.removed_media_ids?.length??0)===0&&delete n.removed_media_ids,n}),g?.id?(c.media_uploads?.length??0)>0?me(route("admin.products.update",g.id),{forceFormData:!0}):me(route("admin.products.update",g.id)):(c.media_uploads?.length??0)>0?oe(route("admin.products.store"),{forceFormData:!0}):oe(route("admin.products.store"))},fe=D.variants,ye=E.useMemo(()=>Object.entries(D??{}).filter(([e])=>e.startsWith("media_uploads")).map(([,e])=>e),[D]),be=E.useMemo(()=>g?.media?[...g.media].sort((e,i)=>e.position-i.position):[],[g?.media]),Je=e=>{const i=c.removed_media_ids??[],n=i.includes(e)?i.filter(r=>r!==e):[...i,e];w("removed_media_ids",n)},Xe=e=>{const i=e.target.files?Array.from(e.target.files):[];i.length!==0&&(w("media_uploads",[...c.media_uploads??[],...i]),e.target.value="")},Ie=e=>{w("media_uploads",(c.media_uploads??[]).filter((i,s)=>s!==e))},Ne=e=>(c.removed_media_ids??[]).includes(e);return t.jsxs(at,{children:[t.jsx(st,{title:g?.id?`Edit ${g.name}`:"New Product"}),t.jsxs("form",{onSubmit:Ze,className:"space-y-10",children:[t.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-xl shadow-slate-900/10",children:[t.jsxs("div",{className:"flex flex-col gap-4 border-b border-slate-100 pb-6 sm:flex-row sm:items-center sm:justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:g?.id?"Update catalogue record":"Create catalogue record"}),t.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Define product master information, atelier references, and jobwork eligibility."})]}),t.jsx("button",{type:"submit",disabled:ce,className:"inline-flex items-center gap-2 rounded-full bg-slate-900 px-5 py-2 text-sm font-semibold text-white shadow-lg shadow-slate-900/20 transition hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",children:ce?"Saving…":g?.id?"Save changes":"Create product"})]}),t.jsxs("div",{className:"mt-6 grid gap-6 lg:grid-cols-2",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[t.jsx("span",{children:"SKU *"}),t.jsx("input",{type:"text",value:c.sku,onChange:e=>w("sku",e.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),D.sku&&t.jsx("span",{className:"text-xs text-rose-500",children:D.sku})]}),t.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[t.jsx("span",{children:"Product name *"}),t.jsx("input",{type:"text",value:c.name,onChange:e=>w("name",e.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),D.name&&t.jsx("span",{className:"text-xs text-rose-500",children:D.name})]}),t.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[t.jsx("span",{children:"Brand *"}),t.jsxs("select",{value:c.brand_id,onChange:e=>w("brand_id",e.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[t.jsx("option",{value:"",children:"Select brand"}),Object.entries(ke).map(([e,i])=>t.jsx("option",{value:e,children:i},e))]}),D.brand_id&&t.jsx("span",{className:"text-xs text-rose-500",children:D.brand_id})]}),t.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[t.jsx("span",{children:"Category *"}),t.jsxs("select",{value:c.category_id,onChange:e=>w("category_id",e.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[t.jsx("option",{value:"",children:"Select category"}),Object.entries(we).map(([e,i])=>t.jsx("option",{value:e,children:i},e))]}),D.category_id&&t.jsx("span",{className:"text-xs text-rose-500",children:D.category_id})]}),t.jsxs("div",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[t.jsx("span",{children:"Assign catalogues"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(ve).map(([e,i])=>{const s=String(e),n=c.product_catalog_ids.includes(s);return t.jsxs("button",{type:"button",onClick:()=>{n?w("product_catalog_ids",c.product_catalog_ids.filter(r=>r!==s)):w("product_catalog_ids",[...c.product_catalog_ids,s])},className:`inline-flex items-center gap-2 rounded-full px-4 py-2 text-xs font-semibold transition ${n?"bg-sky-600 text-white shadow-sky-600/30":"bg-slate-100 text-slate-600 hover:bg-sky-50 hover:text-sky-600"}`,children:[i,n&&t.jsx("span",{className:"text-[10px] uppercase tracking-[0.3em]",children:"×"})]},e)})}),t.jsx("span",{className:"text-[11px] text-slate-400",children:"Link the product to one or more catalogues for customer-facing navigation."}),D.product_catalog_ids&&t.jsx("span",{className:"text-xs text-rose-500",children:D.product_catalog_ids})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:t.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[t.jsx("span",{children:"Making charge (₹) *"}),t.jsx("input",{type:"number",step:"0.01",value:c.making_charge,onChange:e=>w("making_charge",e.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),D.making_charge&&t.jsx("span",{className:"text-xs text-rose-500",children:D.making_charge})]})}),t.jsxs("label",{className:"inline-flex items-center gap-3 rounded-2xl border border-slate-200 px-4 py-3 text-sm text-slate-600",children:[t.jsx("input",{type:"checkbox",checked:c.is_jobwork_allowed,onChange:e=>w("is_jobwork_allowed",e.target.checked),className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500"}),"Jobwork requests allowed for this SKU"]})]})]})]}),t.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-xl shadow-slate-900/10",children:[t.jsx("div",{className:"flex flex-col gap-3 border-b border-slate-100 pb-4 lg:flex-row lg:items-center lg:justify-between",children:t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Product description"}),t.jsx("p",{className:"text-sm text-slate-500",children:"Provide merchandising copy, craftsmanship details, and any atelier notes for this SKU."})]})}),t.jsxs("div",{className:"mt-6",children:[t.jsx(it,{value:c.description,onChange:e=>w("description",e),className:"overflow-hidden rounded-3xl border border-slate-200",placeholder:"Detail the design notes, materials, finish, and atelier craftsmanship."}),D.description&&t.jsx("span",{className:"mt-2 block text-xs text-rose-500",children:D.description})]})]}),t.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-xl shadow-slate-900/10",children:[t.jsx("div",{className:"flex flex-col gap-4 border-b border-slate-100 pb-4 lg:flex-row lg:items-center lg:justify-between",children:t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Product media"}),t.jsx("p",{className:"text-sm text-slate-500",children:"Upload product images or videos for catalogue displays. You can also remove outdated media assets."})]})}),t.jsxs("div",{className:"mt-6 space-y-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-semibold uppercase tracking-[0.3em] text-slate-400",children:"Current media"}),t.jsx("div",{className:"mt-3 grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:be.length>0?be.map(e=>t.jsxs("div",{className:`relative overflow-hidden rounded-3xl border border-slate-200 bg-slate-50 shadow-sm transition ${Ne(e.id)?"opacity-50 ring-2 ring-rose-200":""}`,children:[e.type==="video"?t.jsx("video",{src:e.url,className:"h-48 w-full rounded-t-3xl bg-black object-cover",controls:!0,children:"Your browser does not support the video tag."}):t.jsx("img",{src:e.url,alt:"Product media",className:"h-48 w-full rounded-t-3xl object-cover"}),t.jsxs("div",{className:"flex items-center justify-between px-4 py-3 text-xs text-slate-500",children:[t.jsx("span",{className:"rounded-full bg-white/70 px-3 py-1 font-semibold text-slate-700",children:e.type.toUpperCase()}),t.jsx("button",{type:"button",onClick:()=>Je(e.id),className:"text-rose-500 transition hover:text-rose-600",children:Ne(e.id)?"Undo removal":"Remove"})]})]},e.id)):t.jsx("p",{className:"rounded-2xl border border-dashed border-slate-200 px-4 py-6 text-sm text-slate-500",children:"No media uploaded yet."})})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-semibold uppercase tracking-[0.3em] text-slate-400",children:"Upload new files"}),t.jsxs("label",{className:"mt-3 flex cursor-pointer flex-col items-center justify-center gap-3 rounded-3xl border border-dashed border-slate-300 bg-slate-50 px-6 py-10 text-center text-slate-500 transition hover:border-slate-400 hover:bg-slate-100",children:[t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-slate-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 15a4 4 0 014-4h10a4 4 0 014 4v3a2 2 0 01-2 2H5a2 2 0 01-2-2v-3z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 10l5-5m0 0l5 5m-5-5v12"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-semibold text-slate-700",children:"Click to upload"}),t.jsx("p",{className:"mt-1 text-xs text-slate-400",children:"JPEG, PNG, WebP, MP4 up to 50MB each."})]}),t.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:Xe,className:"hidden"})]}),ye.length>0&&t.jsx("ul",{className:"mt-3 space-y-1",children:ye.map((e,i)=>t.jsx("li",{className:"text-xs text-rose-500",children:e},`${i}-${e}`))}),(c.media_uploads??[]).length>0&&t.jsx("ul",{className:"mt-4 space-y-2",children:(c.media_uploads??[]).map((e,i)=>t.jsxs("li",{className:"flex items-center justify-between rounded-2xl border border-slate-200 px-4 py-2 text-sm text-slate-600",children:[t.jsx("span",{className:"truncate",children:e.name}),t.jsx("button",{type:"button",onClick:()=>Ie(i),className:"text-rose-500 transition hover:text-rose-600",children:"Remove"})]},`${e.name}-${i}`))})]})]})]}),t.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-xl shadow-slate-900/10",children:[t.jsxs("div",{className:"flex flex-col gap-3 border-b border-slate-100 pb-4 lg:flex-row lg:items-center lg:justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Variant configuration"}),t.jsx("p",{className:"text-sm text-slate-500",children:"Decide whether this product uses a single price or multiple combinations across metals and diamonds."})]}),t.jsxs("label",{className:"inline-flex items-center gap-3 rounded-2xl border border-slate-200 px-4 py-3 text-sm text-slate-600",children:[t.jsx("input",{type:"checkbox",checked:c.is_variant_product,onChange:e=>Pe(e.target.checked),className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500"}),"Variant product (multi-option catalogue)"]})]}),c.is_variant_product?t.jsxs("div",{className:"mt-6 space-y-6",children:[t.jsxs("div",{className:"space-y-4 rounded-2xl border border-slate-200 p-4",children:[t.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-semibold uppercase tracking-[0.3em] text-slate-500",children:"Size dimension"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Maintain consistent size data across variants. Add numeric values and choose the preferred unit."})]}),t.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-slate-600",children:[t.jsx("input",{type:"checkbox",checked:c.size_dimension_enabled,onChange:e=>Oe(e.target.checked),className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500"}),"Use size dimension"]})]}),c.size_dimension_enabled&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:[t.jsx("span",{children:"Unit"}),t.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-slate-600",children:[t.jsx("input",{type:"radio",name:"size-unit",value:"mm",checked:c.size_unit==="mm",onChange:()=>he("mm"),className:"h-4 w-4 border-slate-300 text-sky-600 focus:ring-sky-500"}),"Millimetres (mm)"]}),t.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-slate-600",children:[t.jsx("input",{type:"radio",name:"size-unit",value:"cm",checked:c.size_unit==="cm",onChange:()=>he("cm"),className:"h-4 w-4 border-slate-300 text-sky-600 focus:ring-sky-500"}),"Centimetres (cm)"]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"number",step:"0.001",min:"0",value:ue,onChange:e=>_e(e.target.value),className:"w-24 rounded-2xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:`e.g. 25${c.size_unit}`}),t.jsx("button",{type:"button",onClick:Te,className:"inline-flex items-center gap-2 rounded-full border border-slate-300 px-4 py-1.5 text-xs font-semibold uppercase tracking-[0.2em] text-slate-600 transition hover:border-slate-400 hover:text-slate-900",children:"Add size"})]}),c.size_values.length===0&&t.jsx("span",{className:"text-xs text-slate-400",children:"Add at least one size value to use in the variant matrix."})]}),c.size_values.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2",children:c.size_values.map(e=>t.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-slate-300 bg-slate-50 px-3 py-1 text-xs font-semibold text-slate-600",children:[e,c.size_unit,t.jsx("button",{type:"button",onClick:()=>qe(e),className:"text-rose-500 transition hover:text-rose-600","aria-label":`Remove size ${e}${c.size_unit}`,children:"×"})]},`${e}-${c.size_unit}`))})]})]}),t.jsxs("div",{className:"space-y-4 rounded-2xl border border-slate-200 p-4",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-semibold uppercase tracking-[0.3em] text-slate-500",children:"Metals"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Select metals that can be used in your product variants."})]}),H.length>0?t.jsx("div",{className:"flex flex-wrap gap-3",children:H.map(e=>{const i=c.metal_ids.includes(e.id);return t.jsxs("label",{className:`inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-semibold transition ${i?"border-sky-400 bg-white text-sky-700":"border-slate-200 bg-white text-slate-600 hover:border-slate-300"}`,children:[t.jsx("input",{type:"checkbox",checked:i,onChange:()=>Fe(e.id),className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500"}),e.name]},e.id)})}):t.jsx("p",{className:"text-xs text-slate-400",children:"No metals available yet."})]}),c.metal_ids.length>0&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"space-y-4",children:H.filter(e=>c.metal_ids.includes(e.id)).map(e=>{const i=ae.filter(N=>N.metal_id===e.id),s=le.filter(N=>N.metal_id===e.id),n=i.filter(N=>c.metal_purity_ids.includes(N.id)),r=s.filter(N=>c.metal_tone_ids.includes(N.id)),h=n.length>0,f=r.length>0,d=typeof e.id=="number"?e.id:Number(e.id),y=c.metal_mix_mode?.[d],j=y&&(y==="normal"||y==="mix_tones"||y==="mix_purities")?y:"normal",p=!h&&!f?0:j==="mix_tones"&&h&&f?n.length:j==="mix_purities"&&h&&f?r.length:h&&f?n.length*r.length:h?n.length:f?r.length:0,O=(()=>{if(!h&&!f)return"";const N=n.map(C=>C.name).sort().join(", "),$=r.map(C=>C.name).sort().join(", ");if(j==="normal")if(h&&f){const C=[];return n.forEach(a=>{r.forEach(o=>{C.push(`${a.name} ${o.name}`)})}),`Will create separate variants for each combination: ${C.join(", ")}.`}else{if(h)return`Will create separate variants for: ${N}.`;if(f)return`Will create separate variants for: ${$}.`}else{if(j==="mix_tones"&&h&&f)return`Will create one variant per purity: ${n.map(C=>`${C.name} (${$})`).join(", ")}.`;if(j==="mix_purities"&&h&&f)return`Will create one variant per tone: ${r.map(C=>`${C.name} (${N})`).join(", ")}.`}return""})();return t.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[t.jsxs("div",{className:"mb-4 flex items-center justify-between border-b border-slate-100 pb-3",children:[t.jsxs("h3",{className:"text-base font-semibold text-slate-900",children:["Metal: ",e.name]}),p>0&&t.jsxs("span",{className:"rounded-full bg-sky-50 px-3 py-1 text-xs font-semibold text-sky-700",children:[p," variant",p!==1?"s":""," for this metal"]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"mb-2 block text-xs font-semibold text-slate-600",children:"Purities for this metal"}),i.length>0?t.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(N=>{const $=c.metal_purity_ids.includes(N.id);return t.jsxs("label",{className:`inline-flex cursor-pointer items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold transition ${$?"border-sky-400 bg-sky-50 text-sky-700 shadow-sm":"border-slate-200 bg-white text-slate-600 hover:border-slate-300 hover:bg-slate-50"}`,children:[t.jsx("input",{type:"checkbox",checked:$,onChange:()=>Ue(N.id),className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500"}),N.name]},N.id)})}):t.jsxs("p",{className:"text-xs text-slate-400",children:["No purities available for ",e.name,"."]}),t.jsxs("p",{className:"mt-2 text-xs text-slate-500",children:["Choose all purities in which this design is available for ",e.name,"."]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"mb-2 block text-xs font-semibold text-slate-600",children:"Tones for this metal"}),s.length>0?t.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(N=>{const $=c.metal_tone_ids.includes(N.id);return t.jsxs("label",{className:`inline-flex cursor-pointer items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold transition ${$?"border-sky-400 bg-sky-50 text-sky-700 shadow-sm":"border-slate-200 bg-white text-slate-600 hover:border-slate-300 hover:bg-slate-50"}`,children:[t.jsx("input",{type:"checkbox",checked:$,onChange:()=>Be(N.id),className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500"}),N.name]},N.id)})}):t.jsxs("p",{className:"text-xs text-slate-400",children:["No tones available for ",e.name,"."]}),t.jsxs("p",{className:"mt-2 text-xs text-slate-500",children:["Choose all tones in which this design is available for ",e.name,"."]})]}),h&&f&&t.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 p-4",children:[t.jsx("label",{className:"mb-3 block text-xs font-semibold text-slate-700",children:"Mixing behavior"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:"flex cursor-pointer items-start gap-3 rounded-lg border border-slate-200 bg-white p-3 transition hover:border-sky-300 hover:bg-sky-50/50",children:[t.jsx("input",{type:"radio",name:`metal-mix-mode-${e.id}`,value:"normal",checked:j==="normal",onChange:()=>{w(N=>{const $=typeof e.id=="number"?e.id:Number(e.id),C={...N,metal_mix_mode:{...N.metal_mix_mode,[$]:"normal"}};return ee(C)})},className:"mt-0.5 h-4 w-4 border-slate-300 text-sky-600 focus:ring-sky-500"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-slate-900",children:"Separate variants"}),t.jsx("div",{className:"mt-1 text-xs text-slate-600",children:"Create one variant for each purity × tone combination for this metal."})]})]}),t.jsxs("label",{className:"flex cursor-pointer items-start gap-3 rounded-lg border border-slate-200 bg-white p-3 transition hover:border-sky-300 hover:bg-sky-50/50",children:[t.jsx("input",{type:"radio",name:`metal-mix-mode-${e.id}`,value:"mix_tones",checked:j==="mix_tones",onChange:()=>{w(N=>{const $=typeof e.id=="number"?e.id:Number(e.id),C={...N,metal_mix_mode:{...N.metal_mix_mode,[$]:"mix_tones"}};return ee(C)})},className:"mt-0.5 h-4 w-4 border-slate-300 text-sky-600 focus:ring-sky-500"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-slate-900",children:"Combine tones per purity"}),t.jsx("div",{className:"mt-1 text-xs text-slate-600",children:"For each purity, combine all selected tones into a single variant. Example: 18K Yellow + White Gold in one variant."})]})]}),t.jsxs("label",{className:"flex cursor-pointer items-start gap-3 rounded-lg border border-slate-200 bg-white p-3 transition hover:border-sky-300 hover:bg-sky-50/50",children:[t.jsx("input",{type:"radio",name:`metal-mix-mode-${e.id}`,value:"mix_purities",checked:j==="mix_purities",onChange:()=>{w(N=>{const $=typeof e.id=="number"?e.id:Number(e.id),C={...N,metal_mix_mode:{...N.metal_mix_mode,[$]:"mix_purities"}};return ee(C)})},className:"mt-0.5 h-4 w-4 border-slate-300 text-sky-600 focus:ring-sky-500"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-slate-900",children:"Combine purities per tone"}),t.jsx("div",{className:"mt-1 text-xs text-slate-600",children:"For each tone, combine all selected purities into a single variant. Example: 18K + 22K Yellow Gold in one variant."})]})]})]}),O&&t.jsxs("div",{className:"mt-4 rounded-lg bg-sky-50 border border-sky-200 p-3",children:[t.jsx("p",{className:"text-xs font-medium text-sky-900",children:"Preview:"}),t.jsx("p",{className:"mt-1 text-xs text-sky-700",children:O})]})]})]})]},e.id)})}),c.metal_ids.length>0&&t.jsx("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-semibold text-slate-700",children:"Preview generated variants"}),t.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["This setup will generate approximately ",t.jsx("span",{className:"font-semibold text-slate-900",children:c.variants.length})," variant",c.variants.length!==1?"s":""," based on your current configuration."]})]}),t.jsx("button",{type:"button",onClick:ge,className:"rounded-full border border-slate-300 bg-white px-4 py-2 text-xs font-semibold text-slate-700 transition hover:border-slate-400 hover:bg-slate-50",children:"Regenerate matrix"})]})})]}),t.jsxs("div",{className:"space-y-4 rounded-2xl border border-slate-200 p-4",children:[t.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-semibold uppercase tracking-[0.3em] text-slate-500",children:"Diamond mixes"}),t.jsx("p",{className:"text-xs text-slate-500",children:"Define reusable diamond combinations that can be referenced by product variants."})]}),t.jsxs("label",{className:"inline-flex items-center gap-3 rounded-2xl border border-slate-200 px-4 py-3 text-sm text-slate-600",children:[t.jsx("input",{type:"checkbox",checked:c.uses_diamond,onChange:e=>Ae(e.target.checked),className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500"}),"Use diamonds in variants"]})]}),c.uses_diamond&&t.jsx("div",{className:"space-y-4",children:t.jsxs(t.Fragment,{children:[c.diamond_options.map((e,i)=>t.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4",children:[t.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[t.jsxs("h4",{className:"text-sm font-semibold text-slate-900",children:["Configuration #",i+1]}),c.diamond_options.length>1&&t.jsx("button",{type:"button",onClick:()=>Re(e.key),className:"text-xs text-rose-500 transition hover:text-rose-700",children:"Remove"})]}),t.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[t.jsxs("label",{className:"flex flex-col gap-1.5 text-xs font-medium text-slate-600",children:["Type",t.jsxs("select",{value:e.type_id===""?"":e.type_id,onChange:s=>K(e.key,"type_id",s.target.value===""?"":Number(s.target.value)),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[t.jsx("option",{value:"",children:"No type"}),L.types.map(s=>t.jsx("option",{value:s.id,children:s.name},s.id))]})]}),t.jsxs("label",{className:"flex flex-col gap-1.5 text-xs font-medium text-slate-600",children:["Shape",t.jsxs("select",{value:e.shape_id===""?"":e.shape_id,onChange:s=>K(e.key,"shape_id",s.target.value===""?"":Number(s.target.value)),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[t.jsx("option",{value:"",children:"No shape"}),L.shapes.map(s=>t.jsx("option",{value:s.id,children:s.name},s.id))]})]}),t.jsxs("label",{className:"flex flex-col gap-1.5 text-xs font-medium text-slate-600",children:["Color",t.jsxs("select",{value:e.color_id===""?"":e.color_id,onChange:s=>K(e.key,"color_id",s.target.value===""?"":Number(s.target.value)),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[t.jsx("option",{value:"",children:"No color"}),L.colors.map(s=>t.jsx("option",{value:s.id,children:s.name},s.id))]})]}),t.jsxs("label",{className:"flex flex-col gap-1.5 text-xs font-medium text-slate-600",children:["Clarity",t.jsxs("select",{value:e.clarity_id===""?"":e.clarity_id,onChange:s=>K(e.key,"clarity_id",s.target.value===""?"":Number(s.target.value)),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[t.jsx("option",{value:"",children:"No clarity"}),L.clarities.map(s=>t.jsx("option",{value:s.id,children:s.name},s.id))]})]}),t.jsxs("label",{className:"flex flex-col gap-1.5 text-xs font-medium text-slate-600",children:["Cut",t.jsxs("select",{value:e.cut_id===""?"":e.cut_id,onChange:s=>K(e.key,"cut_id",s.target.value===""?"":Number(s.target.value)),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[t.jsx("option",{value:"",children:"No cut"}),L.cuts.map(s=>t.jsx("option",{value:s.id,children:s.name},s.id))]})]}),t.jsxs("label",{className:"flex flex-col gap-1.5 text-xs font-medium text-slate-600",children:["Weight (Ct)",t.jsx("input",{type:"number",step:"0.01",min:"0",value:e.weight,onChange:s=>K(e.key,"weight",s.target.value),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"0.00"})]}),t.jsxs("label",{className:"flex flex-col gap-1.5 text-xs font-medium text-slate-600",children:["Number of Diamonds",t.jsx("input",{type:"number",step:"1",min:"0",value:e.diamonds_count,onChange:s=>K(e.key,"diamonds_count",s.target.value),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"0"})]})]})]},e.key)),t.jsxs("button",{type:"button",onClick:Ke,className:"inline-flex items-center gap-2 rounded-full border border-slate-300 bg-white px-4 py-2 text-sm font-semibold text-slate-700 transition hover:border-sky-400 hover:bg-sky-50",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 5v14M5 12h14"})}),"Add diamond option"]})]})})]})]}):t.jsx("p",{className:"mt-6 rounded-2xl border border-dashed border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-600",children:"Variants are disabled. Customers will see the making charge defined above."})]}),c.is_variant_product&&t.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-xl shadow-slate-900/10 ring-1 ring-slate-200/80",children:[t.jsxs("div",{className:"flex flex-col gap-4 border-b border-slate-200 pb-6 lg:flex-row lg:items-center lg:justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Variant Matrix"}),t.jsx("p",{className:"mt-2 text-sm text-slate-500",children:"Configure product variants with metals, diamonds, and specifications. The default variant powers the customer catalogue card pricing."})]}),t.jsxs("button",{type:"button",onClick:ge,className:"inline-flex items-center gap-2 rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-lg shadow-slate-900/20 transition hover:bg-slate-700",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h7"})}),"Generate Matrix"]})]}),fe&&t.jsx("div",{className:"mt-6 rounded-2xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-600 ring-1 ring-rose-200/50",children:fe}),t.jsx("div",{className:"mt-8 overflow-hidden rounded-3xl bg-white shadow-xl shadow-slate-900/10 ring-1 ring-slate-200/80",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-slate-200 text-sm",children:[t.jsx("thead",{className:"bg-slate-50 text-xs text-slate-500",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-5 py-3 text-left min-w-[150px]",children:"SKU"}),t.jsx("th",{className:"px-5 py-3 text-left min-w-[300px]",children:"Variant Label"}),t.jsx("th",{className:"px-5 py-3 text-left",children:"Metal"}),t.jsx("th",{className:"px-5 py-3 text-left",children:"Metal Purity"}),t.jsx("th",{className:"px-5 py-3 text-left",children:"Metal Tone"}),t.jsx("th",{className:"px-5 py-3 text-left",children:"Metal Weight (g)"}),t.jsx("th",{className:"px-5 py-3 text-left",children:"Diamond Type"}),t.jsx("th",{className:"px-5 py-3 text-left",children:"Diamond Clarity"}),t.jsx("th",{className:"px-5 py-3 text-left",children:"Diamond Color"}),t.jsx("th",{className:"px-5 py-3 text-left",children:"Diamond Shape"}),t.jsx("th",{className:"px-5 py-3 text-left",children:"Diamond Cut"}),t.jsx("th",{className:"px-5 py-3 text-left",children:"Diamond Weight"}),t.jsx("th",{className:"px-5 py-3 text-left",children:"Size"}),t.jsx("th",{className:"px-5 py-3 text-left",children:"Inventory Quantity"}),t.jsx("th",{className:"px-5 py-3 text-left",children:"Status"}),t.jsx("th",{className:"px-5 py-3 text-left",children:"Default"}),t.jsx("th",{className:"px-5 py-3 text-right",children:"Actions"})]})}),t.jsxs("tbody",{className:"divide-y divide-slate-100 bg-white",children:[c.variants.map((e,i)=>{const s=X(e,c);s.metalTone;const n=(e.metals||[]).filter(l=>l.metal_id!==""&&l.metal_id!==null&&typeof l.metal_id=="number");n.reduce((l,_)=>{const x=parseFloat(_.metal_weight||_.weight_grams||"0");return l+(isNaN(x)?0:x)},0);const r=new Map;n.forEach(l=>{const _=l.metal_id;r.has(_)||r.set(_,[]),r.get(_).push({metal_id:_,metal_purity_id:l.metal_purity_id!==""&&l.metal_purity_id!==null?typeof l.metal_purity_id=="number"?l.metal_purity_id:Number(l.metal_purity_id):null,metal_tone_id:l.metal_tone_id!==""&&l.metal_tone_id!==null?typeof l.metal_tone_id=="number"?l.metal_tone_id:Number(l.metal_tone_id):null})});const h=[],f=[],d=[];r.forEach((l,_)=>{const x=G[_]||"";x&&h.push(x);const z=new Set,M=new Set;if(l.forEach(m=>{if(m.metal_purity_id!==null){const k=typeof m.metal_purity_id=="number"?m.metal_purity_id:Number(m.metal_purity_id);Number.isFinite(k)&&z.add(k)}if(m.metal_tone_id!==null){const k=typeof m.metal_tone_id=="number"?m.metal_tone_id:Number(m.metal_tone_id);Number.isFinite(k)&&M.add(k)}}),z.size>0){const m=Array.from(z).map(k=>{const S=typeof k=="number"?k:Number(k);return Number.isFinite(S)&&W[S]||""}).filter(Boolean).sort();m.length>0&&(z.size>1?f.push(`${m.join(" + ")} (${x})`):f.push(`${m[0]} (${x})`))}if(M.size>0){const m=Array.from(M).map(k=>{const S=typeof k=="number"?k:Number(k);return Number.isFinite(S)&&Y[S]||""}).filter(Boolean).sort();m.length>0&&(M.size>1?d.push(`${m.join(" + ")} (${x})`):d.push(`${m[0]} (${x})`))}});const y=h.length>0?h.join(", "):"—",j=f.length>0?f.join(" / "):"—",V=d.length>0?d.join(" / "):"—";let p=(e.diamonds||[]).filter(l=>l.diamond_type_id!==""&&l.diamond_type_id!==null||l.diamond_clarity_id!==""&&l.diamond_clarity_id!==null||l.diamond_color_id!==""&&l.diamond_color_id!==null||l.diamond_shape_id!==""&&l.diamond_shape_id!==null||l.diamond_cut_id!==""&&l.diamond_cut_id!==null);if(p.length===0&&e.diamond_option_key){const l=c.diamond_options.find(_=>_.key===e.diamond_option_key);l&&(p=[{id:void 0,diamond_type_id:l.type_id!==""?l.type_id:"",diamond_clarity_id:l.clarity_id!==""?l.clarity_id:"",diamond_color_id:l.color_id!==""?l.color_id:"",diamond_shape_id:l.shape_id!==""?l.shape_id:"",diamond_cut_id:l.cut_id!==""?l.cut_id:"",diamonds_count:"",total_carat:l.weight||""}])}const q=[],O=[],N=[],$=[],C=[],a=[];p.forEach(l=>{if(l.diamond_type_id!==""&&l.diamond_type_id!==null){const _=P.types[Number(l.diamond_type_id)];_&&!q.includes(_)&&q.push(_)}if(l.diamond_clarity_id!==""&&l.diamond_clarity_id!==null){const _=P.clarities[Number(l.diamond_clarity_id)];_&&!O.includes(_)&&O.push(_)}if(l.diamond_color_id!==""&&l.diamond_color_id!==null){const _=P.colors[Number(l.diamond_color_id)];_&&!N.includes(_)&&N.push(_)}if(l.diamond_shape_id!==""&&l.diamond_shape_id!==null){const _=P.shapes[Number(l.diamond_shape_id)];_&&!$.includes(_)&&$.push(_)}if(l.diamond_cut_id!==""&&l.diamond_cut_id!==null){const _=P.cuts[Number(l.diamond_cut_id)];_&&!C.includes(_)&&C.push(_)}if(l.total_carat&&l.total_carat!==""){const _=`${l.total_carat}ct`;a.includes(_)||a.push(_)}});const o=e.metadata??{},b=typeof o.size_value=="string"||typeof o.size_value=="number"?String(o.size_value):"",v=o.size_unit==="mm"||o.size_unit==="cm"?o.size_unit:c.size_unit,A=b?`${b}${v}`:e.size_cm?`${B(parseFloat(e.size_cm))}cm`:"—",u=typeof o.status=="string"&&o.status.trim().length>0?String(o.status):"enabled";return s.autoLabel,t.jsxs(t.Fragment,{children:[t.jsxs("tr",{className:`hover:bg-slate-50 ${u==="disabled"?"opacity-70":""} ${e.is_default?"bg-sky-50/30":""}`,children:[t.jsxs("td",{className:"px-5 py-3 align-middle min-w-[150px]",children:[t.jsx("input",{type:"text",value:e.sku,onChange:l=>Q(i,"sku",l.target.value),className:"w-full min-w-[120px] rounded-xl border border-slate-200 px-3 py-1.5 text-sm text-slate-700 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Variant SKU"}),D[`variants.${i}.sku`]&&t.jsx("p",{className:"mt-1 text-xs text-rose-500",children:D[`variants.${i}.sku`]})]}),t.jsxs("td",{className:"px-5 py-3 align-middle min-w-[300px]",children:[t.jsx("input",{type:"text",value:e.label,onChange:l=>Q(i,"label",l.target.value),className:"w-full min-w-[280px] rounded-xl border border-slate-200 px-3 py-1.5 text-sm text-slate-700 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Display label"}),D[`variants.${i}.label`]&&t.jsx("p",{className:"mt-1 text-xs text-rose-500",children:D[`variants.${i}.label`]})]}),t.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:t.jsx("div",{className:"max-w-xs",children:t.jsx("span",{className:"text-sm font-medium text-slate-800",children:y})})}),t.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:t.jsx("div",{className:"max-w-xs",children:t.jsx("span",{className:"text-sm text-slate-700",children:j})})}),t.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:t.jsx("div",{className:"max-w-xs",children:t.jsx("span",{className:"text-sm text-slate-700",children:V})})}),t.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:t.jsx("div",{className:"space-y-2 min-w-[120px]",children:n.length>0?n.map((l,_)=>{const x=G[l.metal_id]||"Unknown Metal",z=l.metal_purity_id&&typeof l.metal_purity_id=="number"&&F.find(m=>m.id===l.metal_purity_id)?.name||"",M=l.metal_tone_id&&typeof l.metal_tone_id=="number"&&U.find(m=>m.id===l.metal_tone_id)?.name||"";return t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsxs("label",{className:"text-xs font-medium text-slate-600",children:[x,z&&` - ${z}`,M&&` - ${M}`]}),t.jsx("input",{type:"number",step:"0.001",min:"0.001",required:!0,value:l.metal_weight||l.weight_grams||"",onChange:m=>{const k=m.target.value;I(i,_,"metal_weight",k),(!l.weight_grams||l.weight_grams==="")&&I(i,_,"weight_grams",k)},className:`w-full rounded-lg border px-2.5 py-1.5 text-xs font-medium transition-colors ${!l.metal_weight&&!l.weight_grams?"border-rose-300 bg-rose-50 focus:border-rose-400 focus:bg-white":"border-slate-200 bg-white focus:border-sky-400"} focus:outline-none focus:ring-1 focus:ring-sky-200`,placeholder:"0.000"}),!l.metal_weight&&!l.weight_grams&&t.jsx("span",{className:"text-[10px] text-rose-500",children:"Required"})]},_)}):t.jsx("span",{className:"text-sm text-slate-400",children:"—"})})}),t.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:t.jsx("div",{className:"max-w-xs",children:t.jsx("span",{className:"text-sm text-slate-700",children:q.length>0?q.join(", "):"—"})})}),t.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:t.jsx("div",{className:"max-w-xs",children:t.jsx("span",{className:"text-sm text-slate-700",children:O.length>0?O.join(", "):"—"})})}),t.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:t.jsx("div",{className:"max-w-xs",children:t.jsx("span",{className:"text-sm text-slate-700",children:N.length>0?N.join(", "):"—"})})}),t.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:t.jsx("div",{className:"max-w-xs",children:t.jsx("span",{className:"text-sm text-slate-700",children:$.length>0?$.join(", "):"—"})})}),t.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:t.jsx("div",{className:"max-w-xs",children:t.jsx("span",{className:"text-sm text-slate-700",children:C.length>0?C.join(", "):"—"})})}),t.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:t.jsx("div",{className:"max-w-xs",children:t.jsx("span",{className:"text-sm text-slate-700",children:a.length>0?a.join(", "):"—"})})}),t.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:A}),t.jsx("td",{className:"px-5 py-3 align-middle text-slate-700",children:t.jsx("input",{type:"number",min:"0",step:"1",value:e.inventory_quantity!==void 0&&e.inventory_quantity!==null&&e.inventory_quantity!==""?String(e.inventory_quantity):"",onChange:l=>{const _=l.target.value.trim();if(_==="")Q(i,"inventory_quantity","");else{const x=parseInt(_,10);!isNaN(x)&&x>=0&&Q(i,"inventory_quantity",x)}},onBlur:l=>{l.target.value.trim()===""&&Q(i,"inventory_quantity",0)},className:"w-full min-w-[100px] rounded-xl border border-slate-200 px-3 py-1.5 text-sm text-slate-700 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"0"})}),t.jsx("td",{className:"px-5 py-3 text-slate-700",children:t.jsxs("select",{value:u,onChange:l=>Ge(i,{status:l.target.value}),className:`rounded-xl border px-3 py-1.5 text-sm text-slate-700 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200 ${u==="enabled"?"border-emerald-300 bg-emerald-50":"border-amber-300 bg-amber-50"}`,children:[t.jsx("option",{value:"enabled",children:"Enabled"}),t.jsx("option",{value:"disabled",children:"Disabled"})]})}),t.jsx("td",{className:"px-5 py-3 text-slate-700",children:t.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-slate-600",children:[t.jsx("input",{type:"radio",name:"default-variant-table",checked:e.is_default,onChange:()=>He(i),className:"h-4 w-4 text-sky-600 focus:ring-sky-500"}),t.jsx("span",{children:e.is_default?"Default":"Set default"})]})}),t.jsx("td",{className:"px-5 py-3 text-right",children:t.jsx("button",{type:"button",onClick:()=>We(i),className:"inline-flex items-center justify-center rounded-full border border-rose-200 p-2 text-rose-600 transition hover:border-rose-300 hover:text-rose-700","aria-label":"Remove variant",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,className:"h-4 w-4",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 7h12m-9 3v6m6-6v6M10 4h4a1 1 0 0 1 1 1v1H9V5a1 1 0 0 1 1-1Z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 7h14l-.8 11.2A2 2 0 0 1 16.2 20H7.8a2 2 0 0 1-1.99-1.8L5 7Z"})]})})})]},e.id??`variant-${i}`),Ve.has(i)&&t.jsx("tr",{children:t.jsx("td",{colSpan:17,className:"px-5 py-4",children:t.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4",children:[t.jsx("div",{className:"mb-4 flex items-center justify-between",children:t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-semibold text-slate-900",children:"Metals for this Variant"}),t.jsxs("p",{className:"mt-1 text-xs text-slate-600",children:[t.jsx("span",{className:"font-semibold text-rose-600",children:"Required:"})," Enter metal weight (in grams) for each metal in this variant."]})]})}),n.length===0?t.jsx("p",{className:"text-xs text-slate-400",children:"No metals assigned to this variant."}):t.jsx("div",{className:"space-y-3",children:n.map((l,_)=>{const x=G[l.metal_id]||"Unknown Metal",z=l.metal_purity_id&&typeof l.metal_purity_id=="number"&&F.find(m=>m.id===l.metal_purity_id)?.name||"",M=l.metal_tone_id&&typeof l.metal_tone_id=="number"&&U.find(m=>m.id===l.metal_tone_id)?.name||"";return t.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-4",children:[t.jsx("div",{className:"mb-3 flex items-center justify-between",children:t.jsxs("span",{className:"text-xs font-semibold text-slate-600",children:[x,z&&` — ${z}`,M&&` — ${M}`]})}),t.jsx("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-3",children:t.jsxs("label",{className:"flex flex-col gap-1.5",children:[t.jsxs("span",{className:"text-xs font-semibold text-slate-700 flex items-center gap-1",children:[t.jsx("span",{children:"Metal Weight (g)"}),t.jsx("span",{className:"text-rose-500 font-bold text-sm",title:"Required field",children:"*"})]}),t.jsx("input",{type:"number",step:"0.001",min:"0.001",required:!0,value:l.metal_weight||l.weight_grams||"",onChange:m=>{const k=m.target.value;I(i,_,"metal_weight",k),(!l.weight_grams||l.weight_grams==="")&&I(i,_,"weight_grams",k)},className:`rounded-xl border-2 px-3 py-2 text-sm font-medium transition-colors ${!l.metal_weight&&!l.weight_grams?"border-rose-300 bg-rose-50 focus:border-rose-400 focus:bg-white":"border-slate-200 bg-white focus:border-sky-400"} focus:outline-none focus:ring-2 focus:ring-sky-200`,placeholder:"Enter weight (required)"}),!l.metal_weight&&!l.weight_grams&&t.jsx("span",{className:"text-xs text-rose-600 font-medium",children:"⚠️ This field is required"})]})})]},_)})})]})})}),De.has(i)&&t.jsx("tr",{children:t.jsx("td",{colSpan:17,className:"px-5 py-4",children:t.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4",children:[t.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-semibold text-slate-900",children:"Diamonds for this Variant"}),c.diamond_mixing_mode==="shared"&&t.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"This variant uses the shared diamond list defined above. All variants share the same diamonds."}),c.diamond_mixing_mode==="as_variant"&&t.jsx("p",{className:"mt-1 text-xs text-slate-500",children:"This variant has its specific diamond from the diamond mixes list. Each variant-diamond combination is a separate sellable variant."})]}),c.diamond_mixing_mode==="shared"&&t.jsx("p",{className:"mb-4 text-xs text-slate-500",children:'In "shared" mode, diamonds are managed in the "Diamond mixes" section above. All variants use the same diamond list.'}),c.diamond_mixing_mode==="as_variant"&&t.jsxs("button",{type:"button",onClick:()=>Ye(i),className:"inline-flex items-center gap-2 rounded-full border border-slate-300 bg-white px-3 py-1.5 text-xs font-semibold text-slate-700 transition hover:border-sky-400 hover:bg-sky-50",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 5v14M5 12h14"})}),"Add Diamond"]})]}),p.length===0?t.jsx("p",{className:"text-xs text-slate-400",children:c.diamond_mixing_mode==="shared"?"No diamonds assigned to this variant from the shared matrix.":'No diamonds added to this variant. Click "Add Diamond" to add one.'}):t.jsx("div",{className:"space-y-3",children:p.map((l,_)=>t.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-4",children:[t.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[t.jsxs("span",{className:"text-xs font-semibold text-slate-600",children:["Diamond #",_+1]}),c.diamond_mixing_mode==="as_variant"&&t.jsx("button",{type:"button",onClick:()=>Qe(i,_),className:"text-xs text-rose-500 transition hover:text-rose-700",children:"Remove"})]}),t.jsxs("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-3",children:[t.jsxs("label",{className:"flex flex-col gap-1.5 text-xs font-medium text-slate-600",children:["Type",t.jsxs("select",{value:l.diamond_type_id===""?"":l.diamond_type_id,onChange:x=>R(i,_,"diamond_type_id",x.target.value===""?"":Number(x.target.value)),disabled:c.diamond_mixing_mode==="shared",className:`rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200 ${c.diamond_mixing_mode==="shared"?"bg-slate-50 cursor-not-allowed":""}`,children:[t.jsx("option",{value:"",children:"Select type"}),L.types.map(x=>t.jsx("option",{value:x.id,children:x.name},x.id))]})]}),t.jsxs("label",{className:"flex flex-col gap-1.5 text-xs font-medium text-slate-600",children:["Clarity",t.jsxs("select",{value:l.diamond_clarity_id===""?"":l.diamond_clarity_id,onChange:x=>R(i,_,"diamond_clarity_id",x.target.value===""?"":Number(x.target.value)),disabled:c.diamond_mixing_mode==="shared",className:`rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200 ${c.diamond_mixing_mode==="shared"?"bg-slate-50 cursor-not-allowed":""}`,children:[t.jsx("option",{value:"",children:"Select clarity"}),L.clarities.map(x=>t.jsx("option",{value:x.id,children:x.name},x.id))]})]}),t.jsxs("label",{className:"flex flex-col gap-1.5 text-xs font-medium text-slate-600",children:["Color",t.jsxs("select",{value:l.diamond_color_id===""?"":l.diamond_color_id,onChange:x=>R(i,_,"diamond_color_id",x.target.value===""?"":Number(x.target.value)),disabled:c.diamond_mixing_mode==="shared",className:`rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200 ${c.diamond_mixing_mode==="shared"?"bg-slate-50 cursor-not-allowed":""}`,children:[t.jsx("option",{value:"",children:"Select color"}),L.colors.map(x=>t.jsx("option",{value:x.id,children:x.name},x.id))]})]}),t.jsxs("label",{className:"flex flex-col gap-1.5 text-xs font-medium text-slate-600",children:["Shape",t.jsxs("select",{value:l.diamond_shape_id===""?"":l.diamond_shape_id,onChange:x=>R(i,_,"diamond_shape_id",x.target.value===""?"":Number(x.target.value)),disabled:c.diamond_mixing_mode==="shared",className:`rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200 ${c.diamond_mixing_mode==="shared"?"bg-slate-50 cursor-not-allowed":""}`,children:[t.jsx("option",{value:"",children:"Select shape"}),L.shapes.map(x=>t.jsx("option",{value:x.id,children:x.name},x.id))]})]}),t.jsxs("label",{className:"flex flex-col gap-1.5 text-xs font-medium text-slate-600",children:["Cut",t.jsxs("select",{value:l.diamond_cut_id===""?"":l.diamond_cut_id,onChange:x=>R(i,_,"diamond_cut_id",x.target.value===""?"":Number(x.target.value)),disabled:c.diamond_mixing_mode==="shared",className:`rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200 ${c.diamond_mixing_mode==="shared"?"bg-slate-50 cursor-not-allowed":""}`,children:[t.jsx("option",{value:"",children:"Select cut"}),L.cuts.map(x=>t.jsx("option",{value:x.id,children:x.name},x.id))]})]}),t.jsxs("label",{className:"flex flex-col gap-1.5 text-xs font-medium text-slate-600",children:["Total Carat",t.jsx("input",{type:"number",step:"0.01",min:"0",value:l.total_carat,onChange:x=>R(i,_,"total_carat",x.target.value),disabled:c.diamond_mixing_mode==="shared",className:`rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200 ${c.diamond_mixing_mode==="shared"?"bg-slate-50 cursor-not-allowed":""}`,placeholder:"0.00"})]}),t.jsxs("label",{className:"flex flex-col gap-1.5 text-xs font-medium text-slate-600",children:["Number of Diamonds",t.jsx("input",{type:"number",step:"1",min:"0",value:l.diamonds_count,onChange:x=>R(i,_,"diamonds_count",x.target.value),disabled:c.diamond_mixing_mode==="shared",className:`rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200 ${c.diamond_mixing_mode==="shared"?"bg-slate-50 cursor-not-allowed":""}`,placeholder:"0"})]})]})]},_))})]})})})]})}),c.variants.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:17,className:"px-5 py-6 text-center text-xs uppercase tracking-[0.1em] text-slate-400",children:"No variants configured. Generate matrix to create variants."})})]})]})})})]})]})]})}export{mt as default};
