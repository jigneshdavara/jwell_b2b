import{u as y,a as u,j as e,H as N,b as v,r as k}from"./app-BPfwiKJb.js";import{A as w}from"./AdminLayout-C7QSrqtK.js";import{I as p}from"./InputError-DYBFjgaO.js";function R(){const{user:s,statuses:m,documentStatuses:i,messages:l}=y().props,{data:d,setData:n,post:o,processing:c,errors:r}=u({status:s.kyc_status,remarks:s.kyc_notes??""}),a=u({message:""}),h=t=>{t.preventDefault(),a.data.message.trim()&&a.post(route("admin.customers.kyc.messages.store",s.id),{preserveScroll:!0,onSuccess:()=>a.reset("message")})},f=t=>{t.preventDefault(),o(route("admin.customers.update-kyc",s.id),{preserveScroll:!0})},b=()=>{v.post(route("admin.customers.kyc.comments.update",s.id),{allow_replies:!s.comments_enabled},{preserveScroll:!0})},g=t=>t?new Date(t).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"";return e.jsxs(w,{children:[e.jsx(N,{title:`KYC Review - ${s.name}`}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-xl shadow-slate-900/10 ring-1 ring-slate-200/80",children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"KYC Review"}),e.jsx("p",{className:"mt-2 text-sm text-slate-500",children:"Review submitted documents and update status."})]}),e.jsxs("form",{onSubmit:f,className:"space-y-6 rounded-3xl bg-white p-6 shadow-xl shadow-slate-900/10 ring-1 ring-slate-200/80",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:s.name}),e.jsx("p",{className:"text-sm text-slate-500",children:s.email})]}),e.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-900 px-3 py-1 text-xs font-semibold text-white",children:s.kyc_status_label})]}),s.kyc_notes&&e.jsxs("div",{className:"rounded-2xl bg-amber-50 p-4 text-sm text-amber-700",children:[e.jsx("p",{className:"font-semibold text-amber-600",children:"Partner notes"}),e.jsx("p",{className:"mt-2 whitespace-pre-line",children:s.kyc_notes})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{className:"font-semibold text-slate-800",children:"Update status"}),e.jsx("select",{className:"rounded-2xl border border-slate-300 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",value:d.status,onChange:t=>n("status",t.target.value),children:m.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),r.status&&e.jsx("span",{className:"text-xs text-rose-500",children:r.status})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{className:"font-semibold text-slate-800",children:"Internal remarks"}),e.jsx("textarea",{className:"min-h-[120px] rounded-2xl border border-slate-300 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",value:d.remarks,onChange:t=>n("remarks",t.target.value),placeholder:"Add context for the customer success team (optional)"}),r.remarks&&e.jsx("span",{className:"text-xs text-rose-500",children:r.remarks})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:c,className:"rounded-full bg-slate-900 px-5 py-2 text-sm font-semibold text-white shadow shadow-slate-900/20 transition hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",children:"Save decision"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-3xl bg-white p-6 shadow-xl shadow-slate-900/10 ring-1 ring-slate-200/80",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Conversation"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Shared timeline between compliance and the customer."})]}),e.jsx("button",{type:"button",onClick:b,className:"inline-flex items-center rounded-full border border-slate-200 px-3 py-1.5 text-xs font-semibold text-slate-600 transition hover:border-slate-300 hover:text-slate-900",children:s.comments_enabled?"Disable customer replies":"Enable customer replies"})]}),e.jsx("div",{className:"mt-4 space-y-3 overflow-y-auto rounded-2xl bg-slate-50 p-4 text-sm text-slate-700 max-h-64",children:l.length===0?e.jsx("p",{className:"text-xs text-slate-500",children:"No messages yet. Send a note to start the conversation with the customer."}):l.map(t=>{const x=t.sender_type==="admin",j=x?t.admin?.name??"Compliance team":s.name;return e.jsxs("div",{className:`flex flex-col gap-1 ${x?"items-end text-right":"items-start text-left"}`,children:[e.jsxs("span",{className:"text-[11px] text-slate-400",children:[j,t.created_at?` · ${g(t.created_at)}`:""]}),e.jsx("div",{className:`max-w-full rounded-2xl px-4 py-3 text-sm ${x?"bg-slate-900 text-white":"bg-white text-slate-700 shadow ring-1 ring-slate-200/70"}`,children:e.jsx("p",{className:"whitespace-pre-line",children:t.message})})]},t.id)})}),!s.comments_enabled&&e.jsx("p",{className:"mt-3 rounded-2xl bg-slate-50 px-4 py-3 text-xs text-slate-500",children:"Customer replies are disabled. They will still see all messages you send from here."}),e.jsxs("form",{onSubmit:h,className:"mt-4 space-y-2",children:[e.jsxs("label",{className:"flex flex-col gap-2 text-xs text-slate-600",children:[e.jsx("span",{className:"font-semibold text-slate-700",children:"Add message for customer"}),e.jsx("textarea",{value:a.data.message,onChange:t=>a.setData("message",t.target.value),className:"min-h-[90px] rounded-2xl border border-slate-300 px-4 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Share clarifications, request missing documents, or confirm approval.",disabled:a.processing}),e.jsx(p,{message:a.errors.message})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:a.processing||!a.data.message.trim(),className:"inline-flex items-center rounded-full bg-slate-900 px-4 py-2 text-xs font-semibold text-white shadow shadow-slate-900/20 transition hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",children:a.processing?"Sending…":"Send message"})})]})]}),s.kyc_profile&&e.jsxs("div",{className:"rounded-3xl bg-white p-5 shadow-xl shadow-slate-900/10 ring-1 ring-slate-200/80",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700",children:"Business information"}),e.jsxs("dl",{className:"mt-4 grid gap-4 text-sm text-slate-700 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-slate-500",children:"Store name"}),e.jsx("dd",{className:"mt-1 text-slate-900",children:s.kyc_profile.business_name??"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-slate-500",children:"Website"}),e.jsx("dd",{className:"mt-1 text-slate-900",children:s.kyc_profile.business_website??"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-slate-500",children:"GST"}),e.jsx("dd",{className:"mt-1 text-slate-900",children:s.kyc_profile.gst_number??"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-slate-500",children:"PAN"}),e.jsx("dd",{className:"mt-1 text-slate-900",children:s.kyc_profile.pan_number??"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-slate-500",children:"Registration no."}),e.jsx("dd",{className:"mt-1 text-slate-900",children:s.kyc_profile.registration_number??"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-slate-500",children:"Contact"}),e.jsxs("dd",{className:"mt-1 text-slate-900",children:[s.kyc_profile.contact_name??"—",s.kyc_profile.contact_phone?` · ${s.kyc_profile.contact_phone}`:""]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("dt",{className:"font-medium text-slate-500",children:"Address"}),e.jsxs("dd",{className:"mt-1 text-slate-900",children:[[s.kyc_profile.address_line1,s.kyc_profile.address_line2].filter(Boolean).join(", ")||"—",e.jsx("br",{}),[s.kyc_profile.city,s.kyc_profile.state,s.kyc_profile.postal_code].filter(Boolean).join(", ")||"",s.kyc_profile.country?`, ${s.kyc_profile.country}`:""]})]})]})]}),s.kyc_documents.length===0?e.jsx("div",{className:"rounded-3xl border border-dashed border-slate-300 p-12 text-center text-slate-500",children:"No documents uploaded yet."}):s.kyc_documents.map(t=>e.jsx(_,{document:t,statuses:i},t.id))]})]})]})}function _({document:s,statuses:m}){const{data:i,setData:l,put:d,processing:n,errors:o}=u({status:s.status,remarks:s.remarks??""}),c={approved:"bg-emerald-100 text-emerald-700",rejected:"bg-rose-100 text-rose-700",needs_revision:"bg-amber-100 text-amber-700",pending:"bg-slate-100 text-slate-700"};k.useEffect(()=>{l(a=>({...a,status:s.status,remarks:s.remarks??""}))},[s.id,s.status,s.remarks,l]);const r=a=>{a.preventDefault(),d(route("admin.customers.kyc.documents.update",s.id),{preserveScroll:!0})};return e.jsxs("form",{onSubmit:r,className:"space-y-4 rounded-3xl bg-white p-5 shadow-xl shadow-slate-900/10 ring-1 ring-slate-200/80",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:s.type}),e.jsx("p",{className:"text-xs text-slate-500 break-all",children:s.file_path})]}),e.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold ${c[s.status]??c.pending}`,children:s.status})]}),s.file_url&&e.jsx("a",{href:s.file_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-xs font-semibold text-sky-600 hover:text-sky-500",children:"View document"}),e.jsxs("label",{className:"flex flex-col gap-2 text-xs text-slate-600",children:[e.jsx("span",{className:"font-semibold text-slate-500",children:"Status"}),e.jsx("select",{value:i.status,onChange:a=>l("status",a.target.value),className:"rounded-2xl border border-slate-300 px-4 py-2 text-sm capitalize focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:m.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsx(p,{message:o.status})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-xs text-slate-600",children:[e.jsx("span",{className:"font-semibold text-slate-500",children:"Comment for partner"}),e.jsx("textarea",{value:i.remarks??"",onChange:a=>l("remarks",a.target.value),className:"min-h-[100px] rounded-2xl border border-slate-300 px-4 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Explain missing pages, clarity issues, or alternate docs required"}),e.jsx(p,{message:o.remarks})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:n,className:"rounded-full bg-slate-900 px-4 py-2 text-xs font-semibold text-white shadow shadow-slate-900/20 transition hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",children:n?"Saving…":"Save feedback"})})]})}export{R as default};
