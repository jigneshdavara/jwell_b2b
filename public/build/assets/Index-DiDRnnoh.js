import{u as M,r as i,a as E,b as F,j as e,H as I}from"./app-BkiRhpSZ.js";import{A as $}from"./AdminLayout-DH9begtS.js";function z(){const{rates:v,defaultCurrency:o,metalSummaries:c}=M().props,[d,w]=i.useState(null),_=i.useCallback((t,s)=>{try{return new Intl.NumberFormat("en-IN",{style:"currency",currency:s,maximumFractionDigits:2}).format(t)}catch{return`${t.toLocaleString("en-IN")} ${s}`}},[]),k=i.useCallback(t=>t?t.split(/[-_]/).map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "):null,[]),x=i.useCallback(t=>t.length?t.map(s=>({purity:s.purity??"",price_per_gram:typeof s.price_per_gram=="number"&&!Number.isNaN(s.price_per_gram)?String(s.price_per_gram):""})):[{purity:"",price_per_gram:""}],[]),r=E({currency:c.gold.latest?.currency??o,rates:x(c.gold.rates)}),l=E({currency:c.silver.latest?.currency??o,rates:x(c.silver.rates)});i.useEffect(()=>{r.setData("currency",c.gold.latest?.currency??o),r.setData("rates",x(c.gold.rates))},[o,r,x,c.gold]),i.useEffect(()=>{l.setData("currency",c.silver.latest?.currency??o),l.setData("rates",x(c.silver.rates))},[o,x,c.silver,l]);const y=i.useCallback((t,s,a,m)=>{const n=t==="gold"?r:l;n.setData("rates",n.data.rates.map((g,f)=>f===s?{...g,[a]:m}:g))},[r,l]),C=i.useCallback(t=>{const s=t==="gold"?r:l;s.setData("rates",[...s.data.rates,{purity:"",price_per_gram:""}])},[r,l]),S=i.useCallback((t,s)=>{const a=t==="gold"?r:l;if(a.data.rates.length===1){a.setData("rates",[{purity:"",price_per_gram:""}]);return}a.setData("rates",a.data.rates.filter((m,n)=>n!==s))},[r,l]),R=i.useCallback(t=>{(t==="gold"?r:l).post(route("admin.rates.metal.store",{metal:t}),{preserveScroll:!0})},[r,l]),h=i.useCallback(t=>{w(t),F.post(route("admin.rates.sync",{metal:t}),{},{preserveScroll:!0,onFinish:()=>w(null)})},[]),D=i.useCallback(t=>{const s=c[t],a=t==="gold"?r:l,m=a.processing,n=s.latest,g=a.data.rates,f=a.errors;return e.jsxs("section",{className:"space-y-5 rounded-3xl bg-white p-6 shadow-xl shadow-slate-900/10 ring-1 ring-slate-200/80",children:[e.jsxs("header",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-slate-900",children:[s.label," reference rates"]}),e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:"Live reference & manual control"})]}),e.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-full border border-slate-200 px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-slate-700 transition hover:bg-slate-100 disabled:cursor-not-allowed disabled:opacity-60",onClick:()=>h(t),disabled:d===t,children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{fillRule:"evenodd",d:"M3.172 7a4 4 0 015.656-5.656l1.172 1.172a.75.75 0 101.06-1.06L9.89.516a5.5 5.5 0 00-7.778 7.778l.354.353a.75.75 0 001.06-1.06L3.172 7zm13.657 6a4 4 0 01-5.657 5.657l-1.172-1.172a.75.75 0 10-1.06 1.06l1.17 1.172a5.5 5.5 0 007.778-7.778l-.353-.354a.75.75 0 10-1.06 1.06l.354.355z",clipRule:"evenodd"}),e.jsx("path",{d:"M6.75 6.5a.75.75 0 000 1.5h3.5a.75.75 0 000-1.5h-3.5zM9.25 12a.75.75 0 01.75-.75h3a.75.75 0 010 1.5h-3a.75.75 0 01-.75-.75z"})]}),d===t?"Syncing…":`Sync ${s.label}`]})]}),n?e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-slate-50 p-4",children:[e.jsx("p",{className:"text-sm font-medium text-slate-600",children:"Latest live feed"}),e.jsxs("p",{className:"mt-2 text-2xl font-semibold text-slate-900",children:[_(n.price_per_gram,n.currency)," ",e.jsxs("span",{className:"text-base font-normal text-slate-500",children:["/ gram · ",n.purity??"—"]})]}),n.source&&e.jsx("p",{className:"mt-1 text-xs uppercase tracking-[0.2em] text-slate-400",children:k(n.source)}),n.effective_at&&e.jsxs("p",{className:"mt-1 text-xs uppercase tracking-[0.2em] text-slate-400",children:["Updated ",new Date(n.effective_at).toLocaleString("en-IN")]})]}):e.jsx("div",{className:"rounded-2xl border border-dashed border-slate-200 p-4 text-sm text-slate-500",children:"No live feed synced yet. Use the sync button to fetch reference rates."})]}),e.jsxs("div",{className:"space-y-4",children:[g.map((u,p)=>{const b=f[`rates.${p}.purity`],L=Array.isArray(b)?b[0]:b,j=f[`rates.${p}.price_per_gram`],A=Array.isArray(j)?j[0]:j;return e.jsxs("div",{className:"rounded-2xl border border-slate-200 p-4",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-[1fr_auto]",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-semibold uppercase tracking-[0.3em] text-slate-500",children:["Purity",e.jsx("input",{type:"text",value:u.purity,onChange:N=>y(t,p,"purity",N.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"e.g. 24K"})]}),L&&e.jsx("span",{className:"text-xs text-rose-500",children:L})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-semibold uppercase tracking-[0.3em] text-slate-500",children:["Rate / gram",e.jsx("input",{type:"number",min:"0",step:"0.01",value:u.price_per_gram,onChange:N=>y(t,p,"price_per_gram",N.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"0.00"})]}),A&&e.jsx("span",{className:"text-xs text-rose-500",children:A})]})]}),e.jsxs("div",{className:"mt-3 flex justify-between text-xs text-slate-500",children:[e.jsx("span",{children:a.data.currency?.toUpperCase()||o}),e.jsx("button",{type:"button",className:"text-rose-500 transition hover:text-rose-600",onClick:()=>S(t,p),children:"Remove"})]})]},`${u.purity}-${p}`)}),e.jsxs("button",{type:"button",onClick:()=>C(t),className:"inline-flex items-center gap-2 rounded-full border border-dashed border-slate-300 px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-slate-600 transition hover:border-slate-400 hover:text-slate-700",children:[e.jsx("span",{className:"text-lg leading-none",children:"+"})," Add purity"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-xs font-semibold uppercase tracking-[0.3em] text-slate-500",children:["Currency",e.jsx("input",{type:"text",value:a.data.currency,onChange:u=>a.setData("currency",u.target.value.toUpperCase()),className:"w-28 rounded-2xl border border-slate-200 px-3 py-2 text-sm font-medium uppercase text-slate-800 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",maxLength:10})]}),e.jsx("button",{type:"button",onClick:()=>R(t),disabled:m,className:"ml-auto inline-flex items-center gap-2 rounded-full bg-slate-900 px-5 py-2 text-sm font-semibold text-white shadow shadow-slate-900/30 transition hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",children:m?"Saving…":"Save rates"})]})]})},[C,o,_,k,r,c,S,R,y,l,h,d]);return e.jsxs($,{children:[e.jsx(I,{title:"Live Rates"}),e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"rounded-3xl bg-white p-6 shadow-xl shadow-slate-900/10 ring-1 ring-slate-200/80",children:e.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"Reference rates"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Sync live values for metals and lock in your internal calculation rates."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>h("gold"),disabled:d==="gold",className:"inline-flex items-center gap-2 rounded-full bg-amber-500 px-5 py-2 text-sm font-semibold text-white shadow transition hover:bg-amber-400 disabled:cursor-not-allowed disabled:opacity-60",children:d==="gold"?"Syncing…":"Sync gold rate"}),e.jsx("button",{type:"button",onClick:()=>h("silver"),disabled:d==="silver",className:"inline-flex items-center gap-2 rounded-full bg-slate-600 px-5 py-2 text-sm font-semibold text-white shadow transition hover:bg-slate-500 disabled:cursor-not-allowed disabled:opacity-60",children:d==="silver"?"Syncing…":"Sync silver rate"})]})]})}),e.jsxs("div",{className:"grid gap-6 xl:grid-cols-2",children:[D("gold"),D("silver")]}),e.jsx("div",{className:"overflow-hidden rounded-3xl bg-white shadow-xl shadow-slate-900/10 ring-1 ring-slate-200/80",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200 text-sm",children:[e.jsx("thead",{className:"bg-slate-50 text-xs uppercase tracking-[0.3em] text-slate-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-5 py-3 text-left",children:"Metal"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Purity"}),e.jsx("th",{className:"px-5 py-3 text-right",children:"Price / g"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Source"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Effective at"}),e.jsx("th",{className:"px-5 py-3 text-left",children:"Notes"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 bg-white",children:[v.data.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"px-5 py-3 font-semibold text-slate-900",children:t.metal}),e.jsx("td",{className:"px-5 py-3 text-slate-500",children:t.purity??"—"}),e.jsxs("td",{className:"px-5 py-3 text-right text-slate-900",children:[t.price_per_gram.toLocaleString("en-IN")," ",t.currency]}),e.jsx("td",{className:"px-5 py-3 text-slate-600",children:t.source}),e.jsx("td",{className:"px-5 py-3 text-slate-500",children:t.effective_at?new Date(t.effective_at).toLocaleString("en-IN"):"—"}),e.jsx("td",{className:"px-5 py-3 text-slate-500",children:typeof t.metadata?.notes=="string"&&t.metadata.notes.trim().length?t.metadata.notes:"—"})]},t.id)),v.data.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-5 py-6 text-center text-sm text-slate-500",children:"No rate records found."})})]})]})})]})]})}export{z as default};
