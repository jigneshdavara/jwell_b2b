import{u as B,a as F,r as q,j as e,H as G}from"./app-QzdpPliV.js";import{A as H}from"./AdminLayout-pg0ur-Jd.js";const z=(u=!1)=>({sku:"",label:"",metal_tone:"",stone_quality:"",size:"",price_adjustment:"0",is_default:u}),N=(...u)=>{const r=new Set;return u.forEach(j=>{j.forEach(p=>{if(p==null)return;const g=String(p).trim();g.length!==0&&r.add(g)})}),Array.from(r)};function I(){const{props:u}=B(),{product:r,brands:j,categories:p,materials:g,variantLibrary:_,errors:n}=u,V=r?.variants?.length?r.variants.map((s,t)=>({id:s.id,sku:s.sku??"",label:s.label??"",metal_tone:s.metal_tone??"",stone_quality:s.stone_quality??"",size:s.size??"",price_adjustment:String(s.price_adjustment??0),is_default:s.is_default??t===0})):[z(!0)],D={metal_tone:N(r?.variant_options?.metal_tone??[],_.metal_tone??[]),stone_quality:N(r?.variant_options?.stone_quality??[],_.stone_quality??[]),size:N(r?.variant_options?.size??[],_.size??[])},{data:l,setData:i,post:O,put:E,processing:v}=F(()=>({sku:r?.sku??"",name:r?.name??"",description:r?.description??"",brand_id:String(r?.brand_id??""),category_id:String(r?.category_id??""),material_id:String(r?.material_id??""),gross_weight:r?.gross_weight?String(r.gross_weight):"",net_weight:r?.net_weight?String(r.net_weight):"",base_price:r?.base_price?String(r.base_price):"",making_charge:r?.making_charge?String(r.making_charge):"",is_jobwork_allowed:r?.is_jobwork_allowed??!1,visibility:r?.visibility??"public",standard_pricing:{labour_brand:r?.standard_pricing?.labour_brand?String(r.standard_pricing.labour_brand):"",diamond_rate:r?.standard_pricing?.diamond_rate?String(r.standard_pricing.diamond_rate):"",gold_rate:r?.standard_pricing?.gold_rate?String(r.standard_pricing.gold_rate):"",colourstone_rate:r?.standard_pricing?.colourstone_rate?String(r.standard_pricing.colourstone_rate):""},variant_options:D,variants:V})),[h,k]=q.useState({metal_tone:"",stone_quality:"",size:""}),w=[{key:"metal_tone",label:"Metal tone"},{key:"stone_quality",label:"Stone quality"},{key:"size",label:"Size"}],L=s=>{const t=h[s].trim();t&&(i(a=>{const o=a.variant_options?.[s]??[];return o.includes(t)?a:{...a,variant_options:{...a.variant_options,[s]:[...o,t]}}}),k({...h,[s]:""}))},P=(s,t)=>{i(a=>{const o=a.variant_options?.[s]??[];return{...a,variant_options:{...a.variant_options,[s]:o.filter(c=>c!==t)}}})},A=s=>{i(t=>{if(t.variants.length===1)return t;const a=t.variants.filter((o,c)=>c!==s);return a.every(o=>!o.is_default)&&(a[0].is_default=!0),{...t,variants:a}})},b=(s,t,a)=>{i(o=>{const c=o.variants.map((x,m)=>{if(m!==s)return x;const d={...x,[t]:a};if(["metal_tone","stone_quality","size"].includes(t)){const y=typeof a=="string"?a:"",S=[t==="metal_tone"?y:d.metal_tone,t==="stone_quality"?y:d.stone_quality,t==="size"?y:d.size].filter($=>$&&$.length).join(" / ");(!x.label||x.label===S)&&(d.label=S)}return d});let f=o.variant_options;if(["metal_tone","stone_quality","size"].includes(t)&&typeof a=="string"){const x=t,m=a.trim();if(m.length){const d=new Set(f[x]??[]);d.has(m)||(f={...f,[x]:[...d,m]})}}return{...o,variants:c,variant_options:f}})},M=s=>{i(t=>({...t,variants:t.variants.map((a,o)=>({...a,is_default:o===s}))}))},K=()=>{i(s=>({...s,variants:[...s.variants,z(s.variants.length===0)]}))},R=s=>{s.preventDefault(),r?.id?E(route("admin.products.update",r.id)):O(route("admin.products.store"))},C=n.variants,U=q.useMemo(()=>[{key:"labour_brand",label:"Labour brand / atelier",type:"text"},{key:"diamond_rate",label:"Diamond rate (₹/ct)",type:"number"},{key:"gold_rate",label:"Gold rate (₹/g)",type:"number"},{key:"colourstone_rate",label:"Colour stone rate (₹/ct)",type:"number"}],[]);return e.jsxs(H,{children:[e.jsx(G,{title:r?.id?`Edit ${r.name}`:"New Product"}),e.jsxs("form",{onSubmit:R,className:"space-y-10",children:[e.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-xl shadow-slate-900/10",children:[e.jsxs("div",{className:"flex flex-col gap-4 border-b border-slate-100 pb-6 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:r?.id?"Update catalogue record":"Create catalogue record"}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Define product master information, atelier references, and jobwork eligibility."})]}),e.jsx("button",{type:"submit",disabled:v,className:"inline-flex items-center gap-2 rounded-full bg-slate-900 px-5 py-2 text-sm font-semibold text-white shadow-lg shadow-slate-900/20 transition hover:bg-slate-700 disabled:cursor-not-allowed disabled:opacity-60",children:v?"Saving…":r?.id?"Save changes":"Create product"})]}),e.jsxs("div",{className:"mt-6 grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"SKU *"}),e.jsx("input",{type:"text",value:l.sku,onChange:s=>i("sku",s.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),n.sku&&e.jsx("span",{className:"text-xs text-rose-500",children:n.sku})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Product name *"}),e.jsx("input",{type:"text",value:l.name,onChange:s=>i("name",s.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),n.name&&e.jsx("span",{className:"text-xs text-rose-500",children:n.name})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Description"}),e.jsx("textarea",{value:l.description,onChange:s=>i("description",s.target.value),className:"min-h-[120px] rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),n.description&&e.jsx("span",{className:"text-xs text-rose-500",children:n.description})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Brand *"}),e.jsxs("select",{value:l.brand_id,onChange:s=>i("brand_id",s.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[e.jsx("option",{value:"",children:"Select brand"}),Object.entries(j).map(([s,t])=>e.jsx("option",{value:s,children:t},s))]}),n.brand_id&&e.jsx("span",{className:"text-xs text-rose-500",children:n.brand_id})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Category *"}),e.jsxs("select",{value:l.category_id,onChange:s=>i("category_id",s.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[e.jsx("option",{value:"",children:"Select category"}),Object.entries(p).map(([s,t])=>e.jsx("option",{value:s,children:t},s))]}),n.category_id&&e.jsx("span",{className:"text-xs text-rose-500",children:n.category_id})]})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Material *"}),e.jsxs("select",{value:l.material_id,onChange:s=>i("material_id",s.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",children:[e.jsx("option",{value:"",children:"Select material"}),Object.entries(g).map(([s,t])=>e.jsx("option",{value:s,children:t},s))]}),n.material_id&&e.jsx("span",{className:"text-xs text-rose-500",children:n.material_id})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Gross weight (g)"}),e.jsx("input",{type:"number",step:"0.001",value:l.gross_weight,onChange:s=>i("gross_weight",s.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),n.gross_weight&&e.jsx("span",{className:"text-xs text-rose-500",children:n.gross_weight})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Net weight (g)"}),e.jsx("input",{type:"number",step:"0.001",value:l.net_weight,onChange:s=>i("net_weight",s.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),n.net_weight&&e.jsx("span",{className:"text-xs text-rose-500",children:n.net_weight})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Base price (₹) *"}),e.jsx("input",{type:"number",step:"0.01",value:l.base_price,onChange:s=>i("base_price",s.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),n.base_price&&e.jsx("span",{className:"text-xs text-rose-500",children:n.base_price})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:"Making charge (₹) *"}),e.jsx("input",{type:"number",step:"0.01",value:l.making_charge,onChange:s=>i("making_charge",s.target.value),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),n.making_charge&&e.jsx("span",{className:"text-xs text-rose-500",children:n.making_charge})]})]}),e.jsxs("label",{className:"inline-flex items-center gap-3 rounded-2xl border border-slate-200 px-4 py-3 text-sm text-slate-600",children:[e.jsx("input",{type:"checkbox",checked:l.is_jobwork_allowed,onChange:s=>i("is_jobwork_allowed",s.target.checked),className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500"}),"Jobwork requests allowed for this SKU"]})]})]})]}),e.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-xl shadow-slate-900/10",children:[e.jsx("div",{className:"flex items-center justify-between border-b border-slate-100 pb-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Variant option library"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Populate dropdown values for metal tones, stone grids, and sizes."})]})}),e.jsx("div",{className:"mt-6 grid gap-6 lg:grid-cols-3",children:w.map(({key:s,label:t})=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-slate-600",children:[e.jsx("span",{children:t}),e.jsxs("span",{className:"text-xs text-slate-400",children:[(l.variant_options?.[s]??[]).length," options"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(l.variant_options?.[s]??[]).map(a=>e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600",children:[a,e.jsx("button",{type:"button",onClick:()=>P(s,a),className:"text-slate-400 transition hover:text-rose-500","aria-label":`Remove ${t} ${a}`,children:"×"})]},a)),(l.variant_options?.[s]??[]).length===0&&e.jsx("span",{className:"text-xs text-slate-400",children:"No entries yet"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:h[s],onChange:a=>k({...h,[s]:a.target.value}),className:"flex-1 rounded-2xl border border-slate-200 px-3 py-2 text-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:`Add ${t.toLowerCase()}`}),e.jsx("button",{type:"button",onClick:()=>L(s),className:"rounded-2xl bg-slate-900 px-3 py-2 text-xs font-semibold text-white shadow hover:bg-slate-700",children:"Add"})]})]},s))})]}),e.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-xl shadow-slate-900/10",children:[e.jsxs("div",{className:"flex flex-col gap-3 border-b border-slate-100 pb-4 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Variant matrix"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Configure connected dropdowns. Default variant powers the customer catalogue card pricing."})]}),e.jsxs("button",{type:"button",onClick:K,className:"inline-flex items-center gap-2 rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600 transition hover:border-slate-400 hover:text-slate-900",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 5v14M5 12h14"})}),"Add variant"]})]}),C&&e.jsx("p",{className:"mt-4 rounded-2xl bg-rose-50 px-4 py-3 text-sm text-rose-600",children:C}),e.jsx("div",{className:"mt-6 space-y-4",children:l.variants.map((s,t)=>e.jsxs("div",{className:"rounded-2xl border border-slate-200 p-4 shadow-sm",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-5",children:[e.jsxs("label",{className:"flex flex-col gap-2 text-xs font-medium uppercase tracking-[0.2em] text-slate-500",children:["SKU",e.jsx("input",{type:"text",value:s.sku,onChange:a=>b(t,"sku",a.target.value),className:"rounded-2xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:"Optional"}),n[`variants.${t}.sku`]&&e.jsx("span",{className:"text-xs text-rose-500",children:n[`variants.${t}.sku`]})]}),w.map(({key:a,label:o})=>e.jsxs("label",{className:"flex flex-col gap-2 text-xs font-medium uppercase tracking-[0.2em] text-slate-500",children:[o,e.jsx("input",{type:"text",list:`variant-${a}-${t}`,value:s[a],onChange:c=>b(t,a,c.target.value),className:"rounded-2xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200",placeholder:`Enter ${o.toLowerCase()}`}),e.jsx("datalist",{id:`variant-${a}-${t}`,children:(l.variant_options?.[a]??[]).map(c=>e.jsx("option",{value:c},c))}),n[`variants.${t}.${a}`]&&e.jsx("span",{className:"text-xs text-rose-500",children:n[`variants.${t}.${a}`]})]},`${s.id??t}-${a}`))]}),e.jsxs("div",{className:"mt-4 grid gap-4 md:grid-cols-3",children:[e.jsxs("label",{className:"flex flex-col gap-2 text-xs font-medium uppercase tracking-[0.2em] text-slate-500",children:["Price adjustment (₹)",e.jsx("input",{type:"number",step:"0.01",value:s.price_adjustment,onChange:a=>b(t,"price_adjustment",a.target.value),className:"rounded-2xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),n[`variants.${t}.price_adjustment`]&&e.jsx("span",{className:"text-xs text-rose-500",children:n[`variants.${t}.price_adjustment`]})]}),e.jsxs("label",{className:"flex flex-col gap-2 text-xs font-medium uppercase tracking-[0.2em] text-slate-500",children:["Variant label",e.jsx("input",{type:"text",value:s.label,onChange:a=>b(t,"label",a.target.value),className:"rounded-2xl border border-slate-200 px-3 py-2 text-sm text-slate-700 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),n[`variants.${t}.label`]&&e.jsx("span",{className:"text-xs text-rose-500",children:n[`variants.${t}.label`]}),e.jsxs("span",{className:"text-[10px] uppercase tracking-[0.3em] text-slate-400",children:["Suggested: ",[s.metal_tone,s.stone_quality,s.size].filter(Boolean).join(" / ")]})]}),e.jsxs("div",{className:"flex items-center gap-3 rounded-2xl border border-slate-200 px-4 py-3",children:[e.jsx("input",{type:"radio",checked:s.is_default,onChange:()=>M(t),className:"h-4 w-4 text-slate-900 focus:ring-slate-900",name:"default-variant"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-800",children:"Default display variant"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Used for price cards & listing highlights."})]})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between text-xs text-slate-400",children:[e.jsxs("span",{children:["Row #",t+1]}),e.jsx("button",{type:"button",onClick:()=>A(t),className:"text-rose-500 hover:text-rose-600",children:"Remove variant"})]})]},s.id??`row-${t}`))})]}),e.jsxs("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-xl shadow-slate-900/10",children:[e.jsx("div",{className:"flex items-center justify-between border-b border-slate-100 pb-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Pricing references"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Keep your atelier and rate cards handy for quick quoting."})]})}),e.jsx("div",{className:"mt-6 grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:U.map(s=>e.jsxs("label",{className:"flex flex-col gap-2 text-sm text-slate-600",children:[e.jsx("span",{children:s.label}),e.jsx("input",{type:s.type,value:l.standard_pricing[s.key],onChange:t=>i("standard_pricing",{...l.standard_pricing,[s.key]:t.target.value}),className:"rounded-2xl border border-slate-200 px-4 py-2 focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-200"}),n[`standard_pricing.${s.key}`]&&e.jsx("span",{className:"text-xs text-rose-500",children:n[`standard_pricing.${s.key}`]})]},s.key))})]})]})]})}export{I as default};
